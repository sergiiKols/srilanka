# üó∫Ô∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ö–ê–†–¢ - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–î–∞—Ç–∞:** 2026-01-29  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–∞—Ä—Ç—É (POI) –∏ –ª–∏—á–Ω—ã–µ –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ (saved_properties)?

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### üåç –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞—Ä—Ç–∞ (–≤–∞—à–∞ –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è)
**URL:** `https://srilanka-37u2-a7jurihfa-sergiis-projects-48df2a28.vercel.app/`  
**–ú–∞—Ä—à—Ä—É—Ç:** `/` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç ‚Üí `/map`  
**–§–∞–π–ª:** `src/pages/map.astro` + `src/components/Explorer.tsx`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- ‚úÖ POI –∏–∑ Google Places API (6000+ —Ç–æ—á–µ–∫)
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ `/SRI/parsed_data/negombo_tangalle/pass_1_0-1km.json`
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (stay, eat, shop, etc.)
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ POI –∏–∑ Supabase (–ø—Ä–∏ zoom >= 16)
- ‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ POI)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```
Explorer.tsx ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã
  ‚îú‚îÄ‚îÄ Map.tsx ‚Üí Leaflet –∫–∞—Ä—Ç–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
  ‚îú‚îÄ‚îÄ POIValidator.tsx ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è POI —á–µ—Ä–µ–∑ Google Maps
  ‚îú‚îÄ‚îÄ PropertyImporter.tsx ‚Üí –∏–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö POI
  ‚îî‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä—ã ‚Üí –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –ø–æ–∏—Å–∫, —Ä–∞–¥–∏—É—Å
```

---

## üéØ –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (3 —Ç–∏–ø–∞ –∫–∞—Ä—Ç)

### 1Ô∏è‚É£ **–ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è (–í–ê–®–ê)**
**URL:** `/map` –∏–ª–∏ `/admin/master-map`  
**–î–æ—Å—Ç—É–ø:** –¢–æ–ª—å–∫–æ –≤—ã (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ admin —Ç–æ–∫–µ–Ω)  
**–î–∞–Ω–Ω—ã–µ:** 
- ‚úÖ –í—Å–µ POI (6000+ —Ç–æ—á–µ–∫ –∏–∑ Google Places)
- ‚úÖ **–ù–û–í–û–ï:** –í—Å–µ saved_properties –æ—Ç –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∫—Ç–æ –¥–æ–±–∞–≤–∏–ª, –∫–æ–≥–¥–∞)
- ‚úÖ –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (4 —Ä–µ–∂–∏–º–∞)
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –≤—Ä–µ–º–µ–Ω–∏, –∏—Å—Ç–æ—á–Ω–∏–∫—É

**–°–ª–æ–∏ –Ω–∞ –∫–∞—Ä—Ç–µ:**
```
Layer 1: POI (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ) - —Å–∏–Ω–∏–µ –º–∞—Ä–∫–µ—Ä—ã üîµ
Layer 2: Saved Properties (–æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤) - —Ü–≤–µ—Ç–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã üî¥üü†üü°üü¢
  ‚Üí –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å
  ‚Üí –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
  ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
```

---

### 2Ô∏è‚É£ **–õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–ù–û–í–ê–Ø)**
**URL:** `/map/personal/{userId}/{token}`  
**–î–æ—Å—Ç—É–ø:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü (—á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π token)  
**–î–∞–Ω–Ω—ã–µ:**
- ‚úÖ –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ saved_properties (5-20 –æ–±—ä–µ–∫—Ç–æ–≤)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ POI)
- ‚úÖ –ö–Ω–æ–ø–∫–∏: —É–¥–∞–ª–∏—Ç—å, –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É, –æ—Ç–º–µ—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö)
- –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ù–µ—Ç POI (—Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞)

---

### 3Ô∏è‚É£ **–ü—É–±–ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ (–ë–£–î–£–©–ï–ï)**
**URL:** `/map/public`  
**–î–æ—Å—Ç—É–ø:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
**–î–∞–Ω–Ω—ã–µ:**
- ‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –æ—Ç landlords
- ‚úÖ –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∫–∞–∑–∞ (–±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ü–µ–Ω–µ, —Ç–∏–ø—É, –ª–æ–∫–∞—Ü–∏–∏

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç A: **–†–∞–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–†–ï–ö–û–ú–ï–ù–î–£–Æ)**

```
src/components/
‚îú‚îÄ‚îÄ Explorer.tsx            ‚Üê –í–∞—à–∞ –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ POI + Saved Properties (–≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã)
‚îÇ
‚îú‚îÄ‚îÄ map/
‚îÇ   ‚îú‚îÄ‚îÄ Map.tsx            ‚Üê –û–±—â–∏–π Leaflet –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ PersonalMap.tsx    ‚Üê –ù–û–í–´–ô: –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ PublicMap.tsx      ‚Üê –ë–£–î–£–©–ï–ï: –ü—É–±–ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞
‚îÇ
‚îî‚îÄ‚îÄ property/
    ‚îî‚îÄ‚îÄ PropertyDrawer.tsx ‚Üê –î–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
```
src/pages/
‚îú‚îÄ‚îÄ map.astro                          ‚Üê –í–∞—à–∞ –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
‚îÇ   ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Explorer.tsx
‚îÇ
‚îú‚îÄ‚îÄ map/
‚îÇ   ‚îî‚îÄ‚îÄ personal/
‚îÇ       ‚îî‚îÄ‚îÄ [userId]/
‚îÇ           ‚îî‚îÄ‚îÄ [token].astro          ‚Üê –ù–û–í–ê–Ø: –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ               ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PersonalMap.tsx
‚îÇ
‚îî‚îÄ‚îÄ admin/
    ‚îî‚îÄ‚îÄ master-map.astro               ‚Üê –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: –ê–¥–º–∏–Ω—Å–∫–∞—è –≤–µ—Ä—Å–∏—è
        ‚Üí Explorer.tsx + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
```

---

### –í–∞—Ä–∏–∞–Ω—Ç B: **–û–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø—Ä–æ–ø—Å–∞–º–∏**

```typescript
<Explorer 
  mode="master"              // master | personal | public
  userId={userId}            // –¥–ª—è personal
  showPOIs={true}           // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å POI?
  showAllProperties={false} // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã?
  editable={true}           // –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å?
/>
```

‚ùå **–ú–∏–Ω—É—Å:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞–Ω–µ—Ç —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º  
‚úÖ **–ü–ª—é—Å:** –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: –í–∞—Ä–∏–∞–Ω—Ç A + –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º:
- `Map.tsx` - –±–∞–∑–æ–≤—ã–π Leaflet –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `PropertyDrawer.tsx` - –ø–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π –æ–±—ä–µ–∫—Ç–∞
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤, –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã

### –ß—Ç–æ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ:
- `PersonalMap.tsx` - –ø—Ä–æ—Å—Ç–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- `/map/personal/[userId]/[token].astro` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–∏—á–Ω–æ–π –∫–∞—Ä—Ç—ã
- API `/api/map/personal/[userId]/[token].ts` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## üé® –í–ò–ó–£–ê–õ–¨–ù–û–ï –†–ê–ó–î–ï–õ–ï–ù–ò–ï

### –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (–í–ê–®–ê):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üó∫Ô∏è H-Ome Finder | Master Map       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üîç –ü–æ–∏—Å–∫ | üéõÔ∏è –§–∏–ª—å—Ç—Ä—ã | üë• –ö–ª–∏–µ–Ω—Ç—ã ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  üîµ POI (6000+)                     ‚îÇ
‚îÇ  üî¥ Fresh properties (<24h)         ‚îÇ
‚îÇ  üü† Recent (1-7 days)               ‚îÇ
‚îÇ  üü° Old (7-30 days)                 ‚îÇ
‚îÇ  üü¢ Archive (>30 days)              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üë§ User: @john - 5 properties      ‚îÇ
‚îÇ  üë§ User: @mary - 12 properties     ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üè† –ú–æ—è –∫–∞—Ä—Ç–∞ (5 –æ–±—ä–µ–∫—Ç–æ–≤)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  üìç $500 Studio, Negombo           ‚îÇ
‚îÇ     ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ                     ‚îÇ
‚îÇ     üóëÔ∏è –£–¥–∞–ª–∏—Ç—å | üìù –ó–∞–º–µ—Ç–∫–∞        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìç $800 2BR House, Hikkaduwa      ‚îÇ
‚îÇ     üóëÔ∏è –£–¥–∞–ª–∏—Ç—å | üìù –ó–∞–º–µ—Ç–∫–∞        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [–¢–æ–ª—å–∫–æ –º–æ–∏ –æ–±—ä–µ–∫—Ç—ã - –±–µ–∑ POI]    ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –î–û–°–¢–£–ü

### –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞:
```typescript
// src/pages/map.astro
// –û–ø—Ü–∏—è 1: –û—Ç–∫—Ä—ã—Ç–∞ –≤—Å–µ–º (–∫–∞–∫ —Å–µ–π—á–∞—Å)
// –û–ø—Ü–∏—è 2: –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
const adminToken = Astro.url.searchParams.get('token');
if (adminToken !== import.meta.env.ADMIN_SECRET) {
  return Astro.redirect('/');
}
```

### –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞:
```typescript
// src/pages/map/personal/[userId]/[token].astro
const { userId, token } = Astro.params;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î
const { data: tenant } = await supabase
  .from('tenants')
  .select('*')
  .eq('telegram_user_id', userId)
  .eq('map_secret_token', token)
  .single();

if (!tenant) {
  return new Response('403 Forbidden', { status: 403 });
}

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞
await supabase.from('access_attempts').insert({
  telegram_user_id: userId,
  success: true
});
```

---

## üìä –î–ê–ù–ù–´–ï –ù–ê –ö–ê–†–¢–ê–•

### –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (Explorer.tsx):
```typescript
// –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
const parsedPOIs = await fetch('/SRI/parsed_data/.../pass_1_0-1km.json');
const dynamicPOIs = await loadFromSupabase('pois'); // –∏–∑ —Ç–∞–±–ª–∏—Ü—ã pois

// –ù–û–í–´–ï –¥–∞–Ω–Ω—ã–µ
const allClientProperties = await supabase
  .from('saved_properties')
  .select(`
    *,
    tenants!inner(telegram_user_id, saved_properties_count)
  `)
  .order('created_at', { ascending: false });

// –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
const allMarkers = [
  ...parsedPOIs.map(poi => ({ ...poi, type: 'poi' })),
  ...allClientProperties.map(prop => ({ ...prop, type: 'client_property' }))
];
```

### –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ (PersonalMap.tsx):
```typescript
// –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã
const myProperties = await supabase
  .from('saved_properties')
  .select('*')
  .eq('telegram_user_id', userId)
  .order('created_at', { ascending: false });

// –í—Å—ë! –ë–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ
```

---

## üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –†–ê–ó–î–ï–õ–ï–ù–ò–Ø

### ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞: `/map` (–∫–∞–∫ —Å–µ–π—á–∞—Å)
- –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞: `/map/personal/{userId}/{token}` (–Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç)
- –†–∞–∑–Ω—ã–µ URL ‚Üí —Ä–∞–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Üí –Ω–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞: –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å
- –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞: –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö (5-20 –æ–±—ä–µ–∫—Ç–æ–≤), –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞: –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Ç–æ–∫–µ–Ω–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

### ‚úÖ UX
- –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞: —Å–ª–æ–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–¥–ª—è –≤–∞—Å)
- –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞: –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)

---

## üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ù–µ —Ç—Ä–æ–≥–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É
```
‚úÖ /map –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
‚úÖ Explorer.tsx —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
‚úÖ –í—Å–µ POI –∏ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –º–µ—Å—Ç–µ
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞—ë–º –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É
```
1. src/components/map/PersonalMap.tsx
2. src/pages/map/personal/[userId]/[token].astro
3. API: src/pages/api/map/personal/[userId]/[token].ts
```

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å –±–æ—Ç–æ–º
```
1. –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç tenant ‚Üí –ø–æ–ª—É—á–∞–µ—Ç token
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç property ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ saved_properties
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É: /map/personal/{userId}/{token}
4. –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–≤–æ—é –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É
```

### –≠—Ç–∞–ø 4: –£–ª—É—á—à–∞–µ–º –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç—É (–ü–û–ó–ñ–ï)
```
1. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π "Client Properties" –≤ Explorer.tsx
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ saved_properties —Ü–≤–µ—Ç–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏
3. –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É
4. –§–∏–ª—å—Ç—Ä—ã –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
```

---

## ‚ùì –û–¢–í–ï–¢ –ù–ê –í–ê–® –í–û–ü–†–û–°

### –í–æ–π–¥—ë—Ç –ª–∏ –≤ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ?

**–ù–ï–¢! ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–µ –±—É–¥–µ—Ç:**

1. **–†–∞–∑–Ω—ã–µ URL:**
   - –í–∞—à–∞ –∫–∞—Ä—Ç–∞: `/map` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è: `/map/personal/{userId}/{token}` (–Ω–æ–≤–∞—è)

2. **–†–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –í–∞—à–∞ –∫–∞—Ä—Ç–∞: POI (6000+) + –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è: —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (5-20)

3. **–†–∞–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - –í–∞—à–∞ –∫–∞—Ä—Ç–∞: `Explorer.tsx` (—Å–ª–æ–∂–Ω—ã–π)
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è: `PersonalMap.tsx` (–ø—Ä–æ—Å—Ç–æ–π)

4. **–†–∞–∑–Ω—ã–µ —Ü–µ–ª–∏:**
   - –í–∞—à–∞ –∫–∞—Ä—Ç–∞: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –º–æ–¥–µ—Ä–∞—Ü–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è: –ª–∏—á–Ω–∞—è –∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞

---

## üé® –ë–£–î–£–©–ï–ï: –ú–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Å–ª–æ—ë–≤

```typescript
// –í Explorer.tsx –¥–æ–±–∞–≤–∏–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–ª–æ—ë–≤
const [layers, setLayers] = useState({
  pois: true,              // POI –∏–∑ Google Places
  clientProperties: true,  // –û–±—ä–µ–∫—Ç—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
  heatmap: false          // –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
});

// –§–∏–ª—å—Ç—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
const [clientFilter, setClientFilter] = useState({
  users: [],           // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  dateRange: 'all',    // all | today | week | month
  source: 'all',       // all | direct | forward
  priceRange: [0, 2000]
});
```

**–í—ã —Å–º–æ–∂–µ—Ç–µ:**
- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å POI
- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É

---

## ‚úÖ –í–´–í–û–î

**–°–æ–∑–¥–∞—ë–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É:**
- –í–∞—à–∞ –∫–∞—Ä—Ç–∞ `/map` ‚Üí **–Ω–µ —Ç—Ä–æ–≥–∞–µ–º**, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞ `/map/personal/...` ‚Üí **—Å–æ–∑–¥–∞—ë–º —Å –Ω—É–ª—è**
- –ü–æ–∑–∂–µ **–æ–±—ä–µ–¥–∏–Ω—è–µ–º** –Ω–∞ –≤–∞—à–µ–π –∫–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ —Å–ª–æ–∏

**–ù–∏–∫–∞–∫–∏—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤! üöÄ**

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –≤—ã–±–∏—Ä–∞–µ—Ç–µ?

**A) –ù–∞—á–∞—Ç—å —Å –ª–∏—á–Ω–æ–π –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞** (–ø—Ä–æ—Å—Ç–∞—è)
   - PersonalMap.tsx
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ /map/personal/[userId]/[token]
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

**B) –°–Ω–∞—á–∞–ª–∞ —É–ª—É—á—à–∏—Ç—å –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç—É** (—Å–ª–æ–∂–Ω–∞—è)
   - –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π Client Properties –≤ Explorer.tsx
   - –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
   - –§–∏–ª—å—Ç—Ä—ã –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º

**C) –°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞, –∫–∞—Ä—Ç—É –ø–æ—Ç–æ–º**
   - –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
   - –ö–∞—Ä—Ç—É –¥–æ–±–∞–≤–∏–º –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** **C ‚Üí A ‚Üí B**  
(–°–Ω–∞—á–∞–ª–∞ –±–æ—Ç ‚Üí –ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Üí –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞)
