# üêõ –û—Ç–ª–∞–¥–∫–∞ –∫–Ω–æ–ø–∫–∏ "Show Archived"

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
- ‚úÖ –ö–Ω–æ–ø–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≤–∏–¥–Ω–∞ –≤ Admin Panel
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Show Archived (0)" - –Ω–µ—Ç –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚ùå –ù–∞ –∫–∞—Ä—Ç–µ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏

## üîç –®–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console
3. –í–∫–ª—é—á–∏—Ç–µ —á–µ–∫–±–æ–∫—Å "Show Archived"
4. **–ò—â–∏—Ç–µ –ª–æ–≥–∏:**

```
üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ archived_properties
üìä –§–∏–ª—å—Ç—Ä—ã: { dateFilter: "all", selectedUser: "all", showArchived: true }
üì¶ –ü–æ–ª—É—á–µ–Ω–æ –∏–∑ –±–∞–∑—ã: 0 –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 0 –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "–ü–æ–ª—É—á–µ–Ω–æ –∏–∑ –±–∞–∑—ã: 0" - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!**

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç: `tmp_rovodev_check_archived.sql`

```bash
# –í Supabase SQL Editor –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: true
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ archived_properties: 0  ‚Üê –í–æ—Ç –ø—Ä–æ–±–ª–µ–º–∞!
–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø–æ–∫–∞–∑–∞ (can_restore=true): 0
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ –≤ `tmp_rovodev_check_archived.sql`:

```sql
INSERT INTO archived_properties (
    title,
    property_type,
    latitude,
    longitude,
    price,
    currency,
    bedrooms,
    bathrooms,
    description,
    telegram_user_id,
    can_restore,
    archive_reason,
    archived_at,
    original_created_at,
    days_active
) VALUES (
    'TEST - Archived Property',
    'apartment',
    6.0329,  -- Galle, Sri Lanka
    80.2168,
    500,
    'USD',
    2,
    1,
    'This is a test archived property for debugging',
    123456789,  -- –¢–µ—Å—Ç–æ–≤—ã–π user ID
    TRUE,
    'user_deleted',
    NOW(),
    NOW() - INTERVAL '7 days',
    7
);
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. –û—Ç–∫—Ä–æ–π—Ç–µ Admin Panel
3. –í–∫–ª—é—á–∏—Ç–µ "Show Archived"
4. **–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**
   - "Show Archived (1)" –≤ –∫–Ω–æ–ø–∫–µ
   - –°–µ—Ä—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ –≤ —Ä–∞–π–æ–Ω–µ Galle

---

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: RLS (Row Level Security) –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ "permission denied"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS:

```sql
-- –°–º–æ—Ç—Ä–∏–º –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT * FROM pg_policies WHERE tablename = 'archived_properties';

-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞!)
ALTER TABLE archived_properties DISABLE ROW LEVEL SECURITY;

-- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
CREATE POLICY "Admin can read all archived"
  ON archived_properties FOR SELECT
  TO authenticated
  USING (true);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Supabase anon key –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤

**–°–∏–º–ø—Ç–æ–º:** 403 Forbidden –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏:

```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤—Å–µ—Ö –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
CREATE POLICY "Allow anon read archived"
  ON archived_properties FOR SELECT
  TO anon
  USING (can_restore = true);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–°–∏–º–ø—Ç–æ–º:** Error: relation "archived_properties" does not exist

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
database/06_create_archived_properties_table.sql
```

---

## üìù –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–∞—Å—å —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å ‚úÖ

1. –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "Show Archived (1)"
2. –ù–∞ –∫–∞—Ä—Ç–µ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å–µ—Ä—ã–π –º–∞—Ä–∫–µ—Ä
3. **–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞—Ä—Ö–∏–≤–∞—Ü–∏—é:**
   - –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç
   - –ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### –ï—Å–ª–∏ –ù–ï –ø–æ—è–≤–∏–ª–∞—Å—å ‚ùå

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**

1. **Network tab** ‚Üí –ò—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `archived_properties`
2. **–°–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç** - —Ç–∞–º –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫—É** –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ

---

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ö–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä—ã–≤–∞–µ–º Admin Panel** ‚Üí –í–∏–¥–∏–º "Show Archived (N)"
2. **–í–∫–ª—é—á–∞–µ–º —á–µ–∫–±–æ–∫—Å** ‚Üí 
   - –ö–æ–Ω—Å–æ–ª—å: `üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã`
   - –ö–æ–Ω—Å–æ–ª—å: `üì¶ –ü–æ–ª—É—á–µ–Ω–æ –∏–∑ –±–∞–∑—ã: N –æ–±—ä–µ–∫—Ç–æ–≤`
   - –ö–æ–Ω—Å–æ–ª—å: `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ N –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤`
3. **–ù–∞ –∫–∞—Ä—Ç–µ** ‚Üí –ü–æ—è–≤–ª—è—é—Ç—Å—è —Å–µ—Ä—ã–µ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
4. **–ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä** ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è PropertyDrawer —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º [ARCHIVED]

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:**

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
SELECT COUNT(*) FROM archived_properties;

-- 2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç (–µ—Å–ª–∏ 0)
INSERT INTO archived_properties (
    title, property_type, latitude, longitude, 
    price, currency, telegram_user_id,
    can_restore, archive_reason, archived_at, original_created_at, days_active
) VALUES (
    'TEST Archived', 'apartment', 6.0329, 80.2168,
    500, 'USD', 123456789,
    TRUE, 'user_deleted', NOW(), NOW() - INTERVAL '7 days', 7
);

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É
SELECT * FROM archived_properties ORDER BY archived_at DESC LIMIT 1;
```

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:** –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤–∫–ª—é—á–∏—Ç–µ "Show Archived" ‚ú®

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:

1. ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è Show Archived)
2. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞ `SELECT COUNT(*) FROM archived_properties;`
3. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞ `SELECT * FROM pg_policies WHERE tablename = 'archived_properties';`

–Ø –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üöÄ
