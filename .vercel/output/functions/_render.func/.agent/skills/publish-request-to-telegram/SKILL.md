## Name: Publish Request to Telegram

## Description:
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞—è–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –∞—Ä–µ–Ω–¥—É –∂–∏–ª—å—è –≤ Telegram-–≥—Ä—É–ø–ø—É –¥–ª—è landlords

## Purpose:
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç –∏–ª–∏ –≤–µ–±-—Ñ–æ—Ä–º—É, —ç—Ç–∞ –∑–∞—è–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –≤ Telegram-–≥—Ä—É–ø–ø–µ –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–∏ (landlords). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç landlords'–∞–º –≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö.

---

## üìã –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ó–ê–î–ê–ß–ò

### –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –∑–∞—è–≤–∫—É –≤ –±–æ—Ç–µ –∏ –æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –≤ –ë–î, —ç—Ç–∞ –∑–∞—è–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Telegram-–≥—Ä—É–ø–ø–µ –¥–ª—è –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–π. –≠—Ç–æ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö landlords'–æ–≤: ¬´–í–Ω–∏–º–∞–Ω–∏–µ, –∫–ª–∏–µ–Ω—Ç –∏—â–µ—Ç –∂–∏–ª—å–µ!¬ª

### –ö–û–ì–î–ê –ó–ê–ü–£–°–ö–ê–ï–¢–°–Ø
- –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞—è–≤–∫–∞ (`rental_request`) —Å–æ–∑–¥–∞–Ω–∞ –≤ –ë–î –∏ –≤–∞–ª–∏–¥–Ω–∞
- –ò–ª–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ¬´–æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É¬ª

### –ß–¢–û –ù–ê –í–•–û–î–ï
- **ID –∑–∞—è–≤–∫–∏** (`request_id`)
- **–î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏:**
  - –†–∞–π–æ–Ω/—Ä–µ–≥–∏–æ–Ω (`location`)
  - –î–∞—Ç—ã –∑–∞–µ–∑–¥–∞/–≤—ã–µ–∑–¥–∞ (`check_in`, `check_out`)
  - –ë—é–¥–∂–µ—Ç (`budget_min`, `budget_max`)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω (`bedrooms`)
  - –£–¥–æ–±—Å—Ç–≤–∞ (`amenities`)
  - –û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (`requirements`)
  - –ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ß–¢–û –ù–ê –í–´–•–û–î–ï
- **–°–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ** –≤ Telegram-–≥—Ä—É–ø–ø—É (—É—Å–ø–µ—à–Ω–æ –∏–ª–∏ –æ—à–∏–±–∫–∞)
- **–í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
  - ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram (`telegram_message_id`)
  - –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (`published_at`)
  - –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (`published: true/false`)

### –ß–¢–û –°–ò–°–¢–ï–ú–ê –î–ï–õ–ê–ï–¢

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
```sql
SELECT * FROM rental_requests WHERE id = :request_id
```

#### –®–∞–≥ 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
```
üè† –ù–û–í–´–ô –ó–ê–ü–†–û–° –ù–ê –ê–†–ï–ù–î–£

üìç –†–µ–≥–∏–æ–Ω: Negombo
üìÖ –î–∞—Ç—ã: 15 —Ñ–µ–≤—Ä–∞–ª—è - 20 –º–∞—Ä—Ç–∞ (33 –¥–Ω—è)
üí∞ –ë—é–¥–∂–µ—Ç: $1000-1500/–º–µ—Å—è—Ü
üõèÔ∏è –°–ø–∞–ª—å–Ω–∏: 2-3
‚ú® –£–¥–æ–±—Å—Ç–≤–∞: WiFi, –±–∞—Å—Å–µ–π–Ω, –∫—É—Ö–Ω—è
üí¨ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: –±–ª–∏–∑–∫–æ –∫ –ø–ª—è–∂—É, —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ

üë§ –ö–ª–∏–µ–Ω—Ç: @username –∏–ª–∏ —Å–∫—Ä—ã—Ç–æ
üì± –ö–æ–Ω—Ç–∞–∫—Ç: –ü–æ –∑–∞–ø—Ä–æ—Å—É

üëâ –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å!
[–ö–Ω–æ–ø–∫–∞: –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è]
```

#### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
```javascript
const message = await bot.sendMessage(chatId, formattedText, {
  parse_mode: 'HTML',
  reply_markup: {
    inline_keyboard: [[
      { text: '‚úÖ –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è', callback_data: `respond_${request_id}` }
    ]]
  }
});
```

#### –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Å–æ–æ–±—â–µ–Ω–∏—è
```sql
UPDATE rental_requests 
SET telegram_message_id = :message_id,
    published_at = NOW(),
    published = true
WHERE id = :request_id
```

---

## üîß –í–ê–ñ–ù–´–ï –í–û–ü–†–û–°–´ (–¥–ª—è production)

### 1. Telegram –≥—Ä—É–ø–ø–∞ –¥–ª—è landlords
- **ID –≥—Ä—É–ø–ø—ã:** `-1001234567890` (–ø—Ä–∏–º–µ—Ä, –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π)
- **–ù–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø?** –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤:
  - Negombo landlords: `-100111111111`
  - Mirissa landlords: `-100222222222`
  - Hikkaduwa landlords: `-100333333333`

### 2. –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å emoji –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å inline-–∫–Ω–æ–ø–∫—É "–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è"
- ‚ùì –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ —Å—Ä–∞–∑—É –∏–ª–∏ —Å–∫—Ä—ã–≤–∞—Ç—å?
- ‚ùì –î–æ–±–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ —Ä–µ–≥–∏–æ–Ω–∞?

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü–∞:** `rental_requests`
- **–ù–æ–≤—ã–µ –ø–æ–ª—è:**
  - `telegram_message_id` (bigint)
  - `published_at` (timestamp)
  - `published` (boolean)
  - `telegram_group_id` (text) - –≤ –∫–∞–∫—É—é –≥—Ä—É–ø–ø—É –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ

### 4. –¢—Ä–∏–≥–≥–µ—Ä –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- **–í–∞—Ä–∏–∞–Ω—Ç –ê:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ (trigger –≤ –ë–î –∏–ª–∏ webhook)
- **–í–∞—Ä–∏–∞–Ω—Ç –ë:** –ö–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É"
- **–í–∞—Ä–∏–∞–Ω—Ç –í:** –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞

---

## üìù Instructions for AI Agent:

### Step 1: Validate Input
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `request_id` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞—è–≤–∫–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ —Ä–∞–Ω–µ–µ (`published = false`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (location, dates, budget)

### Step 2: Fetch Request Data
```javascript
const { data, error } = await supabase
  .from('rental_requests')
  .select('*')
  .eq('id', requestId)
  .single();
```

### Step 3: Format Message
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –≤—ã—à–µ
- –î–æ–±–∞–≤–∏—Ç—å emoji –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—ã (DD MMM - DD MMM)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç ($XXX-$YYY/month)

### Step 4: Send to Telegram
```javascript
const bot = new TelegramBot(TELEGRAM_BOT_TOKEN);
const message = await bot.sendMessage(LANDLORDS_GROUP_ID, text, options);
```

### Step 5: Save Message ID
```javascript
await supabase
  .from('rental_requests')
  .update({
    telegram_message_id: message.message_id,
    published_at: new Date().toISOString(),
    published: true
  })
  .eq('id', requestId);
```

### Step 6: Return Result
```json
{
  "success": true,
  "request_id": 123,
  "telegram_message_id": 456789,
  "published_at": "2026-01-26T12:00:00Z",
  "group_id": "-1001234567890"
}
```

---

## üß™ Expected Output:

**Success:**
```json
{
  "status": "published",
  "request_id": 123,
  "telegram_message_id": 456789,
  "telegram_group_id": "-1001234567890",
  "message": "Request successfully published to Telegram",
  "published_at": "2026-01-26T12:00:00Z"
}
```

**Error:**
```json
{
  "status": "error",
  "error": "Request already published",
  "request_id": 123
}
```

---

## üí° Example Usage:

### Via Admin Panel:
```
1. –û—Ç–∫—Ä—ã—Ç—å /admin/rental-requests
2. –ù–∞–π—Ç–∏ –∑–∞—è–≤–∫—É —Å ID 123
3. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Telegram"
4. –°–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç skill
5. –ó–∞—è–≤–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ Telegram-–≥—Ä—É–ø–ø–µ
```

### Via API:
```bash
POST /api/admin/skills/publish-request-to-telegram/run
{
  "request_id": 123
}
```

### Via Command Line:
```bash
node .agent/skills/publish-request-to-telegram/scripts/publish.js --request-id=123
```

---

## üì¶ Dependencies:

```json
{
  "node-telegram-bot-api": "^0.66.0",
  "@supabase/supabase-js": "^2.39.0",
  "date-fns": "^3.0.0"
}
```

---

## üîê Environment Variables:

```env
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
LANDLORDS_GROUP_ID=-1001234567890
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=xxx
```

---

## ‚ö†Ô∏è Notes:

- **–¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç placeholder –¥–∞–Ω–Ω—ã–µ –∏ mock Telegram API
- **Production –≤–µ—Ä—Å–∏—è:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ credentials –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ë–î
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
- **Rate limiting:** –ù–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ 20 –∑–∞—è–≤–æ–∫ –≤ –º–∏–Ω—É—Ç—É (Telegram –ª–∏–º–∏—Ç)
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–£–¥–∞–ª–µ–Ω–∏–µ:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≥—Ä—É–ø–ø—ã

---

## üöÄ Future Enhancements:

1. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å:** –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ —Ä—É—Å—Å–∫–æ–º
2. **–£–º–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É –ø–æ —Ä–µ–≥–∏–æ–Ω—É
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ landlords'–æ–≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –∑–∞—è–≤–∫—É
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** –£–≤–µ–¥–æ–º–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∫–æ–≥–¥–∞ landlord –æ—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è
5. **AI —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –ù–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ/—Å–ø–∞–º –∑–∞—è–≤–∫–∏
