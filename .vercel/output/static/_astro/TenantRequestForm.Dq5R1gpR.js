import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.JXKNaeUN.js";const y={location:{required:!0,custom:e=>["unawatuna","mirissa","hikkaduwa","tangalle","weligama","galle","ahangama"].includes(e),message:{ru:"–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é",en:"Select location"}},dates:{check_in:{required:!0,custom:e=>{const n=new Date(e),s=new Date;return s.setHours(0,0,0,0),n>=s},message:{ru:"–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∑–∞–µ–∑–¥–∞ (–Ω–µ —Ä–∞–Ω—å—à–µ —Å–µ–≥–æ–¥–Ω—è)",en:"Specify check-in date (not earlier than today)"}},check_out:{required:!0,custom:(e,n)=>{const s=new Date(n.check_in_date);return new Date(e)>s},message:{ru:"–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –∑–∞–µ–∑–¥–∞",en:"Check-out date must be after check-in date"}},min_nights:{min:1,message:{ru:"–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 –Ω–æ—á—å",en:"Minimum stay: 1 night"}},max_nights:{max:365,message:{ru:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 365 –Ω–æ—á–µ–π",en:"Maximum stay: 365 nights"}}},guests:{adults:{min:1,max:30,message:{ru:"–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö (–æ—Ç 1 –¥–æ 30)",en:"Specify number of adults (1 to 30)"}},children:{max:10,message:{ru:"–ú–∞–∫—Å–∏–º—É–º 10 –¥–µ—Ç–µ–π",en:"Maximum 10 children"}},total:{required:!0,min:1,max:40,custom:(e,n)=>{const s=(n.adults_count||0)+(n.children_count||0);return s>=1&&s<=40},message:{ru:"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π: –æ—Ç 1 –¥–æ 40",en:"Total guests: 1 to 40"}},guest_type:{required:!0,custom:e=>["family","friends","couple","solo"].includes(e),message:{ru:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≥—Ä—É–ø–ø—ã",en:"Select group type"}}},purpose:{required:!0,custom:e=>["vacation","work","event","other"].includes(e),message:{ru:"–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å –ø–æ–µ–∑–¥–∫–∏",en:"Specify trip purpose"}},pets:{message:{ru:"–£–∫–∞–∂–∏—Ç–µ, –±—É–¥—É—Ç –ª–∏ —Å –≤–∞–º–∏ –∂–∏–≤–æ—Ç–Ω—ã–µ",en:"Specify if you will bring pets"}},additional:{maxLength:1e3,message:{ru:"–ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤",en:"Maximum 1000 characters"}}};function W(e){const n=["location","check_in_date","check_out_date","adults_count","guest_type","trip_purpose","has_pets"],s=n.filter(o=>{const d=e[o];return d!=null&&d!==""});return Math.round(s.length/n.length*100)}function O(e,n){const s=new Date(e),o=new Date(n),d=Math.abs(o.getTime()-s.getTime());return Math.ceil(d/(1e3*60*60*24))}function K(e){const n=[];return e.trip_purpose==="event"&&n.push({field:"trip_purpose",message:{ru:"‚ö†Ô∏è –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —Ç—Ä–µ–±—É—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–º",en:"‚ö†Ô∏è Events require coordination with landlord"}}),(e.adults_count||0)+(e.children_count||0)>10&&n.push({field:"guests",message:{ru:"‚ö†Ô∏è –î–ª—è –±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø (>10 —á–µ–ª–æ–≤–µ–∫) –¥–æ—Å—Ç—É–ø–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤",en:"‚ö†Ô∏è Limited properties available for large groups (>10 people)"}}),e.check_in_date&&e.check_out_date&&O(e.check_in_date,e.check_out_date)>90&&n.push({field:"dates",message:{ru:"üí° –î–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –∞—Ä–µ–Ω–¥—ã (>3 –º–µ—Å—è—Ü–µ–≤) –≤–æ–∑–º–æ–∂–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã",en:"üí° Special rates available for long-term rentals (>3 months)"}}),n}function Q(e){const n=[];return e.trip_purpose==="work"&&!e.additional_requirements?.includes("WiFi")&&n.push({field:"additional",message:{ru:"üí° –°–æ–≤–µ—Ç: —É–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —É–¥–∞–ª—ë–Ω–Ω–æ",en:"üí° Tip: specify internet requirements if working remotely"}}),e.children_count>0&&!e.additional_requirements?.includes("–∫—Ä–æ–≤–∞—Ç–∫–∞")&&n.push({field:"additional",message:{ru:"üí° –°–æ–≤–µ—Ç: —É–∫–∞–∂–∏—Ç–µ, –Ω—É–∂–Ω–∞ –ª–∏ –¥–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞",en:"üí° Tip: specify if you need a baby crib"}}),n}function L(e,n="ru"){const s=[],o=[],d=[],f=z(e,n);f&&s.push(f);const p=X(e,n);s.push(...p);const w=Z(e,n);s.push(...w);const b=ee(e,n);b&&s.push(b);const v=te(e,n);v&&s.push(v);const x=se(e,n);x&&s.push(x);const S=K(e);o.push(...S.map(h=>({field:h.field,message:h.message[n],type:"warning"})));const k=Q(e);d.push(...k.map(h=>({field:h.field,message:h.message[n],type:"hint"})));const j=W(e);return{isValid:s.length===0&&j===100,progress:j,errors:s,warnings:o,hints:d}}function z(e,n){const s=y.location;return e.location?s.custom(e.location)?null:{field:"location",message:s.message[n],type:"error"}:{field:"location",message:s.message[n],type:"error"}}function X(e,n){const s=[],o=y.dates;if(e.check_in_date?o.check_in.custom(e.check_in_date)||s.push({field:"check_in_date",message:o.check_in.message[n],type:"error"}):s.push({field:"check_in_date",message:o.check_in.message[n],type:"error"}),!e.check_out_date)s.push({field:"check_out_date",message:o.check_out.message[n],type:"error"});else if(e.check_in_date)if(!o.check_out.custom(e.check_out_date,e))s.push({field:"check_out_date",message:o.check_out.message[n],type:"error"});else{const d=O(e.check_in_date,e.check_out_date);d<o.min_nights.min&&s.push({field:"dates",message:o.min_nights.message[n],type:"error"}),d>o.max_nights.max&&s.push({field:"dates",message:o.max_nights.message[n],type:"error"})}return s}function Z(e,n){const s=[],o=y.guests;return e.adults_count===void 0||e.adults_count===null?s.push({field:"adults_count",message:o.adults.message[n],type:"error"}):(e.adults_count<o.adults.min||e.adults_count>o.adults.max)&&s.push({field:"adults_count",message:o.adults.message[n],type:"error"}),e.children_count!==void 0&&e.children_count>o.children.max&&s.push({field:"children_count",message:o.children.message[n],type:"error"}),e.adults_count!==void 0&&(o.total.custom(null,e)||s.push({field:"guests",message:o.total.message[n],type:"error"})),e.guest_type?o.guest_type.custom(e.guest_type)||s.push({field:"guest_type",message:o.guest_type.message[n],type:"error"}):s.push({field:"guest_type",message:o.guest_type.message[n],type:"error"}),s}function ee(e,n){const s=y.purpose;return e.trip_purpose?s.custom(e.trip_purpose)?null:{field:"trip_purpose",message:s.message[n],type:"error"}:{field:"trip_purpose",message:s.message[n],type:"error"}}function te(e,n){const s=y.pets;return e.has_pets===void 0||e.has_pets===null?{field:"has_pets",message:s.message[n],type:"error"}:null}function se(e,n){const s=y.additional;return e.additional_requirements&&e.additional_requirements.length>s.maxLength?{field:"additional_requirements",message:s.message[n],type:"error"}:null}const R={ru:{title:"–ù–∞–π—Ç–∏ –∂–∏–ª—å—ë –≤ –®—Ä–∏-–õ–∞–Ω–∫–µ",close:"–ó–∞–∫—Ä—ã—Ç—å",back:"–ù–∞–∑–∞–¥",progress_filled:"–ó–∞–ø–æ–ª–Ω–µ–Ω–æ",progress_complete:"–ì–æ—Ç–æ–≤–æ",location_title:"–ì–¥–µ –∏—â–µ—Ç–µ –∂–∏–ª—å—ë?",location_label:"–õ–æ–∫–∞—Ü–∏—è",location_placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥",other_city:"–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥",custom_city_label:"–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",custom_city_placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –®—Ä–∏-–õ–∞–Ω–∫–µ",validating_city:"–ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–æ–¥...",dates_title:"–î–∞—Ç—ã –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è",check_in_label:"–ó–∞–µ–∑–¥",check_out_label:"–í—ã–µ–∑–¥",duration_label:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",nights:"–Ω–æ—á–µ–π",night:"–Ω–æ—á—å",guests_title:"–ì–æ—Å—Ç–∏",adults_label:"–í–∑—Ä–æ—Å–ª—ã—Ö",children_label:"–î–µ—Ç–µ–π",guest_type_label:"–ö—Ç–æ –≤—ã?",family:"–°–µ–º—å—è",friends:"–î—Ä—É–∑—å—è",couple:"–ü–∞—Ä–∞",solo:"–û–¥–∏–Ω",purpose_title:"–¶–µ–ª—å –ø–æ–µ–∑–¥–∫–∏",vacation:"–û—Ç–¥—ã—Ö",work:"–†–∞–±–æ—Ç–∞",event:"–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ",other:"–î—Ä—É–≥–æ–µ",pets_title:"–ñ–∏–≤–æ—Ç–Ω—ã–µ",pets_question:"–ë—É–¥—É—Ç –ª–∏ —Å –≤–∞–º–∏ –∂–∏–≤–æ—Ç–Ω—ã–µ?",yes:"–î–∞",no:"–ù–µ—Ç",extension_title:"–ü—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è",extension_question:"–í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã?",dont_know:"–ù–µ –∑–Ω–∞—é",additional_title:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è",additional_placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω—É–∂–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞, —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ, —Ö–æ—Ä–æ—à–∏–π WiFi –¥–ª—è —Ä–∞–±–æ—Ç—ã...",additional_examples:`‚Ä¢ –î–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞
‚Ä¢ –¢–∏—Ö–æ–µ –º–µ—Å—Ç–æ
‚Ä¢ –•–æ—Ä–æ—à–∏–π WiFi
‚Ä¢ –ë–ª–∏–∑–∫–æ –∫ –ø–ª—è–∂—É`,submit:"üöÄ –ù–∞–π—Ç–∏ –∂–∏–ª—å—ë",submitting:"–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...",success:"‚úì –ì–æ—Ç–æ–≤–æ",draft_found_title:"–ù–∞–π–¥–µ–Ω —á–µ—Ä–Ω–æ–≤–∏–∫",draft_found_message:"–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?",draft_restore:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",draft_discard:"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ",save_draft_title:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫?",save_draft_message:"–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",save_draft_save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",save_draft_discard:"–ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å",save_draft_cancel:"–û—Ç–º–µ–Ω–∞",success_title:"–ì–æ—Ç–æ–≤–æ!",success_message:"–í–∞—à –∑–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç. –ú—ã –Ω–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–±–∏—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∂–∏–ª—å—è –∏ —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.",success_ok:"–û—Ç–ª–∏—á–Ω–æ",error_title:"–û—à–∏–±–∫–∞",error_message:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.",error_retry:"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞",filling_time:"–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: ~30 —Å–µ–∫—É–Ω–¥"},en:{title:"Find accommodation in Sri Lanka",close:"Close",back:"Back",progress_filled:"Filled",progress_complete:"Complete",location_title:"Where are you looking?",location_label:"Location",location_placeholder:"Select city",other_city:"Other city",custom_city_label:"City name",custom_city_placeholder:"Enter city name in Sri Lanka",validating_city:"Validating city...",dates_title:"Stay dates",check_in_label:"Check-in",check_out_label:"Check-out",duration_label:"Duration",nights:"nights",night:"night",guests_title:"Guests",adults_label:"Adults",children_label:"Children",guest_type_label:"Who are you?",family:"Family",friends:"Friends",couple:"Couple",solo:"Solo",purpose_title:"Trip purpose",vacation:"Vacation",work:"Work",event:"Event",other:"Other",pets_title:"Pets",pets_question:"Will you bring pets?",yes:"Yes",no:"No",extension_title:"Extension",extension_question:"Extension possible?",dont_know:"Don't know",additional_title:"Additional requirements",additional_placeholder:"E.g.: need baby crib, quiet place, good WiFi for work...",additional_examples:`‚Ä¢ Baby crib
‚Ä¢ Quiet place
‚Ä¢ Good WiFi
‚Ä¢ Close to beach`,submit:"üöÄ Find accommodation",submitting:"Submitting...",success:"‚úì Done",draft_found_title:"Draft found",draft_found_message:"You have an unfinished request. Restore it?",draft_restore:"Restore",draft_discard:"Start over",save_draft_title:"Save draft?",save_draft_message:"You have unsaved changes",save_draft_save:"Save",save_draft_discard:"Don't save",save_draft_cancel:"Cancel",success_title:"Success!",success_message:"Your request has been received. We are finding accommodation options and will contact you soon.",success_ok:"Great",error_title:"Error",error_message:"Failed to submit request. Please try again.",error_retry:"Try again",filling_time:"Filling time: ~30 seconds"}};function ie(e){return R[e]||R.ru}function ne(e,n){return n==="ru"?e===1||e>20&&e%10===1?`${e} –Ω–æ—á—å`:e>=2&&e<=4||e>20&&e%10>=2&&e%10<=4?`${e} –Ω–æ—á–∏`:`${e} –Ω–æ—á–µ–π`:e===1?`${e} night`:`${e} nights`}const ae=[{id:"unawatuna",name:{en:"Unawatuna",ru:"–£–Ω–∞–≤–∞—Ç—É–Ω–∞"},description:{en:"Beach & diving",ru:"–ü–ª—è–∂ –∏ –¥–∞–π–≤–∏–Ω–≥"},region:"Galle District",coordinates:{lat:6.0108,lng:80.2497}},{id:"mirissa",name:{en:"Mirissa",ru:"–ú–∏—Ä–∏—Å—Å–∞"},description:{en:"Whales & surfing",ru:"–ö–∏—Ç—ã –∏ —Å—ë—Ä—Ñ–∏–Ω–≥"},region:"Matara District",coordinates:{lat:5.9467,lng:80.4706}},{id:"hikkaduwa",name:{en:"Hikkaduwa",ru:"–•–∏–∫–∫–∞–¥—É–≤–∞"},description:{en:"Surf & nightlife",ru:"–°—ë—Ä—Ñ –∏ –Ω–æ—á–Ω–∞—è –∂–∏–∑–Ω—å"},region:"Galle District",coordinates:{lat:6.1408,lng:80.1033}},{id:"tangalle",name:{en:"Tangalle",ru:"–¢–∞–Ω–≥–∞–ª–ª–µ"},description:{en:"Quiet beaches",ru:"–¢–∏—Ö–∏–µ –ø–ª—è–∂–∏"},region:"Hambantota District",coordinates:{lat:6.024,lng:80.7953}},{id:"weligama",name:{en:"Weligama",ru:"–í–µ–ª–∏–≥–∞–º–∞"},description:{en:"Surf lessons",ru:"–®–∫–æ–ª–∞ —Å—ë—Ä—Ñ–∏–Ω–≥–∞"},region:"Matara District",coordinates:{lat:5.9745,lng:80.4289}},{id:"galle",name:{en:"Galle",ru:"–ì–∞–ª–ª–µ"},description:{en:"Historic fort",ru:"–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä—Ç"},region:"Galle District",coordinates:{lat:6.0535,lng:80.221}},{id:"ahangama",name:{en:"Ahangama",ru:"–ê—Ö–∞–Ω–∞–≥–∞–º–∞"},description:{en:"Surf & yoga",ru:"–°—ë—Ä—Ñ –∏ –π–æ–≥–∞"},region:"Galle District",coordinates:{lat:5.9697,lng:80.3711}}];function re(e){return ae.map(n=>({id:n.id,name:n.name[e],description:n.description[e]}))}const D="tenant_form_draft_v2";function le(){const[e,n]=l.useState("en"),[s,o]=l.useState({children_count:0,has_pets:!1}),[d,f]=l.useState(!1),[p,w]=l.useState(!1),[b,v]=l.useState(!1),[x,S]=l.useState(""),[k,j]=l.useState(!1),[h,N]=l.useState(null),F=l.useRef(),E=l.useRef(),_=l.useRef(),q=l.useRef(),r=ie(e),a=typeof window<"u"?window.Telegram?.WebApp:null;l.useEffect(()=>{if(a)return a.ready(),a.expand(),M(),$(),a.BackButton.show(),()=>{_.current&&clearTimeout(_.current)}},[a]),l.useEffect(()=>{if(!a)return;const t=a.MainButton,c=L(s,e),u=W(s);t.color=a.themeParams.button_color||"#7C3AED",t.textColor=a.themeParams.button_text_color||"#FFFFFF",u<100?(t.setText(e==="ru"?`–ó–∞–ø–æ–ª–Ω–µ–Ω–æ ${u}%`:`Filled ${u}%`),t.disable()):c.isValid?(t.setText(r.submit),t.enable()):(t.setText(r.submit),t.disable()),t.show();const m=()=>{U()};return F.current=m,t.onClick(m),()=>{F.current&&t.offClick(F.current)}},[s,e,a,r]),l.useEffect(()=>{if(!a)return;const t=()=>{p?a.showPopup({title:r.save_draft_title,message:r.save_draft_message,buttons:[{id:"save",type:"default",text:r.save_draft_save},{id:"discard",type:"destructive",text:r.save_draft_discard},{id:"cancel",type:"cancel",text:r.save_draft_cancel}]},c=>{c==="save"?(I(),a.HapticFeedback.notificationOccurred("success"),a.close()):c==="discard"&&(T(),a.close())}):a.close()};return E.current=t,a.BackButton.onClick(t),()=>{E.current&&a.BackButton.offClick(E.current)}},[p,a,r]),l.useEffect(()=>{a&&(p?a.enableClosingConfirmation():a.disableClosingConfirmation())},[p,a]),l.useEffect(()=>{!a||!s.check_in_date||(w(!0),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{P()},5e3))},[s,a]);const $=l.useCallback(()=>{a&&a.CloudStorage.getItem(D,(t,c)=>{if(!(t||!c))try{const u=JSON.parse(c),m=u.savedAt||0,B=(Date.now()-m)/1e3/60;B<60?a.showPopup({title:r.draft_found_title,message:`${r.draft_found_message}
(${Math.round(B)} –º–∏–Ω. –Ω–∞–∑–∞–¥)`,buttons:[{id:"restore",type:"default",text:r.draft_restore},{id:"new",type:"destructive",text:r.draft_discard}]},J=>{J==="restore"?(delete u.savedAt,o(u),a.HapticFeedback.notificationOccurred("success")):T()}):T()}catch(u){console.error("Draft parse error:",u)}})},[a,r]),P=l.useCallback(()=>{if(!a)return;const t={...s,savedAt:Date.now()};a.CloudStorage.setItem(D,JSON.stringify(t))},[s,a]),I=()=>{_.current&&clearTimeout(_.current),P()},T=l.useCallback(()=>{a&&(a.CloudStorage.removeItem(D),w(!1))},[a]),M=()=>{if(!a)return;const t=a.themeParams,c=document.documentElement;c.style.setProperty("--tg-bg",t.bg_color||"#ffffff"),c.style.setProperty("--tg-text",t.text_color||"#000000"),c.style.setProperty("--tg-hint",t.hint_color||"#999999"),c.style.setProperty("--tg-link",t.link_color||"#168acd"),c.style.setProperty("--tg-button",t.button_color||"#7C3AED"),c.style.setProperty("--tg-button-text",t.button_text_color||"#ffffff"),c.style.setProperty("--tg-secondary-bg",t.secondary_bg_color||"#f4f4f5")},g=(t,c)=>{o(u=>({...u,[t]:c})),t==="location"&&(c==="other"?v(!0):(v(!1),S(""),N(null))),a&&a.HapticFeedback.selectionChanged()},G=async t=>{if(!(!t||t.length<2)){j(!0),N(null),a&&a.HapticFeedback.impactOccurred("light");try{const u=await(await fetch("/api/validate-city",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:t,language:e})})).json();u.isValid?(N(null),o(m=>({...m,location:`custom:${t}`})),a&&a.HapticFeedback.notificationOccurred("success")):(N(u.message),o(m=>({...m,location:void 0})),a&&a.HapticFeedback.notificationOccurred("error"))}catch(c){console.error("City validation error:",c),N(e==="ru"?"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ä–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.":"City validation error. Please try again."),a&&a.HapticFeedback.notificationOccurred("error")}finally{j(!1)}}},V=t=>{S(t),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{G(t)},1e3)},C=(t,c)=>{o(u=>({...u,[t]:c})),a&&a.HapticFeedback.impactOccurred("light")},U=async()=>{if(!a||d)return;const t=a.MainButton;try{if(f(!0),a.HapticFeedback.impactOccurred("medium"),t.showProgress(),t.setText(r.submitting),!L(s,e).isValid)throw new Error("Validation failed");const u=await fetch("/api/tenant-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,form_language:e,initData:a.initData})}),m=await u.json();if(!u.ok||!m.success)throw new Error(m.error||"Server error");t.hideProgress(),t.setText(r.success),a.HapticFeedback.notificationOccurred("success"),T(),a.showPopup({title:r.success_title,message:r.success_message,buttons:[{type:"close",text:r.success_ok}]},()=>{setTimeout(()=>{a.close()},1500)})}catch(c){console.error("Submit error:",c),t.hideProgress(),t.setText(r.submit),a.HapticFeedback.notificationOccurred("error"),a.showPopup({title:r.error_title,message:r.error_message,buttons:[{type:"close",text:r.error_retry}]})}finally{f(!1)}},A=s.check_in_date&&s.check_out_date?O(s.check_in_date,s.check_out_date):0,H=A>0?ne(A,e):"",Y=re(e);return i.jsxs("div",{className:"tenant-form",children:[i.jsxs("header",{className:"tenant-form__header",children:[i.jsxs("h1",{className:"tenant-form__title",children:["üèùÔ∏è ",r.title]}),i.jsxs("div",{className:"language-switcher",children:[i.jsx("button",{className:e==="ru"?"active":"",onClick:()=>{n("ru"),a?.HapticFeedback.impactOccurred("light")},children:"üá∑üá∫ RU"}),i.jsx("button",{className:e==="en"?"active":"",onClick:()=>{n("en"),a?.HapticFeedback.impactOccurred("light")},children:"üá¨üáß EN"})]})]}),i.jsx("div",{className:"divider"}),i.jsxs("div",{className:"tenant-form__content",children:[i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üìç ",r.location_title]}),i.jsxs("div",{className:"section-card",children:[i.jsx("label",{className:"input-label",children:r.location_label}),i.jsxs("select",{value:b||s.location?.startsWith("custom:")?"other":s.location||"",onChange:t=>g("location",t.target.value),className:"input-field select-field",children:[i.jsx("option",{value:"",children:r.location_placeholder}),Y.map(t=>i.jsxs("option",{value:t.id,children:[t.name," ‚Äî ",t.description]},t.id)),i.jsxs("option",{value:"other",children:["‚ûï ",r.other_city]})]}),b&&i.jsxs("div",{className:"custom-city-input",style:{marginTop:"16px"},children:[i.jsx("label",{className:"input-label",children:r.custom_city_label}),i.jsx("input",{type:"text",value:x,onChange:t=>V(t.target.value),placeholder:r.custom_city_placeholder,className:`input-field ${h?"input-error":""}`,disabled:k}),k&&i.jsxs("div",{className:"validation-status validating",children:["‚è≥ ",r.validating_city]}),h&&i.jsxs("div",{className:"validation-status error",children:["‚ùå ",h]}),!k&&!h&&x&&s.location?.startsWith("custom:")&&i.jsxs("div",{className:"validation-status success",children:["‚úÖ ",e==="ru"?"–ì–æ—Ä–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω":"City confirmed"]})]})]})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üìÖ ",r.dates_title]}),i.jsxs("div",{className:"section-card",children:[i.jsx("label",{className:"input-label",children:r.check_in_label}),i.jsx("input",{type:"date",value:s.check_in_date||"",onChange:t=>g("check_in_date",t.target.value),min:new Date().toISOString().split("T")[0],className:"input-field"}),i.jsx("label",{className:"input-label",children:r.check_out_label}),i.jsx("input",{type:"date",value:s.check_out_date||"",onChange:t=>g("check_out_date",t.target.value),min:s.check_in_date||new Date().toISOString().split("T")[0],className:"input-field"}),H&&i.jsxs("div",{className:"duration-display",children:["üìä ",r.duration_label,": ",i.jsx("strong",{children:H})]})]})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üë• ",r.guests_title]}),i.jsxs("div",{className:"section-card",children:[i.jsxs("div",{className:"input-row",children:[i.jsxs("div",{className:"input-group",children:[i.jsx("label",{className:"input-label",children:r.adults_label}),i.jsx("select",{value:s.adults_count||1,onChange:t=>g("adults_count",parseInt(t.target.value)),className:"input-field",children:[...Array(30)].map((t,c)=>i.jsx("option",{value:c+1,children:c+1},c+1))})]}),i.jsxs("div",{className:"input-group",children:[i.jsx("label",{className:"input-label",children:r.children_label}),i.jsx("select",{value:s.children_count||0,onChange:t=>g("children_count",parseInt(t.target.value)),className:"input-field",children:[...Array(11)].map((t,c)=>i.jsx("option",{value:c,children:c},c))})]})]}),i.jsx("label",{className:"input-label",children:r.guest_type_label}),i.jsx("div",{className:"choice-buttons",children:["family","friends","couple","solo"].map(t=>i.jsxs("button",{type:"button",className:`choice-button ${s.guest_type===t?"active":""}`,onClick:()=>C("guest_type",t),children:[t==="family"&&"üë®‚Äçüë©‚Äçüëß",t==="friends"&&"üë•",t==="couple"&&"üíë",t==="solo"&&"üôÇ",i.jsx("span",{children:r[t]})]},t))})]})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üéØ ",r.purpose_title]}),i.jsx("div",{className:"section-card",children:i.jsx("div",{className:"choice-buttons",children:["vacation","work","event","other"].map(t=>i.jsxs("button",{type:"button",className:`choice-button ${s.trip_purpose===t?"active":""}`,onClick:()=>C("trip_purpose",t),children:[t==="vacation"&&"üèñÔ∏è",t==="work"&&"üíº",t==="event"&&"üéâ",t==="other"&&"‚ûï",i.jsx("span",{children:r[t]})]},t))})})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üêæ ",r.pets_title]}),i.jsxs("div",{className:"section-card",children:[i.jsx("p",{className:"section-question",children:r.pets_question}),i.jsxs("div",{className:"choice-buttons choice-buttons--binary",children:[i.jsx("button",{type:"button",className:`choice-button ${s.has_pets===!0?"active":""}`,onClick:()=>C("has_pets",!0),children:r.yes}),i.jsx("button",{type:"button",className:`choice-button ${s.has_pets===!1?"active":""}`,onClick:()=>C("has_pets",!1),children:r.no})]})]})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["‚è±Ô∏è ",r.extension_title]}),i.jsxs("div",{className:"section-card",children:[i.jsx("p",{className:"section-question",children:r.extension_question}),i.jsx("div",{className:"choice-buttons",children:["yes","no","dont_know"].map(t=>i.jsxs("button",{type:"button",className:`choice-button ${s.extension_possible===t?"active":""}`,onClick:()=>C("extension_possible",t),children:[t==="yes"&&r.yes,t==="no"&&r.no,t==="dont_know"&&r.dont_know]},t))})]})]}),i.jsxs("section",{className:"form-section",children:[i.jsxs("h2",{className:"section-title",children:["üí¨ ",r.additional_title]}),i.jsxs("div",{className:"section-card",children:[i.jsx("textarea",{value:s.additional_requirements||"",onChange:t=>g("additional_requirements",t.target.value),placeholder:r.additional_placeholder,className:"input-field textarea-field",rows:4,maxLength:1e3}),i.jsx("p",{className:"hint-text",children:e==="ru"?"(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)":"(optional)"})]})]}),i.jsx("div",{style:{height:"100px"}})]}),i.jsx("footer",{className:"tenant-form__footer",children:i.jsxs("p",{className:"filling-time",children:["‚è±Ô∏è ",r.filling_time]})})]})}export{le as default};
