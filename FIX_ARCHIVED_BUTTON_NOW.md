# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "Show Archived" - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ö–Ω–æ–ø–∫–∞ "Show Archived" —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **(0)** –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –í —Ç–∞–±–ª–∏—Ü–µ `archived_properties` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π!

---

## üìã –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (3 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** (—Å–ª–µ–≤–∞ –≤ –º–µ–Ω—é)

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ **`tmp_rovodev_add_test_archived.sql`** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ.

**–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –ø—Ä—è–º–æ —Å—é–¥–∞:**

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∞—Ä—Ö–∏–≤–Ω—É—é –∑–∞–ø–∏—Å—å
INSERT INTO archived_properties (
    title, property_type, latitude, longitude,
    price, currency, bedrooms, bathrooms, description,
    telegram_user_id, can_restore, archive_reason,
    archived_at, original_created_at, days_active,
    photos, amenities, contact_phone, forward_from_chat_title
) VALUES (
    'TEST - Archived Beach Villa',
    'villa',
    6.0329,  -- Galle, Sri Lanka
    80.2168,
    750, 'USD', 3, 2,
    'Test archived property for debugging. Beautiful beach villa with ocean view.',
    123456789, TRUE, 'user_deleted',
    NOW(), NOW() - INTERVAL '10 days', 10,
    ARRAY['https://via.placeholder.com/800x600?text=Test+Villa'],
    ARRAY['pool', 'wifi', 'kitchen', 'parking'],
    '+94 77 123 4567',
    'Test Property Channel'
);

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º
SELECT COUNT(*) as "–ê—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤" FROM archived_properties;
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
```
–ê—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤: 1
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ
1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **/admin/master-map** (F5)
2. –û—Ç–∫—Ä–æ–π—Ç–µ Admin Panel (–∫–Ω–æ–ø–∫–∞ **‚öôÔ∏è Admin** —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
3. –í–∫–ª—é—á–∏—Ç–µ —á–µ–∫–±–æ–∫—Å **"Show Archived (1)"**
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞ –∫–∞—Ä—Ç–µ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å–µ—Ä—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –º–∞—Ä–∫–µ—Ä –≤ —Ä–∞–π–æ–Ω–µ **Galle** (—é–∂–Ω–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ)

---

## üêõ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤–∫–ª—é—á–∏—Ç–µ "Show Archived".

**–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
```
üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ archived_properties
üìä –§–∏–ª—å—Ç—Ä—ã: {dateFilter: "all", selectedUser: "all", showArchived: true}
üì¶ –ü–æ–ª—É—á–µ–Ω–æ –∏–∑ –±–∞–∑—ã: 1 –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
üì¶ –ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç: {id: 1, title: "TEST - Archived Beach Villa", ...}
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 1 –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
üé® Mapping archived property: [ARCHIVED] TEST - Archived Beach Villa, color: #9ca3af
```

---

## üé® –ö–∞–∫ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å

### –í Admin Panel:
- ‚òëÔ∏è **Show Archived (1)** ‚Üê –ß–∏—Å–ª–æ –±–æ–ª—å—à–µ 0!

### –ù–∞ –∫–∞—Ä—Ç–µ:
- üîò **–°–µ—Ä—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –º–∞—Ä–∫–µ—Ä** –≤ —Ä–∞–π–æ–Ω–µ Galle
- üè∑Ô∏è –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è drawer —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º **[ARCHIVED] TEST - Archived Beach Villa**
- üëª **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 50%** - –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

---

## ‚ùì –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 1: SQL –æ—à–∏–±–∫–∞ "permission denied"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏:

```sql
-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è —Ç–µ—Å—Ç–∞
ALTER TABLE archived_properties DISABLE ROW LEVEL SECURITY;

-- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É
CREATE POLICY "Allow read archived"
  ON archived_properties FOR SELECT
  TO anon, authenticated
  USING (can_restore = true);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:

```bash
# –§–∞–π–ª: database/06_create_archived_properties_table.sql
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û–±—ä–µ–∫—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ JavaScript:
- –û—Ç–∫—Ä–æ–π—Ç–µ F12 ‚Üí Console
- –ò—â–∏—Ç–µ –∫—Ä–∞—Å–Ω—ã–µ –æ—à–∏–±–∫–∏
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å:

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞—Ä—Ö–∏–≤–∞—Ü–∏—é

–û–±—ä–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–æ–≥–¥–∞:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ PropertyDrawer
- ‚úÖ –û–±—ä–µ–∫—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π?)
- ‚úÖ –ê–¥–º–∏–Ω –≤—Ä—É—á–Ω—É—é –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç

### 2. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

–í PropertyDrawer –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É:
```
üîÑ Restore from Archive
```

### 3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∞—Ä—Ö–∏–≤–∞

–í Admin Panel:
- üìÖ –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
- üìÅ –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏—á–∏–Ω–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (user_deleted, expired, admin_archived)
- üë§ –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!)

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —Å:
1. ‚úÖ Admin Panel –≥–¥–µ –≤–∏–¥–Ω–æ "Show Archived (1)" —Å –≥–∞–ª–æ—á–∫–æ–π
2. ‚úÖ –ö–∞—Ä—Ç–∞ —Å —Å–µ—Ä—ã–º –º–∞—Ä–∫–µ—Ä–æ–º –≤ Galle
3. ‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–π PropertyDrawer —Å [ARCHIVED] –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏

–¢–æ–≥–¥–∞ —è –±—É–¥—É –∑–Ω–∞—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

---

**–§–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã:**
- üìÑ `tmp_rovodev_add_test_archived.sql` - SQL –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
- üìÑ `DEBUG_ARCHIVED_BUTTON.md` - –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
- üìÑ `ARCHIVED_BUTTON_STATUS.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `src/components/admin/AdminMasterMap.tsx` - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

üî• **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ `tmp_rovodev_add_test_archived.sql` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É!
