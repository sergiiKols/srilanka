# 🎛️ TELEGRAM BOT - Кнопки и интерфейс

**Дата:** 2026-01-29  
**Система:** Telegram Bot для Арендаторов

---

## 🎯 КОНЦЕПЦИЯ ИНТЕРФЕЙСА

### Главная идея:
**Минимум кнопок, максимум автоматики!**

**80% действий:** Просто forward сообщение → всё работает автоматически  
**20% действий:** Команды и кнопки для управления

---

## 🎨 ИНТЕРФЕЙС БОТА

### **1️⃣ ПЕРВЫЙ ЗАПУСК (/start)**

```
👤 Пользователь: /start

🤖 БОТ ОТВЕЧАЕТ:

┌─────────────────────────────────────────┐
│ 👋 Привет! Я твоя личная записная       │
│ книжка для объектов недвижимости!       │
│                                         │
│ 📝 Как работает:                        │
│ 1. Нашёл объявление? Переслал мне!      │
│ 2. Я автоматически сохраню на карте     │
│ 3. Все объекты в одном месте            │
│                                         │
│ 🎯 Попробуй:                            │
│ Переслать любое сообщение с фото        │
│ или геолокацией объекта!                │
└─────────────────────────────────────────┘

[🗺️ Моя карта] [❓ Помощь] [⚙️ Настройки]
```

**Inline Keyboard (3 кнопки):**
- `🗺️ Моя карта` → callback_data: "view_map"
- `❓ Помощь` → callback_data: "help"
- `⚙️ Настройки` → callback_data: "settings"

---

### **2️⃣ ГЛАВНОЕ МЕНЮ (после /start или команды /menu)**

```
🤖 БОТ:

┌─────────────────────────────────────────┐
│ 📊 Твоя статистика:                     │
│                                         │
│ 🏠 Объектов сохранено: 5                │
│ ⭐ Избранных: 2                         │
│ 📅 Добавлено сегодня: 1                 │
│                                         │
│ 🗺️ Ссылка на карту:                    │
│ https://site.com/map/...                │
└─────────────────────────────────────────┘

┌──────────────┬──────────────┐
│ 🗺️ Моя карта │ 📊 Статистика│
├──────────────┼──────────────┤
│ ⭐ Избранные │ 📝 Последние │
├──────────────┼──────────────┤
│ ❓ Помощь    │ ⚙️ Настройки │
└──────────────┴──────────────┘
```

**Inline Keyboard (6 кнопок, 3 ряда по 2):**

**Ряд 1:**
- `🗺️ Моя карта` → callback: "view_map" → отправляет ссылку
- `📊 Статистика` → callback: "stats" → показывает полную статистику

**Ряд 2:**
- `⭐ Избранные (2)` → callback: "favorites" → список избранных
- `📝 Последние (5)` → callback: "recent" → последние 5 объектов

**Ряд 3:**
- `❓ Помощь` → callback: "help" → инструкция
- `⚙️ Настройки` → callback: "settings" → настройки бота

---

### **3️⃣ ПОСЛЕ FORWARD СООБЩЕНИЯ (основной flow)**

```
👤 Пользователь: [Forward объявление с фото]

🤖 БОТ ОБРАБАТЫВАЕТ... (2-3 секунды)

🤖 БОТ ОТВЕЧАЕТ:

┌─────────────────────────────────────────┐
│ ✅ Объект сохранён!                     │
│                                         │
│ 🏠 Studio, $500/месяц                   │
│ 📍 Негомбо, возле моря                  │
│                                         │
│ 📊 Всего на карте: 6 объектов          │
│                                         │
│ 🗺️ Ссылка:                             │
│ https://site.com/map/...                │
└─────────────────────────────────────────┘

┌──────────────┬──────────────┐
│ 🗺️ Открыть   │ ⭐ В избранное│
│    карту     │              │
├──────────────┼──────────────┤
│ ✏️ Заметка   │ 🗑️ Удалить   │
└──────────────┴──────────────┘
```

**Inline Keyboard (4 кнопки, 2 ряда по 2):**

**Ряд 1:**
- `🗺️ Открыть карту` → type: "url", url: "https://..."
- `⭐ В избранное` → callback: "favorite_{property_id}"

**Ряд 2:**
- `✏️ Добавить заметку` → callback: "add_note_{property_id}"
- `🗑️ Удалить` → callback: "delete_{property_id}"

---

### **4️⃣ КНОПКА "🗺️ МОЯ КАРТА" (нажатие)**

```
👤 Пользователь: [Нажал "🗺️ Моя карта"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ 🗺️ Твоя личная карта                   │
│                                         │
│ 📍 Объектов на карте: 6                 │
│ ⭐ Избранных: 2                         │
│                                         │
│ 🔗 Ссылка (можно делиться):            │
│ https://site.com/map/personal/...       │
│                                         │
│ 💡 Совет: Сохрани эту ссылку или        │
│ отправь её друзьям!                     │
└─────────────────────────────────────────┘

[🌐 Открыть карту] [📱 Поделиться]
```

**Inline Keyboard (2 кнопки):**
- `🌐 Открыть карту` → type: "url", url: личная карта
- `📱 Поделиться` → type: "switch_inline", text: "Смотри мою подборку!"

---

### **5️⃣ КНОПКА "📊 СТАТИСТИКА"**

```
👤 Пользователь: [Нажал "📊 Статистика"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ 📊 Твоя подробная статистика            │
│                                         │
│ 🏠 Всего объектов: 6                    │
│ ⭐ Избранных: 2                         │
│                                         │
│ 📅 По времени:                          │
│ ├─ Сегодня: 1                           │
│ ├─ За неделю: 4                         │
│ └─ За месяц: 6                          │
│                                         │
│ 📍 По городам:                          │
│ ├─ Негомбо: 2 объекта                   │
│ ├─ Хиккадува: 2 объекта                 │
│ ├─ Коломбо: 1 объект                    │
│ └─ Галле: 1 объект                      │
│                                         │
│ 💰 По цене:                             │
│ ├─ Средняя: $625                        │
│ ├─ Минимум: $400                        │
│ └─ Максимум: $1000                      │
│                                         │
│ 📨 Источники:                           │
│ ├─ Forward из групп: 4                  │
│ └─ Forward от друзей: 2                 │
└─────────────────────────────────────────┘

[🗺️ Карта] [⭐ Избранные] [🏠 Меню]
```

**Inline Keyboard (3 кнопки):**
- `🗺️ Карта` → callback: "view_map"
- `⭐ Избранные` → callback: "favorites"
- `🏠 Меню` → callback: "main_menu"

---

### **6️⃣ КНОПКА "⭐ ИЗБРАННЫЕ"**

```
👤 Пользователь: [Нажал "⭐ Избранные"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ⭐ Твои избранные объекты (2)           │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 1️⃣ Studio, $500                        │
│ 📍 Негомбо, возле моря                  │
│ 📅 Добавлено: 3 дня назад               │
│                                         │
│ [🗺️ На карте] [📝 Заметка] [❌ Убрать] │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 2️⃣ House 2BR, $800                     │
│ 📍 Хиккадува                            │
│ 📅 Добавлено: 1 день назад              │
│                                         │
│ [🗺️ На карте] [📝 Заметка] [❌ Убрать] │
└─────────────────────────────────────────┘

[🏠 Главное меню]
```

**Inline Keyboard (для каждого объекта 3 кнопки + 1 общая):**

**Для объекта 1:**
- `🗺️ На карте` → url: "карта с центром на этом объекте"
- `📝 Заметка` → callback: "note_{id}"
- `❌ Убрать из избранного` → callback: "unfavorite_{id}"

**Для объекта 2:**
- Аналогично

**Общая кнопка:**
- `🏠 Главное меню` → callback: "main_menu"

---

### **7️⃣ КНОПКА "📝 ПОСЛЕДНИЕ"**

```
👤 Пользователь: [Нажал "📝 Последние"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ 📝 Последние 5 объектов                 │
└─────────────────────────────────────────┘

1️⃣ Studio $500, Негомбо
   📅 2 часа назад
   [🗺️ Карта] [⭐ В избранное] [🗑️ Удалить]

2️⃣ House 2BR $800, Хиккадува
   📅 1 день назад
   [🗺️ Карта] [⭐ В избранное] [🗑️ Удалить]

3️⃣ Room $350, Коломбо
   📅 2 дня назад
   [🗺️ Карта] [⭐ В избранное] [🗑️ Удалить]

... (ещё 2)

[🏠 Главное меню]
```

---

### **8️⃣ КНОПКА "⚙️ НАСТРОЙКИ"**

```
👤 Пользователь: [Нажал "⚙️ Настройки"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ⚙️ Настройки                            │
│                                         │
│ 🌐 Язык: Русский 🇷🇺                    │
│ 📬 Уведомления: Включены ✅              │
│ 🗺️ Карта по умолчанию: Коломбо         │
│                                         │
│ 🔗 Твоя ссылка:                         │
│ https://site.com/map/...                │
│                                         │
│ 🔐 Токен доступа: aB7cDx                │
│ (секретный, не передавай посторонним!)  │
└─────────────────────────────────────────┘

┌──────────────┬──────────────┐
│ 🌐 Изменить  │ 📬 Уведомления│
│    язык      │              │
├──────────────┼──────────────┤
│ 🔄 Новый     │ 🗑️ Удалить   │
│    токен     │    аккаунт   │
├──────────────┴──────────────┤
│         🏠 Главное меню      │
└──────────────────────────────┘
```

**Inline Keyboard (5 кнопок):**
- `🌐 Изменить язык` → callback: "change_language"
- `📬 Уведомления` → callback: "toggle_notifications"
- `🔄 Новый токен` → callback: "regenerate_token" (подтверждение!)
- `🗑️ Удалить аккаунт` → callback: "delete_account" (подтверждение!)
- `🏠 Главное меню` → callback: "main_menu"

---

### **9️⃣ КНОПКА "❓ ПОМОЩЬ"**

```
👤 Пользователь: [Нажал "❓ Помощь"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ❓ Инструкция                           │
│                                         │
│ 📝 Как добавить объект:                 │
│ 1. Найди объявление с фото              │
│ 2. Нажми "Forward" (переслать)          │
│ 3. Выбери этого бота                    │
│ 4. Готово! Объект на карте ✅           │
│                                         │
│ 🗺️ Как посмотреть карту:               │
│ • Нажми "🗺️ Моя карта"                 │
│ • Или открой ссылку из любого сообщения │
│                                         │
│ ⭐ Как отметить избранное:              │
│ • После сохранения нажми "⭐"           │
│ • Или в меню "⭐ Избранные"             │
│                                         │
│ 📝 Как добавить заметку:                │
│ • Нажми "✏️ Заметка" у объекта         │
│ • Напиши текст заметки                  │
│ • Заметка сохранится автоматически      │
│                                         │
│ 🗑️ Как удалить объект:                 │
│ • Нажми "🗑️ Удалить" у объекта         │
│ • Или открой карту и удали там          │
│                                         │
│ 💡 Совет: Делись ссылкой на карту       │
│ с друзьями - они увидят твою подборку!  │
└─────────────────────────────────────────┘

[📹 Видео-инструкция] [💬 Написать в поддержку]
[🏠 Главное меню]
```

**Inline Keyboard (3 кнопки):**
- `📹 Видео-инструкция` → url: "https://youtube.com/..."
- `💬 Написать в поддержку` → url: "https://t.me/support"
- `🏠 Главное меню` → callback: "main_menu"

---

### **🔟 ДОБАВЛЕНИЕ ЗАМЕТКИ (после нажатия "✏️ Заметка")**

```
👤 Пользователь: [Нажал "✏️ Добавить заметку"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ 📝 Добавление заметки                   │
│                                         │
│ Объект: Studio $500, Негомбо            │
│                                         │
│ Напиши заметку (до 500 символов):       │
│                                         │
│ Например:                               │
│ • "Позвонить завтра утром"              │
│ • "Хороший вид, но далеко от центра"    │
│ • "Спросить про депозит"                │
└─────────────────────────────────────────┘

[❌ Отмена]
```

**State:** Ожидание текста от пользователя

```
👤 Пользователь: "Позвонить завтра утром"

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ✅ Заметка сохранена!                   │
│                                         │
│ Объект: Studio $500, Негомбо            │
│ Заметка: "Позвонить завтра утром"       │
└─────────────────────────────────────────┘

[🗺️ Открыть на карте] [🏠 Главное меню]
```

---

### **1️⃣1️⃣ УДАЛЕНИЕ ОБЪЕКТА (подтверждение)**

```
👤 Пользователь: [Нажал "🗑️ Удалить"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ⚠️ Подтверждение удаления               │
│                                         │
│ Удалить этот объект?                    │
│                                         │
│ 🏠 Studio $500, Негомбо                 │
│ 📅 Добавлено: 3 дня назад               │
│                                         │
│ ⚠️ Это действие нельзя отменить!        │
└─────────────────────────────────────────┘

[✅ Да, удалить] [❌ Отмена]
```

**Inline Keyboard (2 кнопки):**
- `✅ Да, удалить` → callback: "confirm_delete_{id}"
- `❌ Отмена` → callback: "cancel"

```
👤 Пользователь: [Нажал "✅ Да, удалить"]

🤖 БОТ:

┌─────────────────────────────────────────┐
│ ✅ Объект удалён                        │
│                                         │
│ 📊 Осталось на карте: 5 объектов        │
└─────────────────────────────────────────┘

[🗺️ Моя карта] [🏠 Главное меню]
```

---

## 📋 ПОЛНЫЙ СПИСОК КОМАНД

### Текстовые команды:
```
/start     → Приветствие + главное меню
/menu      → Главное меню
/map       → Ссылка на карту
/stats     → Статистика
/help      → Помощь
/settings  → Настройки
/favorites → Избранные объекты
/recent    → Последние 5 объектов
```

### Inline Keyboard кнопки:

| Кнопка | Callback Data | Действие |
|--------|---------------|----------|
| 🗺️ Моя карта | `view_map` | Отправить ссылку на карту |
| 📊 Статистика | `stats` | Показать статистику |
| ⭐ Избранные | `favorites` | Список избранных |
| 📝 Последние | `recent` | Последние 5 объектов |
| ❓ Помощь | `help` | Инструкция |
| ⚙️ Настройки | `settings` | Настройки |
| 🗑️ Удалить | `delete_{id}` | Удалить объект |
| ⭐ В избранное | `favorite_{id}` | Добавить в избранное |
| ✏️ Заметка | `add_note_{id}` | Добавить заметку |
| 🏠 Меню | `main_menu` | Главное меню |

---

## 🔄 ЛОГИКА ОБРАБОТКИ CALLBACK

```typescript
// src/pages/api/telegram-webhook.ts

async function handleCallback(callbackQuery: any) {
  const data = callbackQuery.data;
  const chatId = callbackQuery.message.chat.id;
  
  // View map
  if (data === 'view_map') {
    const tenant = await getTenant(callbackQuery.from.id);
    await sendMessage(chatId, `🗺️ Твоя карта:\n${tenant.personal_map_url}`);
  }
  
  // Stats
  if (data === 'stats') {
    const stats = await getStats(callbackQuery.from.id);
    await sendMessage(chatId, formatStats(stats));
  }
  
  // Favorites
  if (data === 'favorites') {
    const favorites = await getFavorites(callbackQuery.from.id);
    await sendMessage(chatId, formatFavorites(favorites));
  }
  
  // Add to favorite
  if (data.startsWith('favorite_')) {
    const propertyId = data.replace('favorite_', '');
    await markAsFavorite(propertyId);
    await sendMessage(chatId, '⭐ Добавлено в избранное!');
  }
  
  // Delete
  if (data.startsWith('delete_')) {
    const propertyId = data.replace('delete_', '');
    await sendConfirmation(chatId, propertyId);
  }
  
  // Confirm delete
  if (data.startsWith('confirm_delete_')) {
    const propertyId = data.replace('confirm_delete_', '');
    await deleteProperty(propertyId);
    await sendMessage(chatId, '✅ Объект удалён');
  }
  
  // Add note
  if (data.startsWith('add_note_')) {
    const propertyId = data.replace('add_note_', '');
    await setState(callbackQuery.from.id, 'awaiting_note', propertyId);
    await sendMessage(chatId, '📝 Напиши заметку:');
  }
}
```

---

## ✅ ИТОГО - ЧТО ПОЛУЧАЕТ ПОЛЬЗОВАТЕЛЬ

### Главные действия (БЕЗ кнопок):
✅ Forward → автоматическое сохранение

### Быстрый доступ (С кнопками):
✅ Открыть карту - 1 клик  
✅ Статистика - 1 клик  
✅ Избранные - 1 клик  
✅ В избранное - 1 клик после сохранения  
✅ Удалить - 2 клика (с подтверждением)  
✅ Заметка - 1 клик + текст  

**Простой, понятный, удобный интерфейс! 🎉**

---

Понятна логика кнопок? Готовы начать создавать код бота? 🚀
