# üéØ –†–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

**–î–∞—Ç–∞:** 25 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –§–ò–ù–ê–õ–¨–ù–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï

---

## üìã –ü–†–ê–í–ò–õ–¨–ù–´–ô FLOW –°–ò–°–¢–ï–ú–´

### –®–∞–≥ 1: –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –±–æ—Ç
```
1. –ö–ª–∏–µ–Ω—Ç ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç @UnmissableRentalsBot
2. –ù–∞–∂–∏–º–∞–µ—Ç /start
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebApp (—Ñ–æ—Ä–º–∞ —Å —Å–∞–π—Ç–∞)
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
   - –õ–æ–∫–∞—Ü–∏—è (–≥–¥–µ –∏—â–µ—Ç)
   - –î–∞—Ç—ã (–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ)
   - –ë—é–¥–∂–µ—Ç
   - –¢–∏–ø –∂–∏–ª—å—è
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∂–µ–ª–∞–Ω–∏–π
5. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
```

### –®–∞–≥ 2: –ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –≤ Telegram –≥—Ä—É–ø–ø—ã
```
1. –§–æ—Ä–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è
3. –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø–æ—Å—Ç–∏–Ω–≥–∞
   (–∏–∑ –ø—É–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ)
4. –ü—É–±–ª–∏–∫—É–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ —Ü–µ–ª–µ–≤—ã–µ –≥—Ä—É–ø–ø—ã:
   - Bali Housing
   - Ubud Rentals
   - Digital Nomads Bali
   - –ò —Ç.–¥.
5. –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
   - –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
   - –ö–æ–Ω—Ç–∞–∫—Ç –±–æ—Ç–∞ (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤)
```

### –®–∞–≥ 3: –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–∏ –æ—Ç–≤–µ—á–∞—é—Ç
```
1. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ
2. –û—Ç–≤–µ—á–∞—é—Ç –≤ –ª–∏—á–∫—É –∞–∫–∫–∞—É–Ω—Ç—É, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–º–µ—Å—Ç–∏–ª
3. –ü—Ä–∏—Å—ã–ª–∞—é—Ç:
   - –§–æ—Ç–æ –æ–±—ä–µ–∫—Ç–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –¶–µ–Ω—É
   - Geo-–ª–æ–∫–∞—Ü–∏—é (–∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
   - –ö–æ–Ω—Ç–∞–∫—Ç (Telegram username/phone)
```

### –®–∞–≥ 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ
```
1. –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–π –ø–æ—Å—Ç—É–ø–∞—é—Ç –Ω–∞ —Å–∞–π—Ç
2. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
   ‚úÖ –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ geo-—Å—Å—ã–ª–∫–∏
   ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ
   ‚úÖ –ü–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
   ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—É, –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã
   
3. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç:
   ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—é
   ‚úÖ –û—Ç –∏–º–µ–Ω–∏ —Ç–æ–≥–æ –∂–µ –∞–∫–∫–∞—É–Ω—Ç–∞
   ‚úÖ "–£—Ç–æ—á–Ω–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞..."
   
4. –û–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î (properties/offers)
5. –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞ (rental_task)
```

### –®–∞–≥ 5: –û–±—ä–µ–∫—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
```
1. –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Üí –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
2. –°–≤—è–∑–∞–Ω—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º (–µ–≥–æ rental_task)
3. –ù–∞ –∫–∞—Ä—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
```

### –®–∞–≥ 6: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
```
1. –í –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞:
   "üó∫Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ"
   
2. –°—Å—ã–ª–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:
   - ID –∫–ª–∏–µ–Ω—Ç–∞ (user_id –∏–ª–∏ telegram_id)
   - ID –∑–∞–ø—Ä–æ—Å–∞ (rental_task_id)
   
3. –ö–∞—Ä—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
   - –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–≤–≤–µ—Ä—Ö—É)
   - –í—Å–µ –æ–±—ä–µ–∫—Ç—ã, –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã–µ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è–º–∏
   - –†–∞–¥–∏—É—Å 20–∫–º –æ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏
```

### –®–∞–≥ 7: –ö–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –æ–±—ä–µ–∫—Ç
```
1. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ä
2. –í–∏–¥–∏—Ç:
   - –§–æ—Ç–æ
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –¶–µ–Ω—É
   - –ö–æ–Ω—Ç–∞–∫—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è (Telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω)
   
3. –ú–æ–∂–µ—Ç:
   - –ù–∞–ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—é
   - –ü–æ–∑–≤–æ–Ω–∏—Ç—å
   - –î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é
```

---

## üéØ –ö–õ–Æ–ß–ï–í–û–ï –û–¢–õ–ò–ß–ò–ï –û–¢ –ü–†–ï–î–´–î–£–©–ï–ì–û –ü–û–ù–ò–ú–ê–ù–ò–Ø

### –ë—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```
‚ùå –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï –æ–±—ä–µ–∫—Ç—ã –∏–∑ –ë–î –≤ —Ä–∞–¥–∏—É—Å–µ 20–∫–º
‚ùå –ö–ª–∏–µ–Ω—Ç —Å–∞–º –∏—â–µ—Ç –Ω–∞ –æ–±—â–µ–π –∫–∞—Ä—Ç–µ
```

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
```
‚úÖ –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã, –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã–µ 
   –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –ö–û–ù–ö–†–ï–¢–ù–´–ô –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
   
‚úÖ –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –°–í–û–Æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
   —Å –°–í–û–ò–ú–ò –æ—Ç–≤–µ—Ç–∞–º–∏ –æ—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–π

‚úÖ –†–∞–¥–∏—É—Å 20–∫–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ (–µ—Å–ª–∏ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å 
     –ø—Ä–∏—Å–ª–∞–ª –æ–±—ä–µ–∫—Ç —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ)
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—É –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é —Ç–æ—á–∫—É
     –∏ —É–≤–∏–¥–µ—Ç—å, –µ—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ —Ä—è–¥–æ–º
```

---

## üóÑÔ∏è –°–¢–†–£–ö–¢–£–†–ê –ë–î (–ü–†–ê–í–ò–õ–¨–ù–ê–Ø)

### –¢–∞–±–ª–∏—Ü–∞: rental_tasks
```sql
CREATE TABLE rental_tasks (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  telegram_user_id BIGINT,
  
  -- –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
  location TEXT,              -- "Ubud, Bali"
  location_lat DECIMAL(10,8), -- –î–ª—è —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã
  location_lng DECIMAL(11,8),
  check_in DATE,
  check_out DATE,
  budget_min INTEGER,
  budget_max INTEGER,
  property_type TEXT[],
  guests_count INTEGER,
  description TEXT,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  status TEXT DEFAULT 'active', -- active, closed
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- Telegram –∞–∫–∫–∞—É–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–º–µ—Å—Ç–∏–ª –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
  posted_by_account_id UUID REFERENCES telegram_accounts(id),
  posted_at TIMESTAMPTZ,
  
  -- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
  map_link TEXT
);
```

### –¢–∞–±–ª–∏—Ü–∞: telegram_accounts
```sql
CREATE TABLE telegram_accounts (
  id UUID PRIMARY KEY,
  phone VARCHAR(20) UNIQUE NOT NULL,
  telegram_id BIGINT,
  username VARCHAR(100),
  
  -- API credentials (–¥–ª—è Telegram Client API)
  api_id INTEGER,
  api_hash VARCHAR(100),
  session_string TEXT, -- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  
  -- –°—Ç–∞—Ç—É—Å
  is_active BOOLEAN DEFAULT TRUE,
  last_used TIMESTAMPTZ,
  
  -- –î–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  posts_count INTEGER DEFAULT 0,
  daily_limit INTEGER DEFAULT 10,
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞: landlord_responses
```sql
CREATE TABLE landlord_responses (
  id UUID PRIMARY KEY,
  rental_task_id UUID REFERENCES rental_tasks(id),
  
  -- –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è
  telegram_message_id BIGINT,
  landlord_telegram_id BIGINT,
  landlord_username VARCHAR(100),
  
  -- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
  raw_message TEXT,
  photos TEXT[], -- URLs —Ñ–æ—Ç–æ
  geo_link TEXT, -- –ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –∏–ª–∏ coordinates
  
  -- –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  property_id UUID REFERENCES properties(id),
  parsed_at TIMESTAMPTZ,
  needs_clarification BOOLEAN DEFAULT FALSE,
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞: properties (–û–°–¢–ê–Å–¢–°–Ø)
```sql
-- –¢–∞ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ –æ–±—ä–µ–∫—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è 
-- –∏–∑ landlord_responses
```

### –¢–∞–±–ª–∏—Ü–∞: offers (–°–í–Ø–ó–¨)
```sql
CREATE TABLE offers (
  id UUID PRIMARY KEY,
  property_id UUID REFERENCES properties(id),
  rental_task_id UUID REFERENCES rental_tasks(id),
  landlord_response_id UUID REFERENCES landlord_responses(id),
  
  -- –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
  price INTEGER,
  available_from DATE,
  available_to DATE,
  
  -- –ö–æ–Ω—Ç–∞–∫—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è
  landlord_contact TEXT, -- Telegram username –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## üîå API ENDPOINTS (–û–ë–ù–û–í–õ–Å–ù–ù–´–ï)

### 1. –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å
```
POST /api/rental-tasks
Body: {
  user: { telegram_id, username },
  location: "Ubud, Bali",
  check_in: "2026-02-01",
  check_out: "2026-03-01",
  budget: { min: 500, max: 2000 },
  property_type: ["villa", "apartment"],
  guests: 2,
  description: "..."
}

Returns: {
  task_id: "uuid",
  status: "posted",
  message: "–û–±—ä—è–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–æ –≤ 5 –≥—Ä—É–ø–ø–∞—Ö"
}
```

### 2. –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç (webhook –æ—Ç Telegram)
```
POST /api/telegram/incoming-message
Body: {
  message_id: 12345,
  from: { id: 987654, username: "landlord123" },
  text: "I have a villa in Ubud...",
  photos: [...],
  location: { latitude: -8.5069, longitude: 115.2625 }
}

–°–∏—Å—Ç–µ–º–∞:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫ –∫–∞–∫–æ–º—É rental_task –æ—Ç–Ω–æ—Å–∏—Ç—Å—è
2. –°–æ–∑–¥–∞—ë—Ç landlord_response
3. –ü–∞—Ä—Å–∏—Ç –∏ —Å–æ–∑–¥–∞—ë—Ç property/offer
4. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—é
```

### 3. –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
```
GET /api/map/:rental_task_id?user_id=XXX

Returns: {
  task: {
    id, location, dates, budget, description
  },
  center: { lat, lng },
  radius_km: 20,
  offers: [
    {
      id, property_id,
      name, description, price,
      lat, lng,
      photos: [...],
      landlord_contact: "@landlord123"
    }
  ]
}
```

### 4. –ö–ª–∏–µ–Ω—Ç –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥—É—é —Ç–æ—á–∫—É
```
POST /api/map/:rental_task_id/recenter
Body: { new_lat, new_lng }

Returns: {
  offers: [...] // –í —Ä–∞–¥–∏—É—Å–µ 20–∫–º –æ—Ç –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏
}
```

---

## üîÑ WORKFLOW –ü–û–î–†–û–ë–ù–û

### A. Telegram Bot (–∏–Ω–∏—Ü–∏–∞—Ü–∏—è)
```python
# –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç /start
@bot.message_handler(commands=['start'])
def start(message):
    user_id = message.from_user.id
    
    # –û—Ç–∫—Ä—ã–≤–∞–µ–º WebApp —Å —Ñ–æ—Ä–º–æ–π
    keyboard = types.InlineKeyboardMarkup()
    btn = types.InlineKeyboardButton(
        "üè† –ù–∞–π—Ç–∏ –∂–∏–ª—å—ë",
        web_app=types.WebAppInfo(url=f"{SITE_URL}/rental-form")
    )
    keyboard.add(btn)
    
    bot.send_message(
        user_id,
        "–ü—Ä–∏–≤–µ—Ç! –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É –∏ —è —Ä–∞–∑–º–µ—â—É —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å",
        reply_markup=keyboard
    )
```

### B. WebApp —Ñ–æ—Ä–º–∞
```typescript
// src/pages/rental-form.astro
const handleSubmit = async (formData) => {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  const task = await fetch('/api/rental-tasks', {
    method: 'POST',
    body: JSON.stringify(formData)
  }).then(r => r.json());
  
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
  Telegram.WebApp.close();
  
  // –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –±–æ—Ç
};
```

### C. –ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –≤ –≥—Ä—É–ø–ø—ã
```typescript
// src/lib/telegram-poster.ts
export async function postToGroups(task: RentalTask) {
  // 1. –í—ã–±–∏—Ä–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø–æ—Å—Ç–∏–Ω–≥–∞
  const account = await selectAccountForPosting();
  
  // 2. –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
  const text = formatRentalRequest(task);
  
  // 3. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–≤—ã—Ö –≥—Ä—É–ø–ø
  const groups = await getTargetGroups(task.location);
  
  // 4. –ü–æ—Å—Ç–∏–º –≤ –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É
  for (const group of groups) {
    await telegramClient.sendMessage(group.id, text, {
      account: account
    });
  }
  
  // 5. –û–±–Ω–æ–≤–ª—è–µ–º rental_task
  await db.update('rental_tasks', {
    posted_by_account_id: account.id,
    posted_at: new Date(),
    status: 'active'
  });
}
```

### D. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–π
```typescript
// Webhook –æ—Ç Telegram Client API
export async function handleIncomingMessage(message: TelegramMessage) {
  // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫ –∫–∞–∫–æ–º—É rental_task –æ—Ç–Ω–æ—Å–∏—Ç—Å—è
  const task = await findRelatedTask(message);
  
  if (!task) return; // –ù–µ –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  
  // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
  const response = await db.insert('landlord_responses', {
    rental_task_id: task.id,
    telegram_message_id: message.id,
    landlord_telegram_id: message.from.id,
    landlord_username: message.from.username,
    raw_message: message.text,
    photos: message.photos?.map(p => p.url),
    geo_link: extractGeoLink(message.text) || message.location
  });
  
  // 3. –ü–∞—Ä—Å–∏–º –∏ —Å–æ–∑–¥–∞—ë–º property
  const property = await parseAndCreateProperty(response);
  
  // 4. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º
  if (!property.complete) {
    await askForClarification(task, response);
  }
  
  // 5. –°–æ–∑–¥–∞—ë–º offer
  await db.insert('offers', {
    property_id: property.id,
    rental_task_id: task.id,
    landlord_response_id: response.id,
    landlord_contact: message.from.username
  });
  
  // 6. –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
  await notifyClient(task, property);
}
```

### E. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç—É
```typescript
// –ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
export async function sendMapLinkToClient(task: RentalTask) {
  const mapUrl = `${SITE_URL}/map/${task.id}?user=${task.telegram_user_id}`;
  
  await bot.sendMessage(task.telegram_user_id, 
    `üó∫Ô∏è –ü–æ—Å–º–æ—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ:\n${mapUrl}\n\n` +
    `–ù–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${task.offers_count}`
  );
}
```

---

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è —Ä–∞–∑–¥–µ–ª–∞–º–∏?
