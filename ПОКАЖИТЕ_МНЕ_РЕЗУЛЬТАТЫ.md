# üîç –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

## üìã –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: **`–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ê–†–•–ò–í–ê–¶–ò–ò.sql`**
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)

## üìä –®–∞–≥ 2: –ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–°–∫—Ä–∏–ø—Ç –≤—ã–¥–∞—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:

### –¢–∞–±–ª–∏—Ü–∞ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
```
table_name            | exists
----------------------|-------
saved_properties      | true/false
archived_properties   | true/false
```

### –¢–∞–±–ª–∏—Ü–∞ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
```
function_name          | exists | status
-----------------------|--------|------------------
archive_property       | ...    | ‚úÖ –∏–ª–∏ ‚ùå
soft_delete_property   | ...    | ‚úÖ –∏–ª–∏ ‚ùå
restore_property       | ...    | ‚úÖ –∏–ª–∏ ‚ùå
```

### –¢–∞–±–ª–∏—Ü–∞ 3: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
```
table_name            | total_records | marked_deleted/can_restore
----------------------|---------------|---------------------------
saved_properties      | 1             | 0
archived_properties   | ?             | ?
```

### –¢–∞–±–ª–∏—Ü–∞ 4-5: –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∏–∑ saved_properties
- –í—Å–µ –∏–∑ archived_properties

### –¢–∞–±–ª–∏—Ü–∞ 6: RLS –ø–æ–ª–∏—Ç–∏–∫–∏

### –¢–∞–±–ª–∏—Ü–∞ 7: –ò—Ç–æ–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```
check_1 | check_2 | check_3 | check_4 | check_5
--------|---------|---------|---------|--------
‚úÖ –∏–ª–∏ ‚ùå | ‚úÖ –∏–ª–∏ ‚ùå | ‚úÖ –∏–ª–∏ ‚ùå | N –∑–∞–ø–∏—Å–µ–π | ...
```

---

## üí° –ß—Ç–æ —è —É–∑–Ω–∞—é –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

1. **–°—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏** `archive_property` –∏ `soft_delete_property`
2. **–ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏** –≤ `archived_properties`
3. **–†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏—è** –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
4. **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** - –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø
5. **–ï—Å—Ç—å –ª–∏ "–º—ë—Ä—Ç–≤—ã–µ" –∑–∞–ø–∏—Å–∏** —Å `deleted_at` –≤ saved_properties

---

## üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ü—Ä–æ–±–ª–µ–º–∞ –ê: –§—É–Ω–∫—Ü–∏–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã (‚ùå)
**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL-—Å–∫—Ä–∏–ø—Ç—ã:
- `database/06_create_archived_properties_table.sql`
- `database/07_setup_archive_logic.sql`

### –ü—Ä–æ–±–ª–µ–º–∞ –ë: –ê—Ä—Ö–∏–≤ –ø—É—Å—Ç (0 –∑–∞–ø–∏—Å–µ–π)
**–ü—Ä–∏—á–∏–Ω—ã:**
1. –§—É–Ω–∫—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç (–æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ)
2. RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—Ç–∞–≤–∫—É
3. –í—ã –Ω–µ —É–¥–∞–ª—è–ª–∏ –æ–±—ä–µ–∫—Ç—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∑–∞–Ω–æ–≤–æ –¥–ª—è —Ç–µ—Å—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞ –í: RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ
**–°–∏–º–ø—Ç–æ–º:** –§—É–Ω–∫—Ü–∏–∏ –µ—Å—Ç—å, –∑–∞–ø–∏—Å–∏ –µ—Å—Ç—å, –Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0
**–†–µ—à–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è anon

---

## üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ SQL Editor** –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –æ—Ç–≤–µ—Ç.

–ú–æ–∂–Ω–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º - –∫–∞–∫ —É–¥–æ–±–Ω–æ! 

–Ø —Å—Ä–∞–∑—É —Å–∫–∞–∂—É –≤ —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å! üöÄ

---

## üöÄ –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ:

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
INSERT INTO saved_properties (
    telegram_user_id, latitude, longitude,
    title, property_type, price, currency
) VALUES (
    999999999, 6.0329, 80.2168,
    '–¢–ï–°–¢ - –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—è', 'apartment', 500, 'USD'
)
RETURNING id;

-- 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–º–µ—Å—Ç–æ 'ID_–°–Æ–î–ê':
SELECT soft_delete_property('ID_–°–Æ–î–ê'::UUID, 999999999, 'test_deletion');

-- 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–¥–∞ –ø–æ–ø–∞–ª:
SELECT COUNT(*) as "–í saved_properties" FROM saved_properties WHERE telegram_user_id = 999999999;
SELECT COUNT(*) as "–í archived_properties" FROM archived_properties WHERE telegram_user_id = 999999999;
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** 0 –≤ saved_properties, 1 –≤ archived_properties

---

**–ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!** üòä
