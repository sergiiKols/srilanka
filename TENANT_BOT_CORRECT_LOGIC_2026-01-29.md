# üìí TELEGRAM –ë–û–¢ –î–õ–Ø –ê–†–ï–ù–î–ê–¢–û–†–û–í - "–ó–ê–ü–ò–°–ù–ê–Ø –ö–ù–ò–ñ–ö–ê"

**–î–∞—Ç–∞:** 2026-01-29  
**–í–µ—Ä—Å–∏—è:** 2.0 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ)  
**–ö–ª–∏–µ–Ω—Ç:** –ê–†–ï–ù–î–ê–¢–û–†–´ (tenants) - –∏—â—É—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è —Å–µ–±—è

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:

**–ê–†–ï–ù–î–ê–¢–û–†–´ (tenants)** - –ª—é–¥–∏ –∫–æ—Ç–æ—Ä—ã–µ:
- üîç –ò—â—É—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è –∞—Ä–µ–Ω–¥—ã
- üìù –ù–∞—Ö–æ–¥—è—Ç –æ–±—ä–µ–∫—Ç—ã –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û (Google Maps, —Å–∞–π—Ç—ã, —É–ª–∏—Ü–∞)
- üíæ –•–æ—Ç—è—Ç –°–û–•–†–ê–ù–ò–¢–¨ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Å–µ–±—è
- üó∫Ô∏è –•–æ—Ç—è—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ —Å–≤–æ–∏ –Ω–∞—Ö–æ–¥–∫–∏ –Ω–∞ –õ–ò–ß–ù–û–ô –∫–∞—Ä—Ç–µ

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞":

```
–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞—à—ë–ª –≤–∏–ª–ª—É ‚Üí –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–ª ‚Üí –°–∫–∏–Ω—É–ª –≤ –±–æ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ
–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä —É–≤–∏–¥–µ–ª –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Üí –°–∫–æ–ø–∏—Ä–æ–≤–∞–ª —Å—Å—ã–ª–∫—É ‚Üí –°–∫–∏–Ω—É–ª –≤ –±–æ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ
–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞—à—ë–ª –Ω–∞ –∫–∞—Ä—Ç–µ ‚Üí –û—Ç–º–µ—Ç–∏–ª –º–µ—Å—Ç–æ ‚Üí –°–∫–∏–Ω—É–ª –≤ –±–æ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ

–í—Å–µ –æ–±—ä–µ–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –õ–ò–ß–ù–û–ô –∫–∞—Ä—Ç–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
–ù–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –∏—Ö –Ω–µ –≤–∏–¥–∏—Ç!
```

---

## üîÑ –ü–û–õ–ù–´–ô FLOW

### 1Ô∏è‚É£ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: `/start`

**–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
```
üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å 
   –Ω–∞–π–¥–µ–Ω–Ω—É—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ.

–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:

[üì§ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç]    [üó∫Ô∏è –ú–æ—è –∫–∞—Ä—Ç–∞]
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä
let tenant = await getTenantByTelegramId(telegram_user_id);

if (!tenant) {
  // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
  tenant = await createTenant({
    telegram_user_id: telegram_user_id,
    username: msg.from.username,
    first_name: msg.from.first_name,
    personal_map_url: `https://site.com/map/${telegram_user_id}`
  });
  
  console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä ${telegram_user_id}`);
  console.log(`üìç –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞: ${tenant.personal_map_url}`);
}
```

---

### 2Ô∏è‚É£ –ö–ù–û–ü–ö–ê #1: "üì§ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç"

**–ö–æ–≥–¥–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç:**

1. **–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:**
   ```
   üì§ –°–æ—Ö—Ä–∞–Ω–∏ –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
   
   –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ:
   ‚Ä¢ üì∑ –§–æ—Ç–æ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
   ‚Ä¢ üìç –°—Å—ã–ª–∫—É Google Maps –∏–ª–∏ –∞–¥—Ä–µ—Å
   ‚Ä¢ üí¨ –û–ø–∏—Å–∞–Ω–∏–µ (—Ü–µ–Ω–∞, –∫–æ–º–Ω–∞—Ç—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
   
   –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É –∏–ª–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏.
   ```

2. **–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ:**

   **–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
   ```
   [–§–æ—Ç–æ 1] [–§–æ—Ç–æ 2]
   
   https://maps.google.com/?q=6.9271,79.8612
   
   2BR villa near beach, Negombo
   $800/month
   WiFi, Pool, Kitchen
   Contact: +94 77 123 4567
   Saw on the street, looks nice!
   ```

3. **–ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**

   ```javascript
   // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
   const photos = extractPhotos(message);
   const googleMapsUrl = extractGoogleMapsUrl(message.text);
   const description = message.text || message.caption;
   
   // –ü–∞—Ä—Å–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ Google Maps URL
   const { lat, lng } = parseGoogleMapsUrl(googleMapsUrl);
   
   // AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   const parsed = await parseDescriptionWithAI(description);
   // –ò–∑–≤–ª–µ–∫–∞–µ—Ç: price, bedrooms, amenities, contact
   
   // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
   const savedProperty = await createSavedProperty({
     tenant_id: tenant.id,
     telegram_user_id: telegram_user_id,
     photos: photos,
     latitude: lat,
     longitude: lng,
     description: description,
     price: parsed.price,
     bedrooms: parsed.bedrooms,
     amenities: parsed.amenities,
     contact_info: parsed.contact,
     notes: "Saved from Telegram" // –ª–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
   });
   ```

4. **–ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:**
   ```
   ‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ç–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é!
   
   üè† 2BR Villa, Negombo
   üí∞ $800/month
   üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 6.9271, 79.8612
   
   [üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É]    [üì§ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë]
   ```

---

### 3Ô∏è‚É£ –ö–ù–û–ü–ö–ê #2: "üó∫Ô∏è –ú–æ—è –∫–∞—Ä—Ç–∞"

**–ö–æ–≥–¥–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç:**

1. **–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É:**
   ```javascript
   const tenant = await getTenantByTelegramId(telegram_user_id);
   const mapUrl = tenant.personal_map_url;
   // https://site.com/map/1000089271
   ```

2. **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
   ```
   üó∫Ô∏è –¢–≤–æ—è –ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏
   
   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: 5
   ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
   
   [–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É üó∫Ô∏è]  ‚Üê –∫–Ω–æ–ø–∫–∞ —Å URL
   ```

3. **–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**

---

## üó∫Ô∏è –õ–ò–ß–ù–ê–Ø –ö–ê–†–¢–ê –ê–†–ï–ù–î–ê–¢–û–†–ê

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
https://srilanka-37u2.vercel.app/map/{telegram_user_id}

–ü—Ä–∏–º–µ—Ä:
https://srilanka-37u2.vercel.app/map/1000089271
                                    ^^^^^^^^^^
                                    telegram_user_id –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ:

**–¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞!**

```javascript
// src/pages/map/[telegram_user_id].astro

const { telegram_user_id } = Astro.params;

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data: savedProperties } = await supabase
  .from('saved_properties')
  .select('*')
  .eq('telegram_user_id', telegram_user_id);

// –ù–∏–∫–∞–∫–∏–µ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã!
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–∞—Ä—Ç—ã:

1. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞** (Leaflet)
2. **–ú–∞—Ä–∫–µ—Ä—ã —Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π** (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤)
3. **–ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä ‚Üí Popup:**
   - üñºÔ∏è –°–ª–∞–π–¥–µ—Ä —Ñ–æ—Ç–æ
   - üè† –û–ø–∏—Å–∞–Ω–∏–µ
   - üí∞ –¶–µ–Ω–∞
   - üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã
   - üìù –õ–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)
   - ‚úèÔ∏è –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
   - üóëÔ∏è –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"

4. **–§–∏–ª—å—Ç—Ä—ã:**
   - –ü–æ —Ü–µ–Ω–µ
   - –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–æ–º–Ω–∞—Ç
   - –ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

5. **–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤** (–±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å):
   - –í—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Å–ø–∏—Å–∫–æ–º
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   - –ü–æ–∏—Å–∫

---

## üóÑÔ∏è –°–¢–†–£–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü–∞: `tenants` (–∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã)

```sql
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  telegram_user_id BIGINT UNIQUE NOT NULL,
  username TEXT,
  first_name TEXT,
  last_name TEXT,
  personal_map_url TEXT UNIQUE NOT NULL,
  saved_properties_count INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_active_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_tenants_telegram_id ON tenants(telegram_user_id);
```

### –¢–∞–±–ª–∏—Ü–∞: `saved_properties` (–ª–∏—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤)

```sql
CREATE TABLE saved_properties (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  -- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É
  tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE,
  telegram_user_id BIGINT NOT NULL,
  
  -- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  title TEXT,
  description TEXT,
  notes TEXT, -- –ª–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
  
  -- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  address TEXT,
  google_maps_url TEXT,
  
  -- –î–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞
  property_type TEXT, -- villa, apartment, house, room
  bedrooms INT,
  bathrooms INT,
  area_sqm INT,
  
  -- –§–∏–Ω–∞–Ω—Å—ã
  price DECIMAL(10, 2),
  currency TEXT DEFAULT 'USD',
  price_period TEXT, -- month, night, year
  
  -- –ú–µ–¥–∏–∞
  photos TEXT[], -- –º–∞—Å—Å–∏–≤ URL —Ñ–æ—Ç–æ –∏–∑ Telegram
  
  -- –£–¥–æ–±—Å—Ç–≤–∞
  amenities JSONB, -- {wifi: true, pool: true, kitchen: true, ...}
  
  -- –ö–æ–Ω—Ç–∞–∫—Ç—ã
  contact_info TEXT,
  contact_phone TEXT,
  contact_name TEXT,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  source TEXT DEFAULT 'telegram_bot', -- –æ—Ç–∫—É–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ
  is_favorite BOOLEAN DEFAULT false, -- –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
  viewed_at TIMESTAMPTZ, -- –∫–æ–≥–¥–∞ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_saved_props_tenant ON saved_properties(tenant_id);
CREATE INDEX idx_saved_props_telegram_id ON saved_properties(telegram_user_id);
CREATE INDEX idx_saved_props_location ON saved_properties(latitude, longitude);
CREATE INDEX idx_saved_props_created ON saved_properties(created_at DESC);
```

---

## üì° API ENDPOINTS

### 1. POST `/api/tenant/save-property`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç –æ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ Telegram

**–í—Ö–æ–¥:**
```json
{
  "telegram_user_id": 1000089271,
  "photos": [
    "https://api.telegram.org/file/bot.../photo1.jpg",
    "https://api.telegram.org/file/bot.../photo2.jpg"
  ],
  "google_maps_url": "https://maps.google.com/?q=6.9271,79.8612",
  "description": "2BR villa near beach, $800/month, WiFi, Pool",
  "notes": "Saw on the street, looks nice"
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```javascript
// 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
const tenant = await ensureTenantExists(telegram_user_id);

// 2. –ü–∞—Ä—Å–∏–Ω–≥ Google Maps URL
const { lat, lng } = parseGoogleMapsUrl(google_maps_url);

// 3. AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
const parsed = await parseWithAI(description);

// 4. –°–∫–∞—á–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ –≤ Supabase Storage
const photoUrls = await downloadAndSavePhotos(photos, tenant.id);

// 5. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
const property = await supabase.from('saved_properties').insert({
  tenant_id: tenant.id,
  telegram_user_id: telegram_user_id,
  photos: photoUrls,
  latitude: lat,
  longitude: lng,
  description: description,
  notes: notes,
  ...parsed
});

// 6. –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫
await supabase
  .from('tenants')
  .update({ saved_properties_count: tenant.saved_properties_count + 1 })
  .eq('id', tenant.id);
```

**–í—ã—Ö–æ–¥:**
```json
{
  "success": true,
  "property_id": "uuid-here",
  "map_url": "https://site.com/map/1000089271",
  "saved_count": 6
}
```

---

### 2. GET `/api/tenant/properties/{telegram_user_id}`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞

**–í—ã—Ö–æ–¥:**
```json
{
  "tenant": {
    "telegram_user_id": 1000089271,
    "username": "john_doe",
    "saved_properties_count": 5
  },
  "properties": [
    {
      "id": "uuid-1",
      "title": "2BR Villa Negombo",
      "latitude": 6.9271,
      "longitude": 79.8612,
      "price": 800,
      "photos": ["url1", "url2"],
      "description": "...",
      "notes": "Saw on the street",
      "created_at": "2026-01-29T10:00:00Z"
    }
  ]
}
```

---

## ü§ñ TELEGRAM BOT - –ü—Å–µ–≤–¥–æ–∫–æ–¥

```javascript
const TelegramBot = require('node-telegram-bot-api');
const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN, { polling: true });

// –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const userStates = {};

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  
  // –°–æ–∑–¥–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
  let tenant = await getTenantByTelegramId(userId);
  
  if (!tenant) {
    tenant = await createTenant({
      telegram_user_id: userId,
      username: msg.from.username,
      first_name: msg.from.first_name,
      personal_map_url: `https://site.com/map/${userId}`
    });
    
    await bot.sendMessage(chatId, 
      `‚úÖ –ü—Ä–∏–≤–µ—Ç, ${tenant.first_name}! –¢–≤–æ—è –ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞.`
    );
  }
  
  // –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  bot.sendMessage(chatId, 
    'üìí –¢–≤–æ—è –∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏\n\n–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:', 
    {
      reply_markup: {
        inline_keyboard: [[
          { text: 'üì§ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç', callback_data: 'add' },
          { text: 'üó∫Ô∏è –ú–æ—è –∫–∞—Ä—Ç–∞', url: tenant.personal_map_url }
        ]]
      }
    }
  );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å"
bot.on('callback_query', async (query) => {
  const chatId = query.message.chat.id;
  const userId = query.from.id;
  
  if (query.data === 'add') {
    userStates[userId] = {
      action: 'adding_property',
      photos: [],
      text: ''
    };
    
    await bot.sendMessage(chatId,
      'üì§ –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ:\n' +
      '‚Ä¢ üì∑ –§–æ—Ç–æ –æ–±—ä–µ–∫—Ç–∞\n' +
      '‚Ä¢ üìç Google Maps —Å—Å—ã–ª–∫—É\n' +
      '‚Ä¢ üí¨ –û–ø–∏—Å–∞–Ω–∏–µ (—Ü–µ–Ω–∞, –∫–æ–º–Ω–∞—Ç—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã)\n\n' +
      '–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É –∏–ª–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏.\n' +
      '–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—à—å, –Ω–∞–∂–º–∏ /done'
    );
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç)
bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
  if (msg.text && msg.text.startsWith('/')) {
    if (msg.text === '/done' && userStates[userId]?.action === 'adding_property') {
      await processAddProperty(userId, chatId);
    }
    return;
  }
  
  // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  if (userStates[userId]?.action === 'adding_property') {
    const state = userStates[userId];
    
    // –§–æ—Ç–æ
    if (msg.photo) {
      const photoId = msg.photo[msg.photo.length - 1].file_id;
      const file = await bot.getFile(photoId);
      const photoUrl = `https://api.telegram.org/file/bot${process.env.TELEGRAM_BOT_TOKEN}/${file.file_path}`;
      state.photos.push(photoUrl);
      
      await bot.sendMessage(chatId, `‚úÖ –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (${state.photos.length})`);
    }
    
    // –¢–µ–∫—Å—Ç
    if (msg.text || msg.caption) {
      state.text += (msg.text || msg.caption) + '\n';
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Å—ë
    if (state.photos.length > 0 && state.text.includes('maps.google')) {
      await bot.sendMessage(chatId, 
        '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã!\n\n' +
        `üì∑ –§–æ—Ç–æ: ${state.photos.length}\n` +
        `üìù –û–ø–∏—Å–∞–Ω–∏–µ: –µ—Å—Ç—å\n` +
        `üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –Ω–∞–π–¥–µ–Ω—ã\n\n` +
        '–°–æ—Ö—Ä–∞–Ω—è—é...'
      );
      
      await processAddProperty(userId, chatId);
    }
  }
});

// –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞
async function processAddProperty(userId, chatId) {
  const state = userStates[userId];
  
  if (!state || state.action !== 'adding_property') return;
  
  try {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ API
    const response = await fetch('https://site.com/api/tenant/save-property', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        telegram_user_id: userId,
        photos: state.photos,
        google_maps_url: extractGoogleMapsUrl(state.text),
        description: state.text,
        notes: ''
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      await bot.sendMessage(chatId,
        '‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ç–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é!\n\n' +
        `üìä –í—Å–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${result.saved_count}`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: 'üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É', url: result.map_url },
              { text: 'üì§ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë', callback_data: 'add' }
            ]]
          }
        }
      );
    }
  } catch (error) {
    await bot.sendMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.');
  } finally {
    delete userStates[userId];
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function extractGoogleMapsUrl(text) {
  const match = text.match(/https:\/\/maps\.google\.com\/[^\s]+/);
  return match ? match[0] : null;
}
```

---

## ‚úÖ –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´

### 1. –≠—Ç–æ –õ–ò–ß–ù–´–ô –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:
- ‚ùå –ù–ï –ø—É–±–ª–∏—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- ‚úÖ –ö–∞–∂–¥—ã–π –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ "–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞" –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### 2. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:
- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç –æ–±—ä–µ–∫—Ç—ã –°–ê–ú (—É–ª–∏—Ü–∞, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –¥—Ä—É–∑—å—è)
- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–µ—Ç –∏–ª–∏ –∫–æ–ø–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### 3. –ö–∞—Ä—Ç–∞:
- –õ–∏—á–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
- URL: `/map/{telegram_user_id}`
- –ù–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Import:
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ù–æ –¥–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `saved_properties`
- –ê –Ω–µ –≤ –ø—É–±–ª–∏—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

---

## üéØ –ò–¢–û–ì–û–í–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï

```
–ê–†–ï–ù–î–ê–¢–û–† –∏—â–µ—Ç –∂–∏–ª—å—ë
    ‚Üì
–ù–∞—à—ë–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –æ–±—ä–µ–∫—Ç
    ‚Üì
–û—Ç–ø—Ä–∞–≤–∏–ª –≤ –±–æ—Ç–∞ (—Ñ–æ—Ç–æ + —Å—Å—ã–ª–∫–∞ + –æ–ø–∏—Å–∞–Ω–∏–µ)
    ‚Üì
–ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤ –õ–ò–ß–ù–£–Æ –∫–æ–ª–ª–µ–∫—Ü–∏—é
    ‚Üì
–û–±—ä–µ–∫—Ç –ø–æ—è–≤–∏–ª—Å—è –Ω–∞ –õ–ò–ß–ù–û–ô –∫–∞—Ä—Ç–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
    ‚Üì
–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –º–æ–∂–µ—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏
  - –£–¥–∞–ª—è—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ
  - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
```

**–í—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ?** ‚úÖ
