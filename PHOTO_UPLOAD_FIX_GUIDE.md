# üì∏ –†–£–ö–û–í–û–î–°–¢–í–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

**–î–∞—Ç–∞:** 2026-01-30  
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞  
**–°—Ç–∞—Ç—É—Å:** üîß –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### –®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å Storage Bucket –≤ Supabase

**–í—Ä–µ–º—è:** 2 –º–∏–Ω—É—Ç—ã

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://supabase.com/dashboard
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç: `mcmzdscpuoxwneuzsanu`

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Storage:**
   - –õ–µ–≤–æ–µ –º–µ–Ω—é ‚Üí Storage
   - –ù–∞–∂–º–∏—Ç–µ "Create a new bucket"

3. **–°–æ–∑–¥–∞–π—Ç–µ bucket:**
   ```
   Name: tenant-photos
   Public: ‚úÖ –í–∫–ª—é—á–µ–Ω–æ (–≥–∞–ª–æ—á–∫–∞)
   File size limit: 5 MB
   Allowed MIME types: image/jpeg, image/png, image/jpg, image/webp
   ```

4. **–ù–∞–∂–º–∏—Ç–µ "Create bucket"**

---

### –®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS Policies

**–í—Ä–µ–º—è:** 3 –º–∏–Ω—É—Ç—ã

1. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor:**
   - –õ–µ–≤–æ–µ –º–µ–Ω—é ‚Üí SQL Editor
   - New query

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL:**

```sql
-- ============================================
-- STORAGE BUCKET: tenant-photos
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫
-- ============================================

-- Policy 1: –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–∞—Ö)
CREATE POLICY "Public read access for tenant photos"
ON storage.objects FOR SELECT
USING (bucket_id = 'tenant-photos');

-- Policy 2: –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É (—á–µ—Ä–µ–∑ anon key)
CREATE POLICY "Allow upload for tenant photos"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id = 'tenant-photos');

-- Policy 3: –†–∞–∑—Ä–µ—à–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
CREATE POLICY "Allow update for tenant photos"
ON storage.objects FOR UPDATE
USING (bucket_id = 'tenant-photos')
WITH CHECK (bucket_id = 'tenant-photos');

-- Policy 4: –†–∞–∑—Ä–µ—à–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ
CREATE POLICY "Allow delete for tenant photos"
ON storage.objects FOR DELETE
USING (bucket_id = 'tenant-photos');

-- ============================================
-- –ü–†–û–í–ï–†–ö–ê
-- ============================================

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω
SELECT 
  id,
  name,
  public,
  file_size_limit,
  allowed_mime_types,
  created_at
FROM storage.buckets
WHERE id = 'tenant-photos';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å policies
SELECT 
  policyname,
  cmd AS command,
  qual AS using_clause
FROM pg_policies
WHERE tablename = 'objects'
  AND policyname LIKE '%tenant%';
```

3. **–ù–∞–∂–º–∏—Ç–µ "Run"**

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 1 bucket
   - –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 4 policies

---

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–æ–¥–µ

**–í—Ä–µ–º—è:** 1 –º–∏–Ω—É—Ç–∞

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env`**

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```env
   PUBLIC_SUPABASE_URL=https://mcmzdscpuoxwneuzsanu.supabase.co
   PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   TELEGRAM_BOT_TOKEN=7958965950:AAFg63FTJ46hcRT6M2wSBzn9RHCrzvfV3q8
   ```

3. **–ï—Å–ª–∏ –≤—Å—ë –Ω–∞ –º–µ—Å—Ç–µ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É**

---

### –®–ê–ì 4: –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–í—Ä–µ–º—è:** 2 –º–∏–Ω—É—Ç—ã

1. **–ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git add .
   git commit -m "üêõ Fix: Add detailed photo upload logging"
   git push
   ```

2. **–î–æ–∂–¥–∏—Ç–µ—Å—å –¥–µ–ø–ª–æ—è –Ω–∞ Vercel** (1-2 –º–∏–Ω—É—Ç—ã)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω:**
   - https://vercel.com/dashboard
   - –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Ready"

---

### –®–ê–ì 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Ä–µ–º—è:** 3 –º–∏–Ω—É—Ç—ã

#### **–¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí @AiTechLab_bot**

2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É:**
   ```
   /start
   ```

3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –û–î–ù–û —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º:**
   ```
   üè† Test apartment
   üìç https://maps.google.com/?q=6.9271,79.8612
   üí∞ $500/month
   ```

4. **–ü–æ–¥–æ–∂–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞** (5-10 —Å–µ–∫—É–Ω–¥)

5. **–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å:**
   ```
   ‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!
   üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: 1
   ```

#### **–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Admin –∫–∞—Ä—Ç—É:**
   ```
   https://srilanka-37u2.vercel.app/admin/master-map
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12)**

3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Console**

4. **–ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏:**
   ```
   üì∏ Property xxx: 1 photos [https://...]
   ```

5. **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Ç–∞–∫–æ–π –ª–æ–≥:**
   - ‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∏ URL –ø–æ–ª—É—á–µ–Ω
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
   - –î–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Ñ–æ—Ç–æ

6. **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
   ```
   ‚ùå Property xxx: NO PHOTOS (raw: null)
   ```
   - ‚ùå –§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
   - –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ä–∞–∑–¥–µ–ª—É "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Bucket –Ω–µ —Å–æ–∑–¥–∞–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ùå Storage upload failed: Bucket not found
```

**–†–µ—à–µ–Ω–∏–µ:**
- –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –®–ê–ì 1
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ Dashboard
- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ `database/04_create_storage_bucket.sql`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –§–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–µ—Å—Ç—å URL –≤ –ª–æ–≥–∞—Ö)
- –ù–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ URL ‚Üí 403 Forbidden

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí Storage ‚Üí tenant-photos
2. Settings ‚Üí Make bucket public
3. –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ –®–ê–ì 2

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Policies –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ùå Storage upload failed: new row violates row-level security policy
```

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ –®–ê–ì 2
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ 4 policy —Å–æ–∑–¥–∞–Ω—ã

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –§–æ—Ç–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –±–æ—Ç–∞: `‚úÖ Uploaded 1 photos`
- –ù–æ –Ω–∞ –∫–∞—Ä—Ç–µ: `NO PHOTOS (raw: null)`

**–†–µ—à–µ–Ω–∏–µ:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î:**

```sql
-- –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase
SELECT 
  id,
  title,
  photos,
  created_at
FROM saved_properties
ORDER BY created_at DESC
LIMIT 5;
```

2. **–ï—Å–ª–∏ `photos` = `null` –∏–ª–∏ `{}`:**
   - –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Vercel:
     ```
     https://vercel.com/dashboard ‚Üí Functions ‚Üí Logs
     ```

3. **–ï—Å–ª–∏ `photos` = –º–∞—Å—Å–∏–≤ URL:**
   - –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Console –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## üìä –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

–û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫–∞–º–∏:

- [ ] Bucket `tenant-photos` —Å–æ–∑–¥–∞–Ω –≤ Supabase
- [ ] Bucket –ø—É–±–ª–∏—á–Ω—ã–π (public = true)
- [ ] 4 RLS policies —Å–æ–∑–¥–∞–Ω—ã
- [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel
- [ ] –¢–µ—Å—Ç 1 –ø—Ä–æ–π–¥–µ–Ω (—Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
- [ ] –¢–µ—Å—Ç 2 –ø—Ä–æ–π–¥–µ–Ω (—Ñ–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ)

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

1. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ñ–æ—Ç–æ –≤ Telegram –±–æ—Ç–∞
2. ‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç: "‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: 1"
3. ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ Admin –∫–∞—Ä—Ç—É
4. ‚úÖ –í–∏–¥–∏—Ç–µ –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
5. ‚úÖ –ö–ª–∏–∫–∞–µ—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä
6. ‚úÖ –í–∏–¥–∏—Ç–µ —Ñ–æ—Ç–æ –≤ popup

---

## üìû –ï–°–õ–ò –ù–ï –†–ê–ë–û–¢–ê–ï–¢

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞:**
   ```
   Vercel Dashboard ‚Üí Functions ‚Üí telegram-webhook ‚Üí Logs
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–∞—Ä—Ç—ã:**
   ```
   Browser ‚Üí F12 ‚Üí Console
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Storage:**
   ```
   Supabase Dashboard ‚Üí Storage ‚Üí tenant-photos ‚Üí Files
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î:**
   ```sql
   SELECT * FROM saved_properties ORDER BY created_at DESC LIMIT 1;
   ```

---

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ Storage:

```
tenant-photos/
  ‚îú‚îÄ‚îÄ {telegram_user_id}/           (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1000089271/)
  ‚îÇ   ‚îî‚îÄ‚îÄ {property_uuid}/          (–Ω–∞–ø—Ä–∏–º–µ—Ä: 550e8400-e29b-41d4-a716-446655440000/)
  ‚îÇ       ‚îú‚îÄ‚îÄ photo_1_1738258400000_abc123.jpg
  ‚îÇ       ‚îú‚îÄ‚îÄ photo_2_1738258400001_def456.jpg
  ‚îÇ       ‚îî‚îÄ‚îÄ photo_3_1738258400002_ghi789.jpg
```

### –§–æ—Ä–º–∞—Ç URL:

```
https://mcmzdscpuoxwneuzsanu.supabase.co/storage/v1/object/public/tenant-photos/1000089271/550e8400-e29b-41d4-a716-446655440000/photo_1_1738258400000_abc123.jpg
```

### –ü–æ–ª–µ –≤ –ë–î:

```sql
-- –¢–∞–±–ª–∏—Ü–∞: saved_properties
-- –ü–æ–ª–µ: photos (TEXT[])
-- –ü—Ä–∏–º–µ—Ä:
photos = ARRAY[
  'https://mcmzdscpuoxwneuzsanu.supabase.co/storage/v1/object/public/tenant-photos/...',
  'https://mcmzdscpuoxwneuzsanu.supabase.co/storage/v1/object/public/tenant-photos/...'
]
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-30 21:00  
**–ê–≤—Ç–æ—Ä:** Rovo Dev  
**–í–µ—Ä—Å–∏—è:** 1.0
