import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.JXKNaeUN.js";import{z as n}from"./index.D0-PLK4i.js";function U({formId:h}){const[v,w]=i.useState([]),[_,S]=i.useState(!0),[g,C]=i.useState(0),[o,k]=i.useState(null),[t,x]=i.useState({form_id:h,limit:50,offset:0,sort:"created_at",order:"desc"}),[a,u]=i.useState(null),[b,E]=i.useState(!1),p=async()=>{try{const s=new URLSearchParams;Object.entries(t).forEach(([c,d])=>{d!=null&&s.append(c,String(d))});const r=await(await fetch(`/api/admin/forms/${h}/submissions?${s}`)).json();r.success?(w(r.data||[]),C(r.count||0),k(r.stats||null)):n.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð·Ð°ÑÐ²Ð¾Ðº")}catch(s){console.error("Load submissions error:",s),n.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð·Ð°ÑÐ²Ð¾Ðº")}finally{S(!1)}};i.useEffect(()=>{p()},[t]),i.useEffect(()=>{if(!b)return;const s=setInterval(()=>{p()},1e4);return()=>clearInterval(s)},[b,t]);const D=async()=>{try{n.loading("Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚...",{id:"export"});const s=new URLSearchParams;s.append("export","csv"),Object.entries(t).forEach(([r,c])=>{c!=null&&r!=="limit"&&r!=="offset"&&s.append(r,String(c))});const l=await fetch(`/api/admin/forms/${h}/submissions?${s}`);if(l.ok){const r=await l.blob(),c=window.URL.createObjectURL(r),d=document.createElement("a");d.href=c,d.download=`submissions_${h}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(c),n.success("Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½",{id:"export"})}else n.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð°",{id:"export"})}catch(s){console.error("Export error:",s),n.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð°",{id:"export"})}},R=async s=>{if(confirm("Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð·Ð°ÑÐ²ÐºÑƒ?"))try{(await fetch(`/api/admin/submissions/${s}`,{method:"DELETE"})).ok?(n.success("Ð—Ð°ÑÐ²ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð°"),p()):n.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ")}catch(l){console.error("Delete error:",l),n.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ")}},m=Math.floor(t.offset/t.limit)+1,j=Math.ceil(g/t.limit),y=s=>{x({...t,offset:(s-1)*t.limit})},f=s=>{const l=new Date(s);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(l)},N=s=>{const l={received:"bg-gray-100 text-gray-800",processing:"bg-blue-100 text-blue-800",sent:"bg-green-100 text-green-800",error:"bg-red-100 text-red-800"},r={received:"ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾",processing:"ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°",sent:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾",error:"ÐžÑˆÐ¸Ð±ÐºÐ°"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l[s]}`,children:r[s]})};return _?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[o&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ð’ÑÐµÐ³Ð¾ Ð·Ð°ÑÐ²Ð¾Ðº"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.sent}),e.jsx("div",{className:"text-sm text-gray-600",children:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.errors}),e.jsx("div",{className:"text-sm text-gray-600",children:"ÐžÑˆÐ¸Ð±Ð¾Ðº"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[o.success_rate,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ÑÑ‚ÑŒ"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Ð—Ð°ÑÐ²ÐºÐ¸ (",g,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>E(s.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),"ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ (10Ñ)"]}),e.jsx("button",{onClick:()=>p(),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"}),e.jsx("button",{onClick:D,className:"px-3 py-1 text-sm bg-green-600 text-white hover:bg-green-700 rounded",children:"ðŸ“¥ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[e.jsxs("select",{value:t.status||"",onChange:s=>x({...t,status:s.target.value||void 0,offset:0}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"",children:"Ð’ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹"}),e.jsx("option",{value:"received",children:"ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾"}),e.jsx("option",{value:"processing",children:"ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°"}),e.jsx("option",{value:"sent",children:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾"}),e.jsx("option",{value:"error",children:"ÐžÑˆÐ¸Ð±ÐºÐ°"})]}),e.jsx("input",{type:"date",value:t.date_from||"",onChange:s=>x({...t,date_from:s.target.value||void 0,offset:0}),className:"px-3 py-2 border border-gray-300 rounded text-sm",placeholder:"Ð”Ð°Ñ‚Ð° Ð¾Ñ‚"}),e.jsx("input",{type:"date",value:t.date_to||"",onChange:s=>x({...t,date_to:s.target.value||void 0,offset:0}),className:"px-3 py-2 border border-gray-300 rounded text-sm",placeholder:"Ð”Ð°Ñ‚Ð° Ð´Ð¾"}),e.jsxs("select",{value:t.limit,onChange:s=>x({...t,limit:parseInt(s.target.value),offset:0}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"10",children:"10 Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ"}),e.jsx("option",{value:"25",children:"25 Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ"}),e.jsx("option",{value:"50",children:"50 Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ"}),e.jsx("option",{value:"100",children:"100 Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ"})]})]})]}),v.length===0?e.jsx("div",{className:"bg-white p-12 rounded-lg border border-gray-200 text-center text-gray-500",children:"Ð—Ð°ÑÐ²Ð¾Ðº Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚"}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ð”Ð°Ñ‚Ð°"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ð”Ð°Ð½Ð½Ñ‹Ðµ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:v.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f(s.created_at)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),s.username&&e.jsxs("div",{className:"text-gray-500",children:["@",s.username]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",s.user_id]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N(s.status)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>u(s),className:"text-blue-600 hover:underline",children:"ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsx("button",{onClick:()=>R(s.id),className:"text-red-600 hover:underline",children:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})})]},s.id))})]})}),j>1&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ð¾ ",t.offset+1," - ",Math.min(t.offset+t.limit,g)," Ð¸Ð· ",g]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(m-1),disabled:m===1,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"â† ÐÐ°Ð·Ð°Ð´"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,j)},(s,l)=>{const r=l+1;return e.jsx("button",{onClick:()=>y(r),className:`px-3 py-1 border rounded text-sm ${m===r?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"}`,children:r},r)})}),e.jsx("button",{onClick:()=>y(m+1),disabled:m===j,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Ð’Ð¿ÐµÑ€Ñ‘Ð´ â†’"})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>u(null),children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-auto p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð·Ð°ÑÐ²ÐºÐ¸"}),e.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-gray-600 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"ID Ð·Ð°ÑÐ²ÐºÐ¸"}),e.jsx("div",{className:"font-mono text-sm",children:a.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ"}),e.jsx("div",{children:f(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ"}),e.jsxs("div",{children:[a.first_name," ",a.last_name,a.username&&` (@${a.username})`,e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Telegram ID: ",a.user_id]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ"}),e.jsx("div",{children:N(a.status)})]}),a.error_message&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"ÐžÑˆÐ¸Ð±ÐºÐ°"}),e.jsx("div",{className:"text-red-600 text-sm",children:a.error_message})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ñ‹"}),e.jsx("div",{className:"bg-gray-50 rounded p-4 space-y-2",children:Object.entries(a.data).map(([s,l])=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:s}),e.jsx("div",{className:"font-medium",children:String(l)})]},s))})]}),a.telegram_message_id&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Telegram Message ID"}),e.jsx("div",{className:"font-mono text-sm",children:a.telegram_message_id})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"})})]})})]})}export{U as default};
