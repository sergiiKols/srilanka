# üìä –í–ò–ó–£–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ –î–õ–Ø –ê–†–ï–ù–î–ê–¢–û–†–ê

**–î–∞—Ç–∞:** 2026-01-29  
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å 3 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

---

## üéØ –¢–†–ï–ë–û–í–ê–ù–ò–ï

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É —Å—Ç–∞—Ç—É—Å **3 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**:

1. **üì∑ –§–æ—Ç–æ** (–º–∏–Ω–∏–º—É–º 1, –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
2. **üìç Google Maps —Å—Å—ã–ª–∫–∞** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞)
3. **üìù –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞** (—Ç–µ–∫—Å—Ç —Å –¥–µ—Ç–∞–ª—è–º–∏)

---

## üì± –í–ò–ó–£–ê–õ–¨–ù–û–ï –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–ª—è–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–†–ï–ö–û–ú–ï–ù–î–£–Æ) ‚≠ê‚≠ê‚≠ê

**–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç:**

```
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚¨ú –§–æ—Ç–æ (0)
‚¨ú Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Ç–ø—Ä–∞–≤—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ.

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç] [‚ùå –û—Ç–º–µ–Ω–∞]
```

**–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:**
```
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)             ‚Üê –û–ë–ù–û–í–ò–õ–û–°–¨
‚¨ú Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Ç–ø—Ä–∞–≤—å –µ—â—ë: Google Maps —Å—Å—ã–ª–∫—É –∏ –æ–ø–∏—Å–∞–Ω–∏–µ.

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç] [‚ùå –û—Ç–º–µ–Ω–∞]
```

**–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ Google Maps:**
```
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞   ‚Üê –û–ë–ù–û–í–ò–õ–û–°–¨
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Ç–ø—Ä–∞–≤—å –µ—â—ë: –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞.

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç] [‚ùå –û—Ç–º–µ–Ω–∞]
```

**–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–ø–∏—Å–∞–Ω–∏—è:**
```
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞
‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞     ‚Üê –í–°–Å –ì–û–¢–û–í–û!

üéâ –û–±—ä–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é!

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç] [‚ùå –û—Ç–º–µ–Ω–∞]
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

**–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç:**

```
[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 2 —Ñ–æ—Ç–æ]
    ‚Üì
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:
‚úÖ –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (2 —à—Ç.)

üìä –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:
‚¨ú Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```

```
[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Google Maps]
    ‚Üì
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!
üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 6.9271, 79.8612

üìä –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```

```
[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç]
    ‚Üì
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:
‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!

üéâ –û–±—ä–µ–∫—Ç #1 –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é!
–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç]
```

---

## üíª –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏:

```javascript
class ObjectData {
  constructor(id) {
    this.id = id;
    this.photos = [];
    this.googleMapsUrl = null;
    this.description = null;
    this.createdAt = new Date();
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
  isComplete() {
    return this.photos.length > 0 && 
           this.googleMapsUrl !== null && 
           this.description !== null;
  }
  
  // –°—Ç–∞—Ç—É—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  getStatus() {
    return {
      photos: {
        complete: this.photos.length > 0,
        count: this.photos.length
      },
      googleMaps: {
        complete: this.googleMapsUrl !== null,
        url: this.googleMapsUrl
      },
      description: {
        complete: this.description !== null,
        text: this.description?.substring(0, 50) || null
      }
    };
  }
  
  // –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å
  getMissingItems() {
    const missing = [];
    if (this.photos.length === 0) missing.push('üì∑ –§–æ—Ç–æ');
    if (!this.googleMapsUrl) missing.push('üìç Google Maps —Å—Å—ã–ª–∫–∞');
    if (!this.description) missing.push('üìù –û–ø–∏—Å–∞–Ω–∏–µ');
    return missing;
  }
}

class AddingSession {
  constructor(userId, chatId) {
    this.userId = userId;
    this.chatId = chatId;
    this.objects = [];
    this.currentObject = new ObjectData(1);
    this.statusMessageId = null; // ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º
  }
  
  addPhoto(photoUrl) {
    this.currentObject.photos.push(photoUrl);
  }
  
  addGoogleMaps(url) {
    this.currentObject.googleMapsUrl = url;
  }
  
  addDescription(text) {
    this.currentObject.description = text;
  }
  
  startNextObject() {
    this.objects.push(this.currentObject);
    this.currentObject = new ObjectData(this.objects.length + 1);
    this.statusMessageId = null; // –°–±—Ä–æ—Å–∏—Ç—å ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
  }
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–ª—è–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (editMessageText)

```javascript
const userSessions = {};

// –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
async function updateStatusMessage(bot, session) {
  const status = session.currentObject.getStatus();
  const missing = session.currentObject.getMissingItems();
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
  let text = `üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #${session.currentObject.id}\n\n`;
  text += `üìä –°—Ç–∞—Ç—É—Å:\n`;
  text += `${status.photos.complete ? '‚úÖ' : '‚¨ú'} –§–æ—Ç–æ (${status.photos.count})\n`;
  text += `${status.googleMaps.complete ? '‚úÖ' : '‚¨ú'} Google Maps —Å—Å—ã–ª–∫–∞\n`;
  text += `${status.description.complete ? '‚úÖ' : '‚¨ú'} –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞\n\n`;
  
  if (session.currentObject.isComplete()) {
    text += `üéâ –û–±—ä–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é!`;
  } else {
    text += `–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:\n${missing.join('\n')}`;
  }
  
  const keyboard = {
    inline_keyboard: [[
      { text: '‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å', callback_data: 'save_objects' },
      { text: '‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç', callback_data: 'next_object' },
      { text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: 'cancel_adding' }
    ]]
  };
  
  // –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  if (!session.statusMessageId) {
    // –ü–µ—Ä–≤—ã–π —Ä–∞–∑ - —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const msg = await bot.sendMessage(session.chatId, text, {
      reply_markup: keyboard
    });
    session.statusMessageId = msg.message_id;
  } else {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    try {
      await bot.editMessageText(text, {
        chat_id: session.chatId,
        message_id: session.statusMessageId,
        reply_markup: keyboard
      });
    } catch (error) {
      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–ª–æ)
      // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ
      const msg = await bot.sendMessage(session.chatId, text, {
        reply_markup: keyboard
      });
      session.statusMessageId = msg.message_id;
    }
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
bot.on('callback_query', async (query) => {
  if (query.data === 'add_property') {
    const userId = query.from.id;
    const chatId = query.message.chat.id;
    
    // –°–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é
    const session = new AddingSession(userId, chatId);
    userSessions[userId] = session;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    await updateStatusMessage(bot, session);
  }
  
  if (query.data === 'next_object') {
    const userId = query.from.id;
    const session = userSessions[userId];
    
    if (!session) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω
    if (!session.currentObject.isComplete()) {
      await bot.answerCallbackQuery(query.id, {
        text: '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞!',
        show_alert: true
      });
      return;
    }
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—ä–µ–∫—Ç—É
    session.startNextObject();
    await updateStatusMessage(bot, session);
  }
  
  if (query.data === 'save_objects') {
    const userId = query.from.id;
    const session = userSessions[userId];
    
    if (!session) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
    const allObjects = [...session.objects];
    if (session.currentObject.isComplete()) {
      allObjects.push(session.currentObject);
    }
    
    if (allObjects.length === 0) {
      await bot.answerCallbackQuery(query.id, {
        text: '‚ö†Ô∏è –ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!',
        show_alert: true
      });
      return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
    let saved = 0;
    for (const obj of allObjects) {
      const result = await savePropertyToAPI(userId, obj);
      if (result.success) saved++;
    }
    
    // –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await bot.sendMessage(session.chatId,
      `‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${saved} –∏–∑ ${allObjects.length}\n\n` +
      allObjects.map((o, i) => 
        `${i+1}. ${o.description?.substring(0, 40) || '–û–±—ä–µ–∫—Ç'} (${o.photos.length} —Ñ–æ—Ç–æ)`
      ).join('\n'),
      {
        reply_markup: {
          inline_keyboard: [[
            { text: 'üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É', url: getMapUrl(userId) },
            { text: 'üì§ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë', callback_data: 'add_property' }
          ]]
        }
      }
    );
    
    // –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
    delete userSessions[userId];
  }
  
  if (query.data === 'cancel_adding') {
    const userId = query.from.id;
    delete userSessions[userId];
    
    await bot.sendMessage(query.message.chat.id, '‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.');
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', async (msg) => {
  const userId = msg.from.id;
  const chatId = msg.chat.id;
  const session = userSessions[userId];
  
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
  if (!session) return;
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ
  if (msg.photo) {
    const photoId = msg.photo[msg.photo.length - 1].file_id;
    const file = await bot.getFile(photoId);
    const photoUrl = `https://api.telegram.org/file/bot${process.env.TELEGRAM_BOT_TOKEN}/${file.file_path}`;
    
    session.addPhoto(photoUrl);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    await bot.sendMessage(chatId, `‚úÖ –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (${session.currentObject.photos.length})`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await updateStatusMessage(bot, session);
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
  if (msg.text) {
    const googleMapsUrl = extractGoogleMapsUrl(msg.text);
    
    if (googleMapsUrl) {
      // –≠—Ç–æ Google Maps —Å—Å—ã–ª–∫–∞
      session.addGoogleMaps(googleMapsUrl);
      
      // –ü–∞—Ä—Å–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
      const coords = parseGoogleMapsUrl(googleMapsUrl);
      
      await bot.sendMessage(chatId,
        `‚úÖ Google Maps –¥–æ–±–∞–≤–ª–µ–Ω!\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords.lat}, ${coords.lng}`
      );
    } else {
      // –≠—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
      session.addDescription(msg.text);
      
      await bot.sendMessage(chatId,
        `‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!\nüìù "${msg.text.substring(0, 50)}..."`
      );
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await updateStatusMessage(bot, session);
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ —Å—Ä–∞–∑—É)
  if (msg.media_group_id) {
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Ñ–æ—Ç–æ (–≤—ã—à–µ)
    // Telegram –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
  }
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function extractGoogleMapsUrl(text) {
  const patterns = [
    /https?:\/\/maps\.google\.com\/\?q=[^&\s]+/,
    /https?:\/\/www\.google\.com\/maps\/[^\s]+/,
    /https?:\/\/goo\.gl\/maps\/[^\s]+/
  ];
  
  for (const pattern of patterns) {
    const match = text.match(pattern);
    if (match) return match[0];
  }
  
  return null;
}

function parseGoogleMapsUrl(url) {
  // –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ Google Maps URL
  // –ü—Ä–∏–º–µ—Ä: https://maps.google.com/?q=6.9271,79.8612
  
  let match = url.match(/q=([-\d.]+),([-\d.]+)/);
  if (match) {
    return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };
  }
  
  // –î—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã...
  match = url.match(/@([-\d.]+),([-\d.]+)/);
  if (match) {
    return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };
  }
  
  return null;
}

async function savePropertyToAPI(userId, objectData) {
  const response = await fetch('https://site.com/api/tenant/save-property', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      telegram_user_id: userId,
      photos: objectData.photos,
      google_maps_url: objectData.googleMapsUrl,
      description: objectData.description
    })
  });
  
  return await response.json();
}

function getMapUrl(userId) {
  return `https://srilanka-37u2.vercel.app/map/${userId}`;
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø—Ä–æ—â–µ)

```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', async (msg) => {
  const userId = msg.from.id;
  const chatId = msg.chat.id;
  const session = userSessions[userId];
  
  if (!session) return;
  
  // –§–æ—Ç–æ
  if (msg.photo) {
    const photoUrl = await getPhotoUrl(msg.photo);
    session.addPhoto(photoUrl);
    
    const missing = session.currentObject.getMissingItems();
    
    let response = `‚úÖ –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (${session.currentObject.photos.length} —à—Ç.)\n\n`;
    
    if (missing.length > 0) {
      response += `üìä –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:\n${missing.join('\n')}`;
    } else {
      response += `üéâ –û–±—ä–µ–∫—Ç #${session.currentObject.id} –≥–æ—Ç–æ–≤!`;
    }
    
    await bot.sendMessage(chatId, response);
  }
  
  // Google Maps
  if (msg.text && extractGoogleMapsUrl(msg.text)) {
    const url = extractGoogleMapsUrl(msg.text);
    const coords = parseGoogleMapsUrl(url);
    
    session.addGoogleMaps(url);
    
    const missing = session.currentObject.getMissingItems();
    
    let response = `‚úÖ Google Maps –¥–æ–±–∞–≤–ª–µ–Ω!\nüìç ${coords.lat}, ${coords.lng}\n\n`;
    
    if (missing.length > 0) {
      response += `üìä –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:\n${missing.join('\n')}`;
    } else {
      response += `üéâ –û–±—ä–µ–∫—Ç #${session.currentObject.id} –≥–æ—Ç–æ–≤!`;
    }
    
    await bot.sendMessage(chatId, response);
  }
  
  // –û–ø–∏—Å–∞–Ω–∏–µ
  if (msg.text && !extractGoogleMapsUrl(msg.text)) {
    session.addDescription(msg.text);
    
    const missing = session.currentObject.getMissingItems();
    
    let response = `‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!\nüìù "${msg.text.substring(0, 50)}..."\n\n`;
    
    if (missing.length > 0) {
      response += `üìä –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:\n${missing.join('\n')}`;
    } else {
      response += `üéâ –û–±—ä–µ–∫—Ç #${session.currentObject.id} –≥–æ—Ç–æ–≤!\n–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.`;
    }
    
    await bot.sendMessage(chatId, response);
  }
});
```

---

## üì± –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ

```
[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä] –Ω–∞–∂–∏–º–∞–µ—Ç "üì§ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç"

[–ë–æ—Ç]
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚¨ú –§–æ—Ç–æ (0)
‚¨ú Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Ç–ø—Ä–∞–≤—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä] –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 2 —Ñ–æ—Ç–æ

[–ë–æ—Ç]
‚úÖ –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (2)

(–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å)
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)             ‚Üê –û–ë–ù–û–í–ò–õ–û–°–¨
‚¨ú Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:
üìç Google Maps —Å—Å—ã–ª–∫–∞
üìù –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

---

[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä] –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç https://maps.google.com/?q=6.9271,79.8612

[–ë–æ—Ç]
‚úÖ Google Maps –¥–æ–±–∞–≤–ª–µ–Ω!
üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 6.9271, 79.8612

(–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å)
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞   ‚Üê –û–ë–ù–û–í–ò–õ–û–°–¨
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:
üìù –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

---

[–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä] –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "2BR villa, $800/month, WiFi, Pool"

[–ë–æ—Ç]
‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!
üìù "2BR villa, $800/month, WiFi, Pool"

(–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å)
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞
‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞     ‚Üê –í–°–Å –ì–û–¢–û–í–û!

üéâ –û–±—ä–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é!

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç] [‚ùå –û—Ç–º–µ–Ω–∞]
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 3 –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ–¥—Ä—è–¥

```
[–û–±—ä–µ–∫—Ç #1]
–û—Ç–ø—Ä–∞–≤–∏–ª: —Ñ–æ—Ç–æ + Google Maps + –æ–ø–∏—Å–∞–Ω–∏–µ
–°—Ç–∞—Ç—É—Å: ‚úÖ‚úÖ‚úÖ
–ù–∞–∂–∞–ª: "‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç"

[–û–±—ä–µ–∫—Ç #2]
–û—Ç–ø—Ä–∞–≤–∏–ª: —Ñ–æ—Ç–æ + Google Maps + –æ–ø–∏—Å–∞–Ω–∏–µ
–°—Ç–∞—Ç—É—Å: ‚úÖ‚úÖ‚úÖ
–ù–∞–∂–∞–ª: "‚ûï –ï—â—ë –æ–±—ä–µ–∫—Ç"

[–û–±—ä–µ–∫—Ç #3]
–û—Ç–ø—Ä–∞–≤–∏–ª: —Ñ–æ—Ç–æ + Google Maps + –æ–ø–∏—Å–∞–Ω–∏–µ
–°—Ç–∞—Ç—É—Å: ‚úÖ‚úÖ‚úÖ
–ù–∞–∂–∞–ª: "‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë"

[–ë–æ—Ç]
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: 3

1. 2BR villa, Negombo (2 —Ñ–æ—Ç–æ)
2. 3BR house, Colombo (3 —Ñ–æ—Ç–æ)
3. 1BR apartment, Galle (1 —Ñ–æ—Ç–æ)

[üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É]
```

---

## ‚ö†Ô∏è –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö

### –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç:

```javascript
if (query.data === 'save_objects') {
  const session = userSessions[userId];
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç
  if (!session.currentObject.isComplete()) {
    await bot.answerCallbackQuery(query.id, {
      text: '‚ö†Ô∏è –¢–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω!\n–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è –∏–ª–∏ –Ω–∞–∂–º–∏ "–û—Ç–º–µ–Ω–∞".',
      show_alert: true // –ü–æ–∫–∞–∑–∞—Ç—å –≤ popup
    });
    return;
  }
  
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
}
```

### –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—ä–µ–∫—Ç—É –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ:

```javascript
if (query.data === 'next_object') {
  const session = userSessions[userId];
  
  if (!session.currentObject.isComplete()) {
    const missing = session.currentObject.getMissingItems();
    
    await bot.answerCallbackQuery(query.id, {
      text: `‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç!\n\n–ù–µ–¥–æ—Å—Ç–∞—ë—Ç:\n${missing.join('\n')}`,
      show_alert: true
    });
    return;
  }
  
  // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É...
}
```

---

## üé® –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

```
üì§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ #1

‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë 66%

üìä –°—Ç–∞—Ç—É—Å:
‚úÖ –§–æ—Ç–æ (2)
‚úÖ Google Maps —Å—Å—ã–ª–∫–∞
‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ Google Maps URL
if (!isValidGoogleMapsUrl(url)) {
  await bot.sendMessage(chatId,
    '‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ Google Maps!\n\n' +
    '–û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n' +
    'https://maps.google.com/?q=6.9271,79.8612'
  );
  return;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—è
if (text.length < 10) {
  await bot.sendMessage(chatId,
    '‚ö†Ô∏è –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ!\n–î–æ–±–∞–≤—å –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤).'
  );
  return;
}
```

### 3. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–∞

```
üéâ –û–±—ä–µ–∫—Ç #1 –≥–æ—Ç–æ–≤!

üì∏ –§–æ—Ç–æ: 2 —à—Ç.
üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 6.9271, 79.8612
üìù –û–ø–∏—Å–∞–Ω–∏–µ: 2BR villa, $800/month, WiFi...

[‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [‚ùå –£–¥–∞–ª–∏—Ç—å]
```

---

## ‚úÖ –ò–¢–û–ì–û

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

‚úÖ **3 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:** –§–æ—Ç–æ, Google Maps, –û–ø–∏—Å–∞–Ω–∏–µ  
‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å:** ‚úÖ/‚¨ú –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏  
‚úÖ **–û–±–Ω–æ–≤–ª—è–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:** –û–¥–∏–Ω —Å—Ç–∞—Ç—É—Å-–±–ª–æ–∫ –Ω–∞ –æ–±—ä–µ–∫—Ç  
‚úÖ **–ü–æ–¥—Å–∫–∞–∑–∫–∏:** "–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å: ..."  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–ø–µ—Ä–µ–π—Ç–∏ –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π  
‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

---

**–í—Å—ë –ø–æ–Ω—è—Ç–Ω–æ? –ù–∞—á–∏–Ω–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?** üöÄ
