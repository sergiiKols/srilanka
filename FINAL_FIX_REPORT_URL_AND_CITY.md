# üîß –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã URL –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞

**–î–∞—Ç–∞:** 26 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—ä–µ–∫—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ (Colombo –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üìä –°–µ—Å—Å–∏—è —Ä–∞–±–æ—Ç—ã

**–ò—Ç–µ—Ä–∞—Ü–∏–π:** ~20+  
**–ö–æ–º–º–∏—Ç–æ–≤:** 5  
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 4  

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫**
- **–î–æ:** Perplexity AI –±—ã–ª –ø–µ—Ä–≤—ã–º –º–µ—Ç–æ–¥–æ–º –∏ –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞–ª –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- **–ü–æ—Å–ª–µ:** Server API –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã URL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∏—Å—å**
- **–î–æ:** `/place/lat,lng` –∏ `/search/lat,lng` –ù–ï –∏–∑–≤–ª–µ–∫–∞–ª–∏—Å—å
- **–ü–æ—Å–ª–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º**
- **–î–æ:** –†–∞–¥–∏—É—Å—ã –≥–æ—Ä–æ–¥–æ–≤ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ ‚Üí fallback –Ω–∞ Colombo
- **–ü–æ—Å–ª–µ:** –†–∞–¥–∏—É—Å—ã —É–≤–µ–ª–∏—á–µ–Ω—ã (+50-100%), –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ª–æ–≥–∏–∫–∞

### **–ü—Ä–æ–±–ª–µ–º–∞ 4: –ü–æ–ª–µ area –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å**
- **–î–æ:** AdminMasterMap –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª `area` –∏–∑ `area_name`
- **–ü–æ—Å–ª–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `area: prop.area_name + ', Sri Lanka'`

### **–ü—Ä–æ–±–ª–µ–º–∞ 5: extractGoogleMapsUrl –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏**
- **–î–æ:** `/maps.app.goo.gl/[a-zA-Z0-9]+/` –ù–ï –Ω–∞—Ö–æ–¥–∏–ª `?g_st=it`
- **–ü–æ—Å–ª–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `(\?[^\s]*)?`

### **–ü—Ä–æ–±–ª–µ–º–∞ 6: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL**
- **–î–æ:** –°—Ç–∞—Ä—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–µ—Å—Å–∏–∏ –∏–º–µ–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –Ω–æ–≤—ã–º–∏ –∏–∑ Google Maps URL
- **–ü–æ—Å–ª–µ:** Google Maps URL –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Å–µ—Å—Å–∏–µ–π

---

## ‚úÖ –°–¥–µ–ª–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **–ö–æ–º–º–∏—Ç 1:** `a4a7372` - URL expansion and city detection
**–§–∞–π–ª—ã:**
- `src/utils/googleMapsParser.ts`
- `src/services/perplexityService.ts`
- `src/lib/telegram-bot-ai.ts`
- `src/components/admin/AdminMasterMap.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ (Server API ‚Üí fetch ‚Üí iframe ‚Üí Perplexity AI)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–æ—Ä–º–∞—Ç—ã `/place/lat,lng` –∏ `/search/lat,lng`
- –£–≤–µ–ª–∏—á–µ–Ω—ã —Ä–∞–¥–∏—É—Å—ã –≥–æ—Ä–æ–¥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `area` –≤ AdminMasterMap

### **–ö–æ–º–º–∏—Ç 2:** `9c9ddb9` - Debug logging to parseGoogleMapsURL
**–§–∞–π–ª:** `src/utils/googleMapsParser.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### **–ö–æ–º–º–∏—Ç 3:** `4edcd51` - Debug logging to coordinate extraction
**–§–∞–π–ª:** `src/lib/telegram-bot-ai.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `analyzeTelegramMessage`

### **–ö–æ–º–º–∏—Ç 4:** `e018f65` - Fix extractGoogleMapsUrl URL parameters
**–§–∞–π–ª:** `src/lib/tenant-bot-utils.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `?g_st=it`
- –î–æ–±–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç `g.co/kgs/`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ö–æ–º–º–∏—Ç 5:** `74d5c88` - Prioritize Google Maps URL coordinates
**–§–∞–π–ª:** `src/pages/api/telegram-webhook.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ Google Maps URL —Ç–µ–ø–µ—Ä—å –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ –Ω–∞–¥ —Å–µ—Å—Å–∏–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ override

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå –ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí Colombo (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚ùå Billy Breeze (6.049, 80.288) ‚Üí Colombo
- ‚ùå –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç URL

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- ‚úÖ Billy Breeze (6.049, 80.288) ‚Üí Unawatuna (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
- ‚úÖ URL –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–¢–µ—Å—Ç 1: Billy Breeze Apartment**
**–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:** `https://maps.app.goo.gl/3k4khwBzm2tPtZKN6`  
**–û–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** `6.0490797, 80.2882965`  
**–û–∂–∏–¥–∞–µ–º—ã–π –≥–æ—Ä–æ–¥:** Unawatuna –∏–ª–∏ Galle  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### **–¢–µ—Å—Ç 2: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞**
**–°—Å—ã–ª–∫–∞:** `https://maps.google.com/maps?q=6.019788,80.262268`  
**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** `6.019788, 80.262268`  
**–û–∂–∏–¥–∞–µ–º—ã–π –≥–æ—Ä–æ–¥:** Unawatuna –∏–ª–∏ Galle  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –õ–æ–≥–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è URL**
–ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
üîç Extracting Google Maps URL from text: ...
‚úÖ Found Google Maps URL: https://...
```

–ï—Å–ª–∏ –ù–ï–¢ ‚Üí `extractGoogleMapsUrl` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–æ–¥

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –õ–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞**
–ò—â–∏—Ç–µ:
```
üó∫Ô∏è Parsing Google Maps URL...
‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ï –ö–û–û–†–î–ò–ù–ê–¢–´: ...
```

–ï—Å–ª–∏ –ù–ï–¢ ‚Üí `parseGoogleMapsURL` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞**
–ò—â–∏—Ç–µ:
```
üîÑ Overriding session coordinates with AI result
```

–ï—Å–ª–∏ –ù–ï–¢ ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ `data.googleMapsUrl` –ø—É—Å—Ç–æ–π

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞**
–ò—â–∏—Ç–µ:
```
üìç City determined from coordinates (...): ... (within radius)
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ù–ï Colombo –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ —Ä–∞–π–æ–Ω–µ Galle/Unawatuna

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **–¶–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏:**

```
1. Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
2. extractGoogleMapsUrl(text)
   ‚Üì –Ω–∞—Ö–æ–¥–∏—Ç URL
3. parseGoogleMapsURL(url)
   ‚Üì
4. expandShortUrl(url)
   ‚Üì Server API ‚Üí fetch ‚Üí iframe ‚Üí Perplexity AI
5. extractCoordsFromExpandedUrl(expandedUrl)
   ‚Üì /place/lat,lng –∏–ª–∏ @lat,lng –∏–ª–∏ ?q=lat,lng
6. Coordinates { lat, lng }
   ‚Üì
7. getCityFromCoordinates(lat, lng)
   ‚Üì –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–¥–∏—É—Å–æ–≤ ‚Üí –±–ª–∏–∂–∞–π—à–∏–π –≥–æ—Ä–æ–¥
8. area_name: "Unawatuna"
   ‚Üì
9. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
   ‚Üì
10. AdminMasterMap —á–∏—Ç–∞–µ—Ç area_name
    ‚Üì
11. PropertyDrawer –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Unawatuna, Sri Lanka" ‚úÖ
```

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:**
- `SHORT_URL_FIX_REPORT.md` - —Ä–∞–∑–≤–æ—Ä–æ—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫
- `CITY_DETECTION_FIX_REPORT.md` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
- `FINAL_FIX_REPORT_URL_AND_CITY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### **–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**

1. **–û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é** - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –≤ –±–æ—Ç
2. **–¢–µ—Å—Ç 1:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É Billy Breeze
3. **–¢–µ—Å—Ç 2:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—É—é —Å—Å—ã–ª–∫—É —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç—Ä–æ–∫
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—Ä—Ç—É** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ –≥–æ—Ä–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

### **–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∫–æ–º–º–∏—Ç `74d5c88`)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. –û—á–∏—Å—Ç–∏—Ç—å Docker cache –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å (`docker-compose build --no-cache`)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç `PERPLEXITY_API_KEY`

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω:** ‚úÖ  
**–ó–∞–¥–µ–ø–ª–æ–µ–Ω:** ‚úÖ  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω:** ‚è≥ (–∂–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

**–ê–≤—Ç–æ—Ä:** Rovo Dev  
**–î–∞—Ç–∞:** 26 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ò—Ç–µ—Ä–∞—Ü–∏–π:** 20+  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~3 —á–∞—Å–∞
