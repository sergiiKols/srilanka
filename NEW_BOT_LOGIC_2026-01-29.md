# ü§ñ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´ TELEGRAM –ë–û–¢–ê (–ê–†–ï–ù–î–ê–¢–û–†–´)

**–î–∞—Ç–∞:** 2026-01-29  
**–í–µ—Ä—Å–∏—è:** 2.0 (–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è  
**–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞:** –ê–†–ï–ù–î–ê–¢–û–†–´ (tenants)

---

## üéØ –ö–ê–ö –Ø –ü–û–ù–Ø–õ –ó–ê–î–ê–ß–£ (–ü–†–ê–í–ò–õ–¨–ù–û)

### –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **–ê–†–ï–ù–î–ê–¢–û–†–ê–ú–ò** (tenants), –∫–æ—Ç–æ—Ä—ã–µ:
1. **–ò—â—É—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è —Å–µ–±—è**
2. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –æ–±—ä–µ–∫—Ç—ã** –∫–∞–∫ –ª–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
3. **–ò—Å–ø–æ–ª—å–∑—É—é—Ç –±–æ—Ç–∞ –∫–∞–∫ "–∑–∞–ø–∏—Å–Ω—É—é –∫–Ω–∏–∂–∫—É"**
4. –í–∏–¥—è—Ç —Å–≤–æ–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ **–õ–ò–ß–ù–û–ô –∫–∞—Ä—Ç–µ**

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

‚úÖ **–≠—Ç–æ –ù–ï –ø—É–±–ª–∏—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** –¥–ª—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤  
‚úÖ **–≠—Ç–æ –ª–∏—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤  
‚úÖ **–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã**  
‚úÖ **–ù–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –Ω–µ –≤–∏–¥–∏—Ç –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

### –î–≤–∞ —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:

1. **–ê–†–ï–ù–î–û–î–ê–¢–ï–õ–ò (landlords)** - —Å–¥–∞—é—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –ø—É–±–ª–∏–∫—É—é—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
2. **–ê–†–ï–ù–î–ê–¢–û–†–´ (tenants)** - –∏—â—É—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –≤ –ª–∏—á–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é ‚Üê **–ú–´ –†–ê–ë–û–¢–ê–ï–ú –° –≠–¢–ò–ú –¢–ò–ü–û–ú**

---

## üîÑ –ü–û–õ–ù–´–ô FLOW (–ø–æ—à–∞–≥–æ–≤–æ)

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç `/start`

**–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å 2 –∫–Ω–æ–ø–∫–∞–º–∏:**

```
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CryptoNomads Property Manager!

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:

[üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç]    [üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –º–æ—é –∫–∞—Ä—Ç—É]
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º `/start`:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î (–ø–æ `telegram_user_id`)
- –ï—Å–ª–∏ –ù–ï–¢ ‚Üí —Å–æ–∑–¥–∞—Ç—å:
  - –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –∏–ª–∏ `landlords`
  - –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º URL
  - –ü—Ä–∏–≤—è–∑–∞—Ç—å `telegram_user_id` –∫ `personal_map_url`
- –ï—Å–ª–∏ –î–ê ‚Üí –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã:**
```
URL —Ñ–æ—Ä–º–∞—Ç: https://srilanka-37u2.vercel.app/map/{telegram_user_id}
–ü—Ä–∏–º–µ—Ä: https://srilanka-37u2.vercel.app/map/1000089271
```

---

### –®–∞–≥ 2A: –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç"

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:**
   ```
   üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
   
   –û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:
   1. –§–æ—Ç–æ –æ–±—ä–µ–∫—Ç–∞ (–æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
   2. –°—Å—ã–ª–∫—É –Ω–∞ Google Maps
   3. –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
   
   –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏–ª–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏.
   ```

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ:**
   ```
   –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:
   
   [–§–æ—Ç–æ 1] [–§–æ—Ç–æ 2] [–§–æ—Ç–æ 3]
   
   üìç https://maps.google.com/?q=6.9271,79.8612
   
   üè† –û–ø–∏—Å–∞–Ω–∏–µ:
   2BR villa in Negombo, near beach
   $120/night, WiFi, Pool, Kitchen
   Contact: +94 77 123 4567
   ```

3. **–ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–∫–∞–∫ Import –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ):**

   **–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ Import –Ω–∞ —Å–∞–π—Ç–µ:**
   - –ü–∞—Ä—Å–∏—Ç —Å—Å—ã–ª–∫—É Google Maps ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lng)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ –≤ Supabase Storage
   - –ü–∞—Ä—Å–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (AI –æ–±—Ä–∞–±–æ—Ç–∫–∞)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç:
     - –¢–∏–ø –æ–±—ä–µ–∫—Ç–∞ (villa, apartment, house)
     - –¶–µ–Ω–∞
     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω
     - –£–¥–æ–±—Å—Ç–≤–∞
     - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

4. **–ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î:**
   ```sql
   INSERT INTO properties (
     landlord_id,           -- telegram_user_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     title,                 -- –∏–∑ AI –ø–∞—Ä—Å–∏–Ω–≥–∞
     description,           -- —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     latitude,              -- –∏–∑ Google Maps URL
     longitude,             -- –∏–∑ Google Maps URL
     price,                 -- –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
     photos,                -- –º–∞—Å—Å–∏–≤ URL –∏–∑ Supabase Storage
     amenities,             -- –∏–∑ AI –ø–∞—Ä—Å–∏–Ω–≥–∞
     contact_info,          -- –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
     status                 -- 'active'
   )
   VALUES (...)
   ```

5. **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
   ```
   ‚úÖ –û–±—ä–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!
   
   üè† 2BR Villa, Negombo
   üí∞ $120/night
   üìç 6.9271, 79.8612
   
   –¢–µ–ø–µ—Ä—å –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –≤–∞—à–µ–π –∫–∞—Ä—Ç–µ.
   
   [üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É]    [üì§ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë]
   ```

---

### –®–∞–≥ 2B: –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –º–æ—é –∫–∞—Ä—Ç—É"

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π URL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î:**
   ```javascript
   const user = await getUserByTelegramId(telegram_user_id);
   const mapUrl = user.personal_map_url;
   // –ü—Ä–∏–º–µ—Ä: https://srilanka-37u2.vercel.app/map/1000089271
   ```

2. **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É:**
   ```
   üó∫Ô∏è –í–∞—à–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞!
   
   –ù–∞ –∫–∞—Ä—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤—Å–µ –≤–∞—à–∏ –æ–±—ä–µ–∫—Ç—ã:
   ‚Ä¢ 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞
   ‚Ä¢ 1 –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
   
   [–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É] ‚Üê –∫–Ω–æ–ø–∫–∞ —Å URL
   ```

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ä—Ç—ã**

4. **–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/map/{telegram_user_id}` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ (Leaflet)
   - –ú–∞—Ä–∫–µ—Ä—ã –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (filter: `landlord_id = telegram_user_id`)
   - –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä ‚Üí popup —Å:
     - –§–æ—Ç–æ –æ–±—ä–µ–∫—Ç–∞
     - –ù–∞–∑–≤–∞–Ω–∏–µ
     - –¶–µ–Ω–∞
     - –û–ø–∏—Å–∞–Ω–∏–µ
     - –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" / "–£–¥–∞–ª–∏—Ç—å"

---

## üóÑÔ∏è –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü–∞: `tenants` (–∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã)

```sql
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  telegram_user_id BIGINT UNIQUE NOT NULL,
  username TEXT,
  first_name TEXT,
  personal_map_url TEXT UNIQUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  saved_properties_count INT DEFAULT 0
);
```

### –¢–∞–±–ª–∏—Ü–∞: `saved_properties` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤)

```sql
CREATE TABLE saved_properties (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  tenant_id UUID REFERENCES tenants(id),
  telegram_user_id BIGINT, -- –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
  
  -- –≠—Ç–æ –õ–ò–ß–ù–ê–Ø –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ù–ï –ø—É–±–ª–∏—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
  
  -- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  title TEXT,
  description TEXT,
  
  -- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  address TEXT,
  
  -- –î–µ—Ç–∞–ª–∏
  property_type TEXT, -- villa, apartment, house
  bedrooms INT,
  bathrooms INT,
  price DECIMAL(10, 2),
  currency TEXT DEFAULT 'USD',
  
  -- –ú–µ–¥–∏–∞
  photos TEXT[], -- –º–∞—Å—Å–∏–≤ URL
  
  -- –£–¥–æ–±—Å—Ç–≤–∞
  amenities JSONB, -- {wifi: true, pool: true, kitchen: true}
  
  -- –ö–æ–Ω—Ç–∞–∫—Ç—ã
  contact_info TEXT,
  
  -- –°—Ç–∞—Ç—É—Å
  status TEXT DEFAULT 'active', -- active, pending, inactive
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_properties_telegram_user ON properties(telegram_user_id);
CREATE INDEX idx_properties_location ON properties(latitude, longitude);
```

---

## üé® –°–¢–†–ê–ù–ò–¶–ê `/map/{telegram_user_id}`

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
https://srilanka-37u2.vercel.app/map/1000089271
                                    ^^^^^^^^^^
                                    telegram_user_id
```

### –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

```typescript
// src/pages/map/[telegram_user_id].astro

export async function getStaticPaths() {
  // –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º
  // –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  return [];
}

export const prerender = false; // –î–µ–ª–∞–µ–º SSR

---

const { telegram_user_id } = Astro.params;

// –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data: properties } = await supabase
  .from('properties')
  .select('*')
  .eq('telegram_user_id', telegram_user_id)
  .eq('status', 'active');

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
const { data: landlord } = await supabase
  .from('landlords')
  .select('*')
  .eq('telegram_user_id', telegram_user_id)
  .single();
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

1. **–ö–∞—Ä—Ç–∞ (Leaflet)** —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
2. **–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
   - –§–∏–ª—å—Ç—Ä—ã (—Ü–µ–Ω–∞, —Ç–∏–ø)
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
3. **Popups –Ω–∞ –º–∞—Ä–∫–µ—Ä–∞—Ö:**
   - –§–æ—Ç–æ —Å–ª–∞–π–¥–µ—Ä
   - –ù–∞–∑–≤–∞–Ω–∏–µ
   - –¶–µ–Ω–∞
   - –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"

---

## üîÑ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –°–£–©–ï–°–¢–í–£–Æ–©–ï–ô –°–ò–°–¢–ï–ú–û–ô IMPORT

### –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º Import –ø—Ä–æ—Ü–µ—Å—Å–æ–º:

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å Import –Ω–∞ —Å–∞–π—Ç–µ:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "Import" ‚Üí –í—Å—Ç–∞–≤–ª—è–µ—Ç Google Maps URL
           ‚Üì
    AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç (Groq/Perplexity)
           ‚Üì
    –°–æ–∑–¥–∞—ë—Ç—Å—è POI –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```

**–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ Telegram:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
           ‚Üì
    –ë–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—É –∂–µ –ª–æ–≥–∏–∫—É —á—Ç–æ –∏ Import
           ‚Üì
    API endpoint: POST /api/import-from-telegram
           ‚Üì
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥:
    - googleMapsParser.ts
    - groqService.ts  
    - perplexityService.ts
           ‚Üì
    –°–æ–∑–¥–∞—ë—Ç—Å—è property –≤ –ë–î —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ telegram_user_id
```

---

## üì° API ENDPOINTS (–Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)

### 1. POST `/api/telegram/upload-property`

**–í—Ö–æ–¥:**
```json
{
  "telegram_user_id": 1000089271,
  "photos": ["url1", "url2", "url3"],
  "google_maps_url": "https://maps.google.com/?q=6.9271,79.8612",
  "description": "2BR villa in Negombo..."
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
- –ü–∞—Ä—Å–∏–Ω–≥ Google Maps URL ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ Storage
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `properties`
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ Telegram

**–í—ã—Ö–æ–¥:**
```json
{
  "success": true,
  "property_id": "uuid-here",
  "map_url": "https://srilanka-37u2.vercel.app/map/1000089271"
}
```

### 2. GET `/api/user/map/{telegram_user_id}`

**–í—Ö–æ–¥:** `telegram_user_id` –≤ URL

**–í—ã—Ö–æ–¥:**
```json
{
  "landlord": {
    "telegram_user_id": 1000089271,
    "username": "john_doe",
    "properties_count": 3
  },
  "properties": [
    {
      "id": "uuid-1",
      "title": "2BR Villa Negombo",
      "latitude": 6.9271,
      "longitude": 79.8612,
      "price": 120,
      "photos": ["url1", "url2"],
      "description": "..."
    }
  ]
}
```

---

## ü§ñ TELEGRAM BOT –ö–û–î (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

```javascript
// Telegram Bot handlers

bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  
  // –°–æ–∑–¥–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let user = await getUserByTelegramId(userId);
  
  if (!user) {
    // –ü–µ—Ä–≤—ã–π —Ä–∞–∑ - —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–∞—Ä—Ç—É
    user = await createLandlord({
      telegram_user_id: userId,
      username: msg.from.username,
      first_name: msg.from.first_name,
      personal_map_url: `https://srilanka-37u2.vercel.app/map/${userId}`
    });
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  bot.sendMessage(chatId, 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', {
    reply_markup: {
      inline_keyboard: [[
        { text: 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç', callback_data: 'upload' },
        { text: 'üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É', url: user.personal_map_url }
      ]]
    }
  });
});

bot.on('callback_query', async (query) => {
  if (query.data === 'upload') {
    bot.sendMessage(query.message.chat.id, 
      'üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ:\n1. –§–æ—Ç–æ\n2. Google Maps —Å—Å—ã–ª–∫—É\n3. –û–ø–∏—Å–∞–Ω–∏–µ'
    );
    
    // –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    userState[query.from.id] = 'awaiting_property_data';
  }
});

bot.on('message', async (msg) => {
  const userId = msg.from.id;
  
  if (userState[userId] === 'awaiting_property_data') {
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    const photos = msg.photo ? [msg.photo[msg.photo.length - 1].file_id] : [];
    const text = msg.text || msg.caption || '';
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º Google Maps URL
    const googleMapsUrl = extractGoogleMapsUrl(text);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
    const result = await fetch('/api/telegram/upload-property', {
      method: 'POST',
      body: JSON.stringify({
        telegram_user_id: userId,
        photos: photos,
        google_maps_url: googleMapsUrl,
        description: text
      })
    });
    
    if (result.success) {
      bot.sendMessage(msg.chat.id, '‚úÖ –û–±—ä–µ–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', {
        reply_markup: {
          inline_keyboard: [[
            { text: 'üó∫Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ', url: result.map_url }
          ]]
        }
      });
    }
    
    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
    delete userState[userId];
  }
});
```

---

## ‚úÖ –ò–¢–û–ì–û–í–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï

### –ß—Ç–æ —è –ø–æ–Ω—è–ª:

1. **–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:** –ê–†–ï–ù–î–û–î–ê–¢–ï–õ–ò (landlords), –∞ –Ω–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
2. **–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ Telegram (–≤–º–µ—Å—Ç–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
3. **–î–≤–∞ –¥–µ–π—Å—Ç–≤–∏—è:**
   - üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç ‚Üí Import —á–µ—Ä–µ–∑ Telegram
   - üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞:**
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º `/start`
   - URL: `/map/{telegram_user_id}`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Import:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Google Maps
   - –¢–æ—Ç –∂–µ AI –ø–∞—Ä—Å–∏–Ω–≥ (Groq/Perplexity)
   - –¢–∞ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (properties —Ç–∞–±–ª–∏—Ü–∞)

6. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
   - –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π
   - –ù–µ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å–∞–π—Ç
   - –í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (Telegram)
   - –ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É

---

## üöÄ –ß–¢–û –ù–£–ñ–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨

### Backend:
1. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `landlords` (–∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `users`)
2. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `properties` —Å `telegram_user_id`
3. ‚úÖ API endpoint `/api/telegram/upload-property`
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º Import –∫–æ–¥–æ–º

### Frontend:
1. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/map/[telegram_user_id].astro`
2. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. ‚úÖ Popups —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö

### Telegram Bot:
1. ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/start` —Å 2 –∫–Ω–æ–ø–∫–∞–º–∏
2. ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç"
3. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç + URL)
4. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ API
5. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É" —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π

---

**–í—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª?** ‚úÖ

–ï—Å–ª–∏ –¥–∞ - —Å–∫–∞–∂–∏—Ç–µ "–¥–∞, –≤—Å—ë –≤–µ—Ä–Ω–æ" –∏ —è –Ω–∞—á–Ω—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é! üöÄ
