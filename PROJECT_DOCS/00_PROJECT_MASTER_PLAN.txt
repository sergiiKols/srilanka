═══════════════════════════════════════════════════════════════════════════════
  МАСТЕР-ПЛАН ПРОЕКТА: SRI LANKA PROPERTY MAP PLATFORM
  Real Estate Matching System with AI Integration
═══════════════════════════════════════════════════════════════════════════════

ДАТА СОЗДАНИЯ: 2026-01-24
СТАТУС ПРОЕКТА: Planning Phase
ТЕКУЩИЙ ЭТАП: Architecture & Concept Design

═══════════════════════════════════════════════════════════════════════════════
  ОГЛАВЛЕНИЕ ДОКУМЕНТАЦИИ
═══════════════════════════════════════════════════════════════════════════════

📁 PROJECT_DOCS/
│
├── 00_PROJECT_MASTER_PLAN.txt                    ← ВЫ ЗДЕСЬ
│   └── Общий план проекта, этапы, статус
│
├── 01_TELEGRAM_INTEGRATION_ANALYSIS.txt
│   └── Анализ вариантов интеграции Telegram
│
├── 02_TELEGRAM_CLIENT_API_CONCEPT.txt
│   └── Концепция User Bot (Client API)
│
├── 03_TELEGRAM_CLIENT_API_FULL_CONCEPT.txt
│   └── Полное описание Client API с примерами
│
├── 04_AI_PROCESSING_SCENARIO.txt
│   └── Трёхсторонняя связь с AI обработкой
│
└── [Будущие документы по мере разработки]

═══════════════════════════════════════════════════════════════════════════════
  ОПИСАНИЕ ПРОЕКТА
═══════════════════════════════════════════════════════════════════════════════

НАЗВАНИЕ: Sri Lanka Property Map Platform

ЦЕЛЬ: 
Автоматизированная платформа для подбора недвижимости в Шри-Ланке с 
интеллектуальной обработкой предложений от арендодателей.

ЦЕЛЕВАЯ АУДИТОРИЯ:
- КЛИЕНТЫ: Люди, ищущие недвижимость в Шри-Ланке
- АГЕНТЫ: Property managers, работающие с клиентами
- АРЕНДОДАТЕЛИ: Владельцы недвижимости

CORE ФУНКЦИОНАЛ:
1. Интерактивная карта с POI (рестораны, пляжи, достопримечательности)
2. Персональные карты для каждого клиента с подобранными объектами
3. Автоматический импорт объектов через Telegram
4. AI-обработка предложений от арендодателей
5. Интеллектуальная фильтрация и matching

═══════════════════════════════════════════════════════════════════════════════
  ТЕКУЩЕЕ СОСТОЯНИЕ (ЧТО УЖЕ СДЕЛАНО)
═══════════════════════════════════════════════════════════════════════════════

✅ БАЗА ДАННЫХ POI
   - 2,404 точки интереса (после удаления дубликатов)
   - Категории: food, beach, attraction, spa, culture, hospital, pharmacy и др.
   - 588 ресторанов обогащены (фото, телефон, часы работы)

✅ СТАТИЧЕСКАЯ КАРТА
   - Astro + React
   - Компонент Explorer с фильтрами
   - Leaflet для отображения карты
   - Фильтрация по категориям POI

✅ SUPABASE НАСТРОЕН
   - База данных готова
   - Auth система (email, Google OAuth)
   - RLS (Row Level Security)
   - Real-time подписки

✅ AI СЕРВИСЫ
   - Grok API для анализа описаний
   - Perplexity API для разворачивания ссылок
   - Google Maps Parser

✅ АРХИТЕКТУРА
   - SSR mode (Astro)
   - Middleware для авторизации
   - API endpoints готовы к расширению

═══════════════════════════════════════════════════════════════════════════════
  ДОРОЖНАЯ КАРТА ПРОЕКТА
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ ФАЗА 1: MVP - БАЗОВАЯ ФУНКЦИОНАЛЬНОСТЬ (1-2 недели)                        │
└─────────────────────────────────────────────────────────────────────────────┘

ЭТАП 1.1: Регистрация клиентов через Telegram Bot
   Время: 4-6 часов
   ├─ Создать Telegram бота через @BotFather
   ├─ Команда /start → создание аккаунта клиента
   ├─ API endpoint: POST /api/client/register
   ├─ Генерация уникальной ссылки для клиента
   └─ Отправка ссылки клиенту в Telegram
   
   Результат: Клиент получает yoursite.com/client/SL12345

ЭТАП 1.2: Личная карта клиента
   Время: 3-4 часа
   ├─ Страница /client/[id].astro
   ├─ Загрузка POI (общие для всех)
   ├─ Загрузка properties (уникальные для клиента)
   ├─ Попап с формой заявки
   └─ Отправка заявки на сервер
   
   Результат: Клиент видит карту с POI, может заполнить форму

ЭТАП 1.3: Форма требований клиента
   Время: 2-3 часа
   ├─ Компонент RequestFormPopup.tsx
   ├─ Поля: тип, комнаты, бюджет, район, удобства
   ├─ Валидация формы
   ├─ Отправка в Supabase (client_requests)
   └─ Уведомление агента в Telegram
   
   Результат: Агент получает новую заявку

ЭТАП 1.4: Обработка предложений через Bot (ручная пересылка)
   Время: 4-5 часов
   ├─ Bot получает пересланные сообщения
   ├─ Парсинг кода клиента (#SL12345)
   ├─ Извлечение фото, текста, ссылок
   ├─ Отправка на API: POST /api/import/process
   └─ Проверка полноты данных
   
   Результат: Агент пересылает сообщения → автообработка

ЭТАП 1.5: AI анализ предложений
   Время: 3-4 часа
   ├─ Интеграция Grok API
   ├─ Промпт для анализа соответствия
   ├─ Извлечение данных из текста
   ├─ Генерация вопросов для арендодателя
   └─ Решение: ACCEPT / REQUEST_INFO / REJECT
   
   Результат: AI автоматически анализирует каждое предложение

ЭТАП 1.6: Импорт property на карту клиента
   Время: 4-5 часов
   ├─ Обработка данных (Perplexity + Grok)
   ├─ Разворачивание коротких ссылок
   ├─ Извлечение координат
   ├─ Скачивание фото в Supabase Storage
   ├─ Создание записи в client_properties
   └─ Отображение на карте клиента
   
   Результат: Клиент видит новые объекты на своей карте

┌─────────────────────────────────────────────────────────────────────────────┐
│ ИТОГО ФАЗА 1: ~25-30 часов работы (3-4 дня разработки)                     │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ ФАЗА 2: УЛУЧШЕНИЯ И АВТОМАТИЗАЦИЯ (1-2 недели)                             │
└─────────────────────────────────────────────────────────────────────────────┘

ЭТАП 2.1: Автоматическая обратная связь с арендодателем
   Время: 3-4 часа
   ├─ AI генерирует вопросы естественным языком
   ├─ Bot отправляет вопросы арендодателю
   ├─ Трекинг состояния беседы
   ├─ Повторный анализ при получении ответа
   └─ Автоматический импорт при полноте данных
   
   Результат: Система сама дозапрашивает недостающие данные

ЭТАП 2.2: Dashboard для агента
   Время: 6-8 часов
   ├─ Страница /agent/dashboard
   ├─ Список активных клиентов
   ├─ Статистика по заявкам
   ├─ Список обработанных предложений
   ├─ Ручное управление объектами
   └─ Настройки автоматизации
   
   Результат: Агент видит всю картину в одном месте

ЭТАП 2.3: Уведомления и статусы
   Время: 2-3 часа
   ├─ Email уведомления клиенту
   ├─ Telegram уведомления агенту
   ├─ Статусы заявок (pending, processing, matched)
   ├─ История взаимодействий
   └─ Счётчики и метрики
   
   Результат: Все участники информированы

ЭТАП 2.4: Фильтрация и сортировка на карте клиента
   Время: 3-4 часа
   ├─ Фильтры по цене, комнатам, удобствам
   ├─ Сортировка (по цене, рейтингу, расстоянию)
   ├─ Сохранение избранных объектов
   ├─ Сравнение нескольких объектов
   └─ Экспорт в PDF/Email
   
   Результат: Клиент легко находит лучший вариант

ЭТАП 2.5: Мультиязычность
   Время: 4-5 часов
   ├─ English (основной)
   ├─ Русский (для русскоязычных клиентов)
   ├─ Перевод UI
   ├─ Перевод email/уведомлений
   └─ AI промпты на разных языках
   
   Результат: Доступно для международной аудитории

┌─────────────────────────────────────────────────────────────────────────────┐
│ ИТОГО ФАЗА 2: ~20-25 часов работы (3-4 дня разработки)                     │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ ФАЗА 3: МАСШТАБИРОВАНИЕ (опционально, при росте объёма)                    │
└─────────────────────────────────────────────────────────────────────────────┘

ЭТАП 3.1: Telegram Client API для полной автоматизации
   Время: 8-10 часов
   ├─ Настройка VPS сервера
   ├─ Авторизация Client API
   ├─ Автоматическое чтение личных сообщений
   ├─ Фильтрация по хэштегам
   └─ Интеграция с основным API
   
   Результат: 100% автоматизация без ручной пересылки

ЭТАП 3.2: Аналитика и отчёты
   Время: 6-8 часов
   ├─ Dashboard с метриками
   ├─ Конверсия заявок
   ├─ Популярные локации/типы
   ├─ Средние цены
   └─ Отчёты для агентов
   
   Результат: Бизнес-инсайты и оптимизация

ЭТАП 3.3: Платёжная система (опционально)
   Время: 10-12 часов
   ├─ Stripe интеграция
   ├─ Тарифы для агентов
   ├─ Комиссия за сделку
   ├─ Автоматические счета
   └─ Партнёрская программа
   
   Результат: Монетизация платформы

┌─────────────────────────────────────────────────────────────────────────────┐
│ ИТОГО ФАЗА 3: ~25-30 часов работы (опционально)                            │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
  ПРИОРИТИЗАЦИЯ ЗАДАЧ
═══════════════════════════════════════════════════════════════════════════════

🔥 КРИТИЧЕСКИЕ (начать немедленно):
   ├─ Регистрация клиентов через Telegram Bot
   ├─ Личная карта клиента
   ├─ Форма требований
   └─ Базовый импорт через Bot + ручная пересылка

⭐ ВАЖНЫЕ (сделать в первую очередь):
   ├─ AI анализ предложений
   ├─ Автоматическая обратная связь
   └─ Импорт на карту клиента

✨ ЖЕЛАТЕЛЬНЫЕ (можно отложить):
   ├─ Dashboard для агента
   ├─ Email уведомления
   ├─ Фильтры и сортировка на карте
   └─ Мультиязычность

💎 ОПЦИОНАЛЬНЫЕ (при масштабировании):
   ├─ Client API автоматизация
   ├─ Аналитика
   └─ Платёжная система

═══════════════════════════════════════════════════════════════════════════════
  ТЕХНИЧЕСКИЙ СТЕК
═══════════════════════════════════════════════════════════════════════════════

FRONTEND:
✅ Astro (SSR)
✅ React (интерактивные компоненты)
✅ TypeScript
✅ Leaflet (карты)
✅ Tailwind CSS

BACKEND:
✅ Astro API Routes
✅ Supabase (PostgreSQL + Auth + Storage + Real-time)
✅ Node.js (для Telegram Bot)

EXTERNAL APIS:
✅ Telegram Bot API
✅ Grok AI (анализ текста)
✅ Perplexity AI (разворачивание ссылок)
✅ Google Maps API (координаты, фото)
⚠️ Telegram Client API (опционально, для полной автоматизации)

HOSTING:
✅ Vercel / Netlify (сайт - SSR)
✅ Railway / Render (Telegram Bot)
⚠️ VPS (если Client API) - DigitalOcean, Hetzner

═══════════════════════════════════════════════════════════════════════════════
  ОЦЕНКА СТОИМОСТИ
═══════════════════════════════════════════════════════════════════════════════

РАЗРАБОТКА:
Фаза 1 (MVP): 25-30 часов
Фаза 2 (Улучшения): 20-25 часов
Фаза 3 (Масштабирование): 25-30 часов (опционально)

ИТОГО: ~50-55 часов для полнофункциональной платформы (Фаза 1+2)

ЕЖЕМЕСЯЧНЫЕ РАСХОДЫ:

БЕЗ CLIENT API (рекомендуется для старта):
├─ Hosting (Vercel/Netlify): $0 (free tier)
├─ Supabase: $0 (free tier до 500MB)
├─ Telegram Bot: $0 (free)
├─ Grok AI: $2-5/мес (на 1000 сообщений)
├─ Perplexity: $0 (free tier)
└─ Google Maps API: $0-10/мес (в рамках free tier)
───────────────────────────────────────────
ИТОГО: $2-15/месяц

С CLIENT API (при больших объёмах):
├─ VPS сервер: $5-10/мес
├─ Все остальное: $2-15/мес
───────────────────────────────────────────
ИТОГО: $7-25/месяц

═══════════════════════════════════════════════════════════════════════════════
  РИСКИ И МИТИГАЦИЯ
═══════════════════════════════════════════════════════════════════════════════

РИСК 1: Блокировка Telegram аккаунта (при Client API)
   Вероятность: Низкая
   Влияние: Высокое
   Митигация: 
   ├─ Использовать Bot API для MVP
   ├─ Client API только при большом объёме
   ├─ Использовать отдельный бизнес аккаунт
   └─ Соблюдать rate limits

РИСК 2: Низкое качество данных от арендодателей
   Вероятность: Средняя
   Влияние: Среднее
   Митигация:
   ├─ AI автоматически дозапрашивает данные
   ├─ Валидация обязательных полей
   └─ Ручная модерация сложных случаев

РИСК 3: Спам от недобросовестных арендодателей
   Вероятность: Средняя
   Влияние: Низкое
   Митигация:
   ├─ AI фильтрация спама
   ├─ Blacklist подозрительных контактов
   └─ Капча при регистрации клиента (опционально)

РИСК 4: Превышение лимитов API
   Вероятность: Низкая (при малых объёмах)
   Влияние: Среднее
   Митигация:
   ├─ Мониторинг использования
   ├─ Rate limiting в коде
   └─ Кэширование запросов

РИСК 5: Неправильное matching клиент-объект
   Вероятность: Средняя
   Влияние: Среднее
   Митигация:
   ├─ Улучшение AI промптов
   ├─ Feedback loop от клиентов
   └─ Ручная проверка первых 50-100 объектов

═══════════════════════════════════════════════════════════════════════════════
  МЕТРИКИ УСПЕХА
═══════════════════════════════════════════════════════════════════════════════

MVP (Фаза 1) считается успешным, если:
✅ 10+ клиентов зарегистрировались
✅ 50+ объектов импортировано
✅ 80%+ автоматизация обработки предложений
✅ 5+ успешных сделок (клиент нашёл жильё)
✅ NPS > 8 (Net Promoter Score)

Платформа (Фаза 1+2) считается успешной, если:
✅ 100+ активных клиентов
✅ 500+ объектов в базе
✅ 95%+ автоматизация
✅ 50+ сделок/месяц
✅ Положительный ROI (доход > расходы)

═══════════════════════════════════════════════════════════════════════════════
  СЛЕДУЮЩИЕ ШАГИ
═══════════════════════════════════════════════════════════════════════════════

НЕМЕДЛЕННО (сегодня-завтра):
[⬜] Принять решение: Bot API или Client API для старта
[⬜] Создать Telegram бота через @BotFather
[⬜] Начать разработку ЭТАП 1.1 (регистрация клиентов)

НА ЭТОЙ НЕДЕЛЕ:
[⬜] Завершить Фазу 1 (MVP)
[⬜] Тестирование на 3-5 реальных клиентах
[⬜] Сбор feedback

СЛЕДУЮЩАЯ НЕДЕЛЯ:
[⬜] Начать Фазу 2 (улучшения)
[⬜] Оптимизация на основе feedback
[⬜] Документация для пользователей

═══════════════════════════════════════════════════════════════════════════════
  КОНТАКТЫ И РЕСУРСЫ
═══════════════════════════════════════════════════════════════════════════════

ДОКУМЕНТАЦИЯ:
├─ Telegram Bot API: https://core.telegram.org/bots/api
├─ Telegram Client API: https://core.telegram.org/api
├─ Grok API: https://docs.x.ai/api
├─ Perplexity API: https://docs.perplexity.ai
├─ Supabase: https://supabase.com/docs
└─ Astro: https://docs.astro.build

ПОЛЕЗНЫЕ БИБЛИОТЕКИ:
├─ node-telegram-bot-api (для Bot API)
├─ GramJS / Telethon (для Client API)
├─ @supabase/supabase-js
└─ groq-sdk / openai

═══════════════════════════════════════════════════════════════════════════════

ВЕРСИЯ ДОКУМЕНТА: 1.0
ПОСЛЕДНЕЕ ОБНОВЛЕНИЕ: 2026-01-24

ПРИ ЗАПРОСЕ "МОЙ ПЛАН" ИЛИ "ПЛАН РАБОТЫ" → ОТКРЫТЬ ЭТОТ ФАЙЛ

═══════════════════════════════════════════════════════════════════════════════
