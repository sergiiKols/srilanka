# üé§ –ì–û–õ–û–°–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø: –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

**–°—Ç–∞—Ç—É—Å:** üìã –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ –∑–∞–ø—Ä–æ—Å—É)  
**–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:** `–≥–æ–ª–æ—Å`, `–≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ`, `—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è`, `voice`, `transcription`, `whisper`

---

## üìã –ö–û–ù–¢–ï–ö–°–¢

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ—Å—Ç–∞–≤–ª—è—Ç—å **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è** –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–º, –Ω–æ –∏ **–≥–æ–ª–æ—Å–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π –≤ —Ç–µ–∫—Å—Ç.

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –§–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã)
- –ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ –±–µ–∑ –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
- –£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üéØ –î–í–ê –í–ê–†–ò–ê–ù–¢–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### **–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è MVP)**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å Telegram (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è)
- ‚úÖ –ü—Ä–∏–≤—ã—á–Ω—ã–π UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ

**Workflow:**
```
1. –ö–ª–∏–µ–Ω—Ç –≤ Web App ‚Üí "üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º"
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É"
3. –ö–ª–∏–µ–Ω—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç voice message –±–æ—Ç—É
4. –ë–æ—Ç ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª (OGG format)
5. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Whisper API ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
6. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ
7. –ö–ª–∏–µ–Ω—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç ‚Üí –º–æ–∂–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
```

---

### **–í–∞—Ä–∏–∞–Ω—Ç B: Web Audio API (–∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–æ—Ä–º–µ)**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É Web App –∏ –±–æ—Ç–æ–º
- ‚úÖ –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω (–ø—É–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚ö†Ô∏è –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞—É–¥–∏–æ –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ö–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:**

```typescript
// src/components/VoiceRecorder.tsx

import { useState, useRef } from 'react';

export function VoiceRecorder({ onTranscription }) {
  const [isRecording, setIsRecording] = useState(false);
  const [audioBlob, setAudioBlob] = useState(null);
  const mediaRecorder = useRef(null);
  
  const startRecording = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder.current = new MediaRecorder(stream);
      
      const chunks = [];
      mediaRecorder.current.ondataavailable = (e) => chunks.push(e.data);
      
      mediaRecorder.current.onstop = async () => {
        const blob = new Blob(chunks, { type: 'audio/webm' });
        setAudioBlob(blob);
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é
        await transcribeAudio(blob);
      };
      
      mediaRecorder.current.start();
      setIsRecording(true);
    } catch (err) {
      alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
    }
  };
  
  const stopRecording = () => {
    mediaRecorder.current.stop();
    setIsRecording(false);
  };
  
  const transcribeAudio = async (audioBlob) => {
    const formData = new FormData();
    formData.append('audio', audioBlob, 'voice.webm');
    
    const response = await fetch('/api/transcribe', {
      method: 'POST',
      body: formData
    });
    
    const { text } = await response.json();
    onTranscription(text);
  };
  
  return (
    <div className="voice-recorder">
      {!isRecording ? (
        <button onClick={startRecording}>
          üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º
        </button>
      ) : (
        <button onClick={stopRecording} className="recording">
          ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
        </button>
      )}
      
      {audioBlob && <p>‚úÖ –ó–∞–ø–∏—Å—å –≥–æ—Ç–æ–≤–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º...</p>}
    </div>
  );
}
```

---

## ü§ñ –°–ï–†–í–ò–°–´ –¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–ò

### **1. Groq Whisper (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è MVP)**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–ë–ï–°–ü–õ–ê–¢–ù–û** (–µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ OpenAI Whisper (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∂–µ–ª–µ–∑–æ)
- ‚úÖ –¢–∞ –∂–µ –º–æ–¥–µ–ª—å Whisper, —á—Ç–æ —É OpenAI
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 50+ —è–∑—ã–∫–æ–≤ (RU, EN)

**–õ–∏–º–∏—Ç—ã:** 14,400 –º–∏–Ω—É—Ç/–¥–µ–Ω—å (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤)

**–ö–æ–¥:**

```typescript
// src/services/transcription.ts

import Groq from 'groq-sdk';
import fs from 'fs';

const groq = new Groq({
  apiKey: process.env.GROQ_API_KEY
});

export async function transcribeVoiceMessage(
  audioFilePath: string, 
  language: 'ru' | 'en' = 'ru'
) {
  const audioFile = fs.createReadStream(audioFilePath);
  
  const transcription = await groq.audio.transcriptions.create({
    file: audioFile,
    model: 'whisper-large-v3',
    language: language,
    response_format: 'json'
  });
  
  return transcription.text;
}
```

---

### **2. OpenAI Whisper**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 50+ —è–∑—ã–∫–æ–≤
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å Telegram voice format (OGG/Opus)

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0.006 –∑–∞ –º–∏–Ω—É—Ç—É (~$0.36 –∑–∞ —á–∞—Å)

**–ö–æ–¥:**

```typescript
// src/services/transcription.ts

import OpenAI from 'openai';
import fs from 'fs';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

export async function transcribeVoiceMessage(
  audioFilePath: string, 
  language: 'ru' | 'en' = 'ru'
) {
  const audioFile = fs.createReadStream(audioFilePath);
  
  const transcription = await openai.audio.transcriptions.create({
    file: audioFile,
    model: 'whisper-1',
    language: language,  // –∏–ª–∏ 'auto' –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    response_format: 'json'
  });
  
  return transcription.text;
}
```

---

### **3. Google Cloud Speech-to-Text**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—á–µ–Ω—å —Ç–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
- ‚úÖ Streaming (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0.024 –∑–∞ –º–∏–Ω—É—Ç—É (~$1.44 –∑–∞ —á–∞—Å)

**–ö–æ–¥:**

```typescript
// src/services/transcription.ts

import speech from '@google-cloud/speech';

const client = new speech.SpeechClient();

export async function transcribeVoiceMessage(
  audioBuffer: Buffer, 
  language: 'ru-RU' | 'en-US' = 'ru-RU'
) {
  const audio = {
    content: audioBuffer.toString('base64')
  };
  
  const config = {
    encoding: 'OGG_OPUS',  // Telegram format
    sampleRateHertz: 16000,
    languageCode: language,
    enableAutomaticPunctuation: true,
    model: 'latest_long'
  };
  
  const request = { audio, config };
  const [response] = await client.recognize(request);
  
  const transcription = response.results
    .map(result => result.alternatives[0].transcript)
    .join('\n');
  
  return transcription;
}
```

---

### **4. Yandex SpeechKit**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ –î–µ—à–µ–≤–ª–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è RU

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** ‚ÇΩ0.24 –∑–∞ –º–∏–Ω—É—Ç—É (~‚ÇΩ14.4 –∑–∞ —á–∞—Å)

---

## üí∞ –°–†–ê–í–ù–ï–ù–ò–ï –°–¢–û–ò–ú–û–°–¢–ò

| –°–µ—Ä–≤–∏—Å | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–∏–Ω | –ö–∞—á–µ—Å—Ç–≤–æ RU | –ö–∞—á–µ—Å—Ç–≤–æ EN | Free tier |
|--------|---------------|-------------|-------------|-----------|
| **Groq Whisper** | **FREE** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | 14,400 –º–∏–Ω/–¥–µ–Ω—å |
| **OpenAI Whisper** | $0.006 | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –ù–µ—Ç |
| Google Speech | $0.024 | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | 60 –º–∏–Ω/–º–µ—Å—è—Ü |
| Yandex SpeechKit | ‚ÇΩ0.24 | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | –ù–µ—Ç |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** **Groq Whisper** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ + –æ—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –ë–î (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É tenant_requests:

ALTER TABLE tenant_requests ADD COLUMN IF NOT EXISTS
  additional_requirements TEXT,              -- —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
  voice_message_file_id TEXT,                -- Telegram file_id (–µ—Å–ª–∏ –µ—Å—Ç—å)
  voice_message_transcription TEXT,          -- —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
  voice_message_duration_seconds INT,        -- –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏
  voice_message_language TEXT,               -- —è–∑—ã–∫ –∑–∞–ø–∏—Å–∏ (ru/en)
  has_voice_message BOOLEAN DEFAULT false,
  transcription_status TEXT DEFAULT 'none';  -- none, processing, completed, failed
```

---

## üîÑ –ü–û–õ–ù–´–ô WORKFLOW (–í–∞—Ä–∏–∞–Ω—Ç A ‚Äî —á–µ—Ä–µ–∑ –±–æ—Ç–∞)

```
1. –ö–ª–∏–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤ Web App
   ‚îî‚îÄ> –î–æ—Ö–æ–¥–∏—Ç –¥–æ –ø–æ–ª—è "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"

2. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç:
   ‚îú‚îÄ üìù –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
   ‚îî‚îÄ> üé§ –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º"

3. –ö–ª–∏–µ–Ω—Ç –∫–ª–∏–∫–∞–µ—Ç "üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º"
   ‚îî‚îÄ> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:
       "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É @YourBot"
       [‚úâÔ∏è –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞]

4. –ö–ª–∏–µ–Ω—Ç ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ—Ç Web App ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞
   ‚îî‚îÄ> –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É

5. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç voice message:
   ‚îú‚îÄ Telegram Bot API ‚Üí file_id
   ‚îú‚îÄ –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª: getFile(file_id)
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ –≤ /tmp
   ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Groq Whisper API

6. Groq Whisper ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç:
   "–ù—É–∂–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞ –∏ —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –¥–æ—Ä–æ–≥–∏"

7. –ë–æ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é:
   ‚îú‚îÄ UPDATE tenant_requests SET voice_message_transcription = '...'
   ‚îî‚îÄ> transcription_status = 'completed'

8. –ö–ª–∏–µ–Ω—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ Web App
   ‚îî‚îÄ> Polling –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
   ‚îî‚îÄ> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç
   ‚îî‚îÄ> –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"

9. –ö–ª–∏–µ–Ω—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç ‚Üí Submit
```

---

## üìù –ö–û–î –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –í –§–û–†–ú–£

```typescript
// src/components/TenantRequestForm.tsx

export function TenantRequestForm() {
  const [additionalReqs, setAdditionalReqs] = useState('');
  const [voiceTranscription, setVoiceTranscription] = useState('');
  const [isTranscribing, setIsTranscribing] = useState(false);
  const requestId = useRef(generateUUID());
  
  const handleVoiceRecording = () => {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –±–æ—Ç–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID –∑–∞–ø—Ä–æ—Å–∞
    const botUrl = `https://t.me/${process.env.NEXT_PUBLIC_BOT_USERNAME}?start=voice_${requestId.current}`;
    window.open(botUrl, '_blank');
    
    // –ù–∞—á–∏–Ω–∞–µ–º polling –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
    pollForTranscription(requestId.current);
  };
  
  const pollForTranscription = async (reqId: string) => {
    setIsTranscribing(true);
    
    const interval = setInterval(async () => {
      const response = await fetch(`/api/check-transcription?id=${reqId}`);
      const { transcription, status } = await response.json();
      
      if (status === 'completed') {
        setVoiceTranscription(transcription);
        setIsTranscribing(false);
        clearInterval(interval);
      } else if (status === 'failed') {
        alert('–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
        setIsTranscribing(false);
        clearInterval(interval);
      }
    }, 2000);  // –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    
    // –¢–∞–π–º–∞—É—Ç 5 –º–∏–Ω—É—Ç
    setTimeout(() => {
      clearInterval(interval);
      setIsTranscribing(false);
    }, 5 * 60 * 1000);
  };
  
  return (
    <form>
      {/* ... –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ª—è ... */}
      
      <div className="additional-requirements">
        <label>{t('additional_requirements')}</label>
        
        <textarea
          value={additionalReqs || voiceTranscription}
          onChange={(e) => setAdditionalReqs(e.target.value)}
          placeholder={t('additional_requirements_placeholder')}
          rows={4}
        />
        
        <button 
          type="button" 
          onClick={handleVoiceRecording}
          disabled={isTranscribing}
          className="voice-button"
        >
          {isTranscribing ? (
            <>üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø–∏—Å—å...</>
          ) : (
            <>üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º</>
          )}
        </button>
        
        {voiceTranscription && (
          <div className="transcription-result">
            ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "{voiceTranscription}"
            <small>–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤—ã—à–µ</small>
          </div>
        )}
        
        <div className="examples">
          <small>
            –ü—Ä–∏–º–µ—Ä—ã:
            <ul>
              <li>"–ù—É–∂–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞"</li>
              <li>"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ"</li>
              <li>"–†–∞–±–æ—Ç–∞–µ–º —É–¥–∞–ª—ë–Ω–Ω–æ, –Ω—É–∂–µ–Ω —Ö–æ—Ä–æ—à–∏–π WiFi"</li>
            </ul>
          </small>
        </div>
      </div>
      
      <button type="submit">üöÄ –ù–∞–π—Ç–∏ –∂–∏–ª—å—ë</button>
    </form>
  );
}
```

---

## üõ†Ô∏è API ENDPOINTS

### **POST /api/transcribe**

–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Telegram –±–æ—Ç–∞.

```typescript
// src/pages/api/transcribe.ts

import { transcribeVoiceMessage } from '@/services/transcription';
import { supabase } from '@/lib/supabase';

export async function POST(req: Request) {
  const { file_id, request_id, user_id, language } = await req.json();
  
  try {
    // 1. –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª –∏–∑ Telegram
    const fileUrl = await getTelegramFileUrl(file_id);
    const audioBuffer = await downloadFile(fileUrl);
    
    // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ
    const tempPath = `/tmp/${file_id}.ogg`;
    await fs.promises.writeFile(tempPath, audioBuffer);
    
    // 3. –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
    const transcription = await transcribeVoiceMessage(tempPath, language);
    
    // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    await supabase
      .from('tenant_requests')
      .update({
        voice_message_file_id: file_id,
        voice_message_transcription: transcription,
        transcription_status: 'completed',
        has_voice_message: true
      })
      .eq('id', request_id);
    
    // 5. –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    await fs.promises.unlink(tempPath);
    
    return Response.json({ success: true, transcription });
    
  } catch (error) {
    console.error('Transcription error:', error);
    
    await supabase
      .from('tenant_requests')
      .update({ transcription_status: 'failed' })
      .eq('id', request_id);
    
    return Response.json({ success: false, error: error.message }, { status: 500 });
  }
}
```

---

### **GET /api/check-transcription**

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–¥–ª—è polling).

```typescript
// src/pages/api/check-transcription.ts

import { supabase } from '@/lib/supabase';

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const requestId = searchParams.get('id');
  
  const { data, error } = await supabase
    .from('tenant_requests')
    .select('voice_message_transcription, transcription_status')
    .eq('id', requestId)
    .single();
  
  if (error) {
    return Response.json({ status: 'not_found' }, { status: 404 });
  }
  
  return Response.json({
    status: data.transcription_status,
    transcription: data.voice_message_transcription
  });
}
```

---

## üì¶ –ù–ï–û–ë–•–û–î–ò–ú–´–ï –ü–ê–ö–ï–¢–´

```bash
# –î–ª—è Groq Whisper
npm install groq-sdk

# –î–ª—è OpenAI Whisper
npm install openai

# –î–ª—è Google Speech-to-Text
npm install @google-cloud/speech

# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
npm install node-fetch
```

---

## üîê ENVIRONMENT VARIABLES

```bash
# .env

# Groq (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
GROQ_API_KEY=gsk_xxxxxxxxxxxxx

# –ò–ª–∏ OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxx

# –ò–ª–∏ Google Cloud
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

# Telegram Bot
TELEGRAM_BOT_TOKEN=xxxx:yyyyyyyyyyy
NEXT_PUBLIC_BOT_USERNAME=YourBotUsername
```

---

## üéØ –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø (–∫–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)

### **–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (30 –º–∏–Ω)**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `groq-sdk`
- [ ] –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á Groq
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `tenant_requests`

### **–®–∞–≥ 2: –°–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (1 —á–∞—Å)**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/services/transcription.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `transcribeVoiceMessage()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### **–®–∞–≥ 3: API Endpoints (1.5 —á–∞—Å–∞)**
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/transcribe` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–∞
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/check-transcription` –¥–ª—è polling
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API

### **–®–∞–≥ 4: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (2 —á–∞—Å–∞)**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–º"
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å polling –º–µ—Ö–∞–Ω–∏–∑–º
- [ ] –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º..."
- [ ] –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π

### **–®–∞–≥ 5: Telegram Bot Handler (1 —á–∞—Å)**
- [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ voice message –≤ –±–æ—Ç–µ
- [ ] –ü—Ä–∏–≤—è–∑–∫–∞ –∫ request_id
- [ ] –í—ã–∑–æ–≤ API —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

### **–®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)**
- [ ] –¢–µ—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- [ ] –¢–µ—Å—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
- [ ] –¢–µ—Å—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- [ ] –¢–µ—Å—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫

**–ò—Ç–æ–≥–æ:** ~7 —á–∞—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üöÄ –ë–£–î–£–©–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø

1. **Streaming —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **AI —É–ª—É—á—à–µ–Ω–∏–µ** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã** ‚Äî "–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –≤–∏–ª–ª—ã"
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤** ‚Äî —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –Ω–µ–º–µ—Ü–∫–∏–π, –∏—Å–ø–∞–Ω—Å–∫–∏–π
5. **–ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ Web App** (–±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –±–æ—Ç–∞)

---

## üìö –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- [Groq Whisper Documentation](https://console.groq.com/docs/speech-text)
- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)
- [Telegram Bot API - Voice Messages](https://core.telegram.org/bots/api#voice)
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)

---

**–î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π!**

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-01-28*
