# üß™ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ TELEGRAM BOT

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ (Media Groups)**
- Telegram —Ç–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ç–æ –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –¢–∞–π–º–∞—É—Ç 300ms –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ–π –≥—Ä—É–ø–ø—ã
- –í—Å–µ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Supabase Storage

### 2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è**
- `description` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –ò–õ–ò AI-–∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `raw_text` - –ø–æ–ª–Ω—ã–π backup –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

### 3. **–†–µ–¥–∏—Ä–µ–∫—Ç –∫–∞—Ä—Ç—ã**
- `/map` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç 301 –Ω–∞ `/admin/master-map`
- –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

## üîß –ü–ï–†–ï–î –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï–ú:

### **–®–ê–ì 1: SQL –ú–∏–≥—Ä–∞—Ü–∏—è**

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor:
```
https://supabase.com/dashboard/project/mcmzdscpuoxwneuzsanu/editor
```

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è raw_text
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_name = 'saved_properties' 
    AND column_name = 'raw_text'
  ) THEN
    ALTER TABLE saved_properties 
    ADD COLUMN raw_text TEXT;
    
    COMMENT ON COLUMN saved_properties.raw_text IS '–ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ Telegram (backup –¥–ª—è AI –æ–±—Ä–∞–±–æ—Ç–∫–∏)';
  END IF;
END $$;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'saved_properties' 
  AND column_name IN ('description', 'raw_text')
ORDER BY column_name;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
column_name  | data_type
-------------+-----------
description  | text
raw_text     | text
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### **–¢–ï–°–¢ 1: –û–¥–∏–Ω–æ—á–Ω–æ–µ —Ñ–æ—Ç–æ**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ü–µ—Ä–µ—Å–ª–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å:
   - ‚úÖ –û–¥–Ω–æ —Ñ–æ—Ç–æ
   - ‚úÖ –¢–µ–∫—Å—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º (—Ü–µ–Ω–∞, —Ç–∏–ø, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
   - ‚úÖ Google Maps —Å—Å—ã–ª–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!

üè† [–ù–∞–∑–≤–∞–Ω–∏–µ]
üí∞ [–¶–µ–Ω–∞]
üìç [–õ–æ–∫–∞—Ü–∏—è]

üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: 1

üó∫Ô∏è [–ö–Ω–æ–ø–∫–∞: –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É]
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î:**
```sql
SELECT 
  id, 
  title, 
  description, 
  raw_text, 
  array_length(photos, 1) as photo_count,
  created_at
FROM saved_properties 
ORDER BY created_at DESC 
LIMIT 1;
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `description` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (–∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç)
- `raw_text` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (backup)
- `photos` = 1 URL

---

### **–¢–ï–°–¢ 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ (Media Group)**

1. –í Telegram –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ (3-5 —à—Ç)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏—Ö **–æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º** (media group)
3. –î–æ–±–∞–≤—å—Ç–µ caption —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!

üè† [–ù–∞–∑–≤–∞–Ω–∏–µ]
üí∞ [–¶–µ–Ω–∞]
üìç [–õ–æ–∫–∞—Ü–∏—è]

üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: 5

üó∫Ô∏è [–ö–Ω–æ–ø–∫–∞: –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É]
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î:**
```sql
SELECT 
  id, 
  title, 
  description, 
  array_length(photos, 1) as photo_count
FROM saved_properties 
ORDER BY created_at DESC 
LIMIT 1;
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `photos` = 5 URLs (–∏–ª–∏ —Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏)
- `description` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
- `raw_text` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö Vercel:**
```
üì∏ Media group message received: 12345
üìé Added photo to group 12345, total: 1
üìé Added photo to group 12345, total: 2
üìé Added photo to group 12345, total: 3
...
‚è∞ Processing media group 12345 with 5 photos
‚ö° Processing media group with 5 photos
üì∏ Uploading 5 photos from media group...
‚úÖ Uploaded 5 photos from 5 messages
‚úÖ Property saved: [id] with 5 photos
```

---

### **–¢–ï–°–¢ 3: –†–µ–¥–∏—Ä–µ–∫—Ç –∫–∞—Ä—Ç—ã**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://srilanka-37u2.vercel.app/map`
2. –î–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞:
   `https://srilanka-37u2.vercel.app/admin/master-map`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –†–µ–¥–∏—Ä–µ–∫—Ç 301 (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)
- URL –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `/admin/master-map`

---

### **–¢–ï–°–¢ 4: –ê–¥–º–∏–Ω—Å–∫–∞—è –∫–∞—Ä—Ç–∞**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://srilanka-37u2.vercel.app/admin/master-map`
2. –ù–∞–∂–º–∏—Ç–µ **Ctrl+Shift+R** (hard refresh)

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ –£ –æ–±—ä–µ–∫—Ç–æ–≤ –µ—Å—Ç—å —Ñ–æ—Ç–æ (1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
- ‚úÖ –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–±—ä–µ–∫—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è PropertyDrawer
- ‚úÖ –í PropertyDrawer –≤–∏–¥–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ
- ‚úÖ –§–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (gallery)

**–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å:**
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ N –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –æ—Ç M –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

---

### **–¢–ï–°–¢ 5: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞**

1. –í Telegram –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"üó∫Ô∏è –ú–æ—è –∫–∞—Ä—Ç–∞"**
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ –§–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –µ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

---

## üêõ –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –ï–°–õ–ò –ù–ï –†–ê–ë–û–¢–ê–ï–¢:

### **–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Vercel Functions
2. –ò—Å–∫–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:
   ```
   üì∏ Uploading photos...
   ‚úÖ Uploaded N photos
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase Storage bucket:
   ```
   https://supabase.com/dashboard/project/mcmzdscpuoxwneuzsanu/storage/buckets
   ```
4. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å bucket `property-photos`

### **–û–ø–∏—Å–∞–Ω–∏–µ –ø—É—Å—Ç–æ–µ:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```
   ü§ñ Starting AI analysis...
   üíæ Saving to database...
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î –ø–æ–ª—è `description` –∏ `raw_text`

### **Media group –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```
   üì∏ Media group message received: [group_id]
   üìé Added photo to group [group_id], total: N
   ‚è∞ Processing media group [group_id] with N photos
   ```
2. –ï—Å–ª–∏ timeout –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª - —É–≤–µ–ª–∏—á–∏—Ç—å —Å 300ms –¥–æ 500ms

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç:
```
1. –û–¥–∏–Ω–æ—á–Ω–æ–µ —Ñ–æ—Ç–æ: ‚úÖ 1 —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ –µ—Å—Ç—å
2. Media group (5 —Ñ–æ—Ç–æ): ‚úÖ 5 —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ –µ—Å—Ç—å
3. –†–µ–¥–∏—Ä–µ–∫—Ç /map: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç 301
4. –ê–¥–º–∏–Ω—Å–∫–∞—è –∫–∞—Ä—Ç–∞: ‚úÖ –í—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤–∏–¥–Ω—ã —Å —Ñ–æ—Ç–æ
5. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞: ‚úÖ –õ–∏—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Å —Ñ–æ—Ç–æ
```

### ‚ùå –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- –°–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
- –õ–æ–≥–∏ –∏–∑ Vercel Functions
- –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (SQL –∑–∞–ø—Ä–æ—Å)

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï:

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- [ ] –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É Import —Å –∞–¥–º–∏–Ω–∫–∏ (–æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
- [ ] –£–ª—É—á—à–∏—Ç—å AI –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è

**–£–¥–∞—á–∏ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏!** üöÄ
