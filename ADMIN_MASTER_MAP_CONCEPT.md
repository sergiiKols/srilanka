# üó∫Ô∏è –ö–û–ù–¶–ï–ü–¶–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ô –ú–ê–°–¢–ï–†-–ö–ê–†–¢–´

**–î–∞—Ç–∞:** 2026-01-29  
**–ò–¥–µ—è:** –°–æ–∑–¥–∞—Ç–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ –≤–∏–¥–∏—Ç –í–°–ï –æ–±—ä–µ–∫—Ç—ã –æ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Å–≤–æ–µ–π –∫–∞—Ä—Ç–µ

---

## üéØ –î–í–ê –¢–ò–ü–ê –ö–ê–†–¢

### 1. –õ–∏—á–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É–∂–µ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã)

```
URL: /map/{telegram_user_id}/{token}
–ü—Ä–∏–º–µ—Ä: /map/1000089271/aB7cDx

–í–∏–¥–∏—Ç: –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã
–§–∏–ª—å—Ç—Ä: WHERE telegram_user_id = 1000089271
–¶–≤–µ—Ç: –û–¥–∏–Ω —Ü–≤–µ—Ç (—Å–∏–Ω–∏–π)
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –ë–∞–∑–æ–≤—ã–µ (—Ñ–æ—Ç–æ, —Ü–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏–µ)
```

---

### 2. –ê–¥–º–∏–Ω—Å–∫–∞—è –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (–ù–û–í–û–ï!)

```
URL: /admin/master-map
–ò–ª–∏: /map/admin/{admin_secret_token}

–í–∏–¥–∏—Ç: –í–°–ï –æ–±—ä–µ–∫—Ç—ã –æ—Ç –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!
–§–∏–ª—å—Ç—Ä: –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞ (–∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –≤—ã–±–æ—Ä—É –∞–¥–º–∏–Ω–∞)
–¶–≤–µ—Ç: –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–ø–æ —Ä–∞–∑–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º)
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –†–ê–°–®–ò–†–ï–ù–ù–´–ï (–∫—Ç–æ –¥–æ–±–∞–≤–∏–ª, –∫–æ–≥–¥–∞, –æ—Ç–∫—É–¥–∞)
```

---

## üé® –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ê –ê–î–ú–ò–ù–°–ö–û–ô –ö–ê–†–¢–ï

### –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (Heat Map) –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

```
üî¥ –ö—Ä–∞—Å–Ω—ã–π   ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–æ < 24 —á–∞—Å–∞ (–Ω–æ–≤—ã–µ)
üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–æ 1-7 –¥–Ω–µ–π
üü° –ñ—ë–ª—Ç—ã–π    ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–æ 7-30 –¥–Ω–µ–π
üü¢ –ó–µ–ª—ë–Ω—ã–π   ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–æ > 30 –¥–Ω–µ–π (—Å—Ç–∞—Ä—ã–µ)
‚ö™ –°–µ—Ä—ã–π     ‚Üí –ê—Ä—Ö–∏–≤ / –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É

```
üîµ –°–∏–Ω–∏–π     ‚Üí Direct (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –¥–æ–±–∞–≤–∏–ª)
üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π ‚Üí Forward –∏–∑ –≥—Ä—É–ø–ø
üü¢ –ó–µ–ª—ë–Ω—ã–π   ‚Üí Forward –∏–∑ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
üü° –ñ—ë–ª—Ç—ã–π    ‚Üí Import —á–µ—Ä–µ–∑ —Å–∞–π—Ç
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
üî¥ –ö—Ä–∞—Å–Ω—ã–π   ‚Üí –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (>10 –æ–±—ä–µ–∫—Ç–æ–≤)
üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Üí –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (5-10 –æ–±—ä–µ–∫—Ç–æ–≤)
üü° –ñ—ë–ª—Ç—ã–π    ‚Üí –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (2-4 –æ–±—ä–µ–∫—Ç–∞)
üü¢ –ó–µ–ª—ë–Ω—ã–π   ‚Üí –ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç (1 –æ–±—ä–µ–∫—Ç)
‚ö™ –°–µ—Ä—ã–π     ‚Üí –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```

#### –í–∞—Ä–∏–∞–Ω—Ç 4: –ü–æ —Ü–µ–Ω–µ

```
üî¥ –ö—Ä–∞—Å–Ω—ã–π   ‚Üí –î–æ—Ä–æ–≥–∏–µ ($1000+)
üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Üí –°—Ä–µ–¥–Ω–∏–µ ($500-1000)
üü° –ñ—ë–ª—Ç—ã–π    ‚Üí –î–æ—Å—Ç—É–ø–Ω—ã–µ ($200-500)
üü¢ –ó–µ–ª—ë–Ω—ã–π   ‚Üí –ë—é–¥–∂–µ—Ç (<$200)
‚ö™ –°–µ—Ä—ã–π     ‚Üí –ë–µ–∑ —Ü–µ–Ω—ã
```

---

## üîç –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –í POPUP

### –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:

```
üì∑ [–§–æ—Ç–æ]
üè† 2BR Villa, Negombo
üí∞ $800/month
üìù Description...

[–ö–æ–Ω—Ç–∞–∫—Ç] [–ò–∑–±—Ä–∞–Ω–Ω–æ–µ]
```

---

### –ê–î–ú–ò–ù –≤–∏–¥–∏—Ç (–†–ê–°–®–ò–†–ï–ù–ù–û–ï):

```
üì∑ [–§–æ—Ç–æ]
üè† 2BR Villa, Negombo
üí∞ $800/month
üìù Description...

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîê ADMIN INFO:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   ID: 1000089271
   Username: @john_doe
   –û–±—ä–µ–∫—Ç–æ–≤: 5
   [–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å] [–í—Å–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]

üìÖ –î–æ–±–∞–≤–ª–µ–Ω–æ:
   29.01.2026 14:30
   (2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥)

üì® –ò—Å—Ç–æ—á–Ω–∏–∫:
   –¢–∏–ø: Forward –∏–∑ –≥—Ä—É–ø–ø—ã
   –ì—Ä—É–ø–ø–∞: Sri Lanka Housing (@srilanka_housing)
   –ê–≤—Ç–æ—Ä: Peter (@property_owner)
   [–û—Ç–∫—Ä—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª]

üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:
   6.9271, 79.8612
   Google Maps: [—Å—Å—ã–ª–∫–∞]

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: 0
   –ò–∑–±—Ä–∞–Ω–Ω–æ–µ: –ù–µ—Ç
   –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä: -

‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è:
[‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [üóëÔ∏è –£–¥–∞–ª–∏—Ç—å] [üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
```

---

## üéõÔ∏è –§–ò–õ–¨–¢–†–´ –ù–ê –ê–î–ú–ò–ù–°–ö–û–ô –ö–ê–†–¢–ï

### –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤:

```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –§–ò–õ–¨–¢–†–´
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   [–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚ñº]
   ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ: @john_doe
   ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö (>5 –æ–±—ä–µ–∫—Ç–æ–≤)

üìÖ –ü–µ—Ä–∏–æ–¥:
   [–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è ‚ñº]
   ‚Üí –°–µ–≥–æ–¥–Ω—è
   ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
   ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
   ‚Üí –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–µ—Ä–∏–æ–¥

üì® –ò—Å—Ç–æ—á–Ω–∏–∫:
   ‚òëÔ∏è Direct
   ‚òëÔ∏è Forward –∏–∑ –≥—Ä—É–ø–ø
   ‚òëÔ∏è Forward –∏–∑ –ª–∏—á–Ω—ã—Ö
   ‚òëÔ∏è Import —á–µ—Ä–µ–∑ —Å–∞–π—Ç

üí∞ –¶–µ–Ω–∞:
   –û—Ç: [$___] –î–æ: [$___]

üè† –¢–∏–ø:
   ‚òëÔ∏è Villa
   ‚òëÔ∏è Apartment
   ‚òëÔ∏è House
   ‚òëÔ∏è Room

üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:
   ‚ö´ –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
   ‚ö™ –ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É
   ‚ö™ –ü–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚ö™ –ü–æ —Ü–µ–Ω–µ

[–ü—Ä–∏–º–µ–Ω–∏—Ç—å] [–°–±—Ä–æ—Å–∏—Ç—å]
```

---

## üóÑÔ∏è –°–¢–†–£–ö–¢–£–†–ê –ë–î –î–õ–Ø –ê–î–ú–ò–ù–ê

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∞–¥–º–∏–Ω–æ–≤
CREATE TABLE admins (
  id UUID PRIMARY KEY,
  telegram_user_id BIGINT UNIQUE NOT NULL,
  username TEXT,
  is_super_admin BOOLEAN DEFAULT false,
  master_map_token VARCHAR(32) UNIQUE,  -- –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–π –∫–∞—Ä—Ç—ã
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –í—Å—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è –ø—Ä–æ–µ–∫—Ç–∞
INSERT INTO admins (telegram_user_id, username, is_super_admin, master_map_token)
VALUES (
  1000089271,  -- –í–∞—à Telegram ID
  '@your_username',
  true,
  encode(gen_random_bytes(16), 'hex')  -- –î–ª–∏–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω–∞
);
```

---

## üì° API ENDPOINTS –î–õ–Ø –ê–î–ú–ò–ù–ê

### GET `/api/admin/map/all-properties`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
{
  admin_token: string,
  filter?: {
    user_id?: number,
    date_from?: string,
    date_to?: string,
    source_type?: string,
    min_price?: number,
    max_price?: number,
    property_type?: string
  },
  color_scheme?: 'time' | 'source' | 'activity' | 'price'
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_properties": 245,
  "total_users": 32,
  "properties": [
    {
      "id": "uuid-1",
      "latitude": 6.9271,
      "longitude": 79.8612,
      "title": "2BR Villa",
      "price": 800,
      "photos": ["url1", "url2"],
      
      "admin_metadata": {
        "user_id": 1000089271,
        "username": "@john_doe",
        "user_total_properties": 5,
        "added_at": "2026-01-29T14:30:00Z",
        "age_hours": 2,
        "source_type": "forward",
        "forward_from_chat": "Sri Lanka Housing",
        "original_link": "https://t.me/srilanka_housing/123",
        "color": "#FF0000"  // –¶–≤–µ—Ç –º–∞—Ä–∫–µ—Ä–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ
      }
    }
  ]
}
```

---

## üé® FRONTEND –ö–û–ú–ü–û–ù–ï–ù–¢

### –°—Ç—Ä–∞–Ω–∏—Ü–∞: `src/pages/admin/master-map.astro`

```astro
---
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω
const adminToken = Astro.url.searchParams.get('token');
const admin = await verifyAdminToken(adminToken);

if (!admin) {
  return Astro.redirect('/admin?error=unauthorized');
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –í–°–ï –æ–±—ä–µ–∫—Ç—ã
const { data: allProperties } = await supabase
  .from('saved_properties')
  .select(`
    *,
    tenant:tenants!telegram_user_id (
      telegram_user_id,
      saved_properties_count
    )
  `)
  .order('created_at', { ascending: false });
---

<Layout title="Admin Master Map">
  <div class="admin-map-container">
    <div class="filters-panel">
      <FilterPanel />
    </div>
    
    <div class="map-container">
      <AdminMasterMap 
        properties={allProperties}
        colorScheme="time"
      />
    </div>
    
    <div class="stats-panel">
      <StatsPanel 
        totalProperties={allProperties.length}
        totalUsers={uniqueUsers}
      />
    </div>
  </div>
</Layout>
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `src/components/admin/AdminMasterMap.tsx`

```typescript
export default function AdminMasterMap({ properties, colorScheme }) {
  // –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –º–∞—Ä–∫–µ—Ä–∞
  const getMarkerColor = (property) => {
    switch (colorScheme) {
      case 'time':
        const hoursAgo = (Date.now() - property.created_at) / 3600000;
        if (hoursAgo < 24) return '#FF0000';      // –ö—Ä–∞—Å–Ω—ã–π - —Å–≤–µ–∂–∏–µ
        if (hoursAgo < 168) return '#FF8800';     // –û—Ä–∞–Ω–∂–µ–≤—ã–π - –Ω–µ–¥–µ–ª—è
        if (hoursAgo < 720) return '#FFFF00';     // –ñ—ë–ª—Ç—ã–π - –º–µ—Å—è—Ü
        return '#00FF00';                          // –ó–µ–ª—ë–Ω—ã–π - —Å—Ç–∞—Ä—ã–µ
        
      case 'source':
        if (property.source_type === 'direct') return '#0000FF';  // –°–∏–Ω–∏–π
        if (property.forward_from_chat_id) return '#8800FF';      // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - –∏–∑ –≥—Ä—É–ø–ø
        return '#00FF00';                                          // –ó–µ–ª—ë–Ω—ã–π - –ª–∏—á–Ω—ã–µ
        
      case 'activity':
        const userCount = property.tenant.saved_properties_count;
        if (userCount > 10) return '#FF0000';     // –ö—Ä–∞—Å–Ω—ã–π - –∞–∫—Ç–∏–≤–Ω—ã–µ
        if (userCount > 5) return '#FF8800';      // –û—Ä–∞–Ω–∂–µ–≤—ã–π
        if (userCount > 2) return '#FFFF00';      // –ñ—ë–ª—Ç—ã–π
        return '#00FF00';                          // –ó–µ–ª—ë–Ω—ã–π - –Ω–æ–≤–∏—á–∫–∏
        
      case 'price':
        const price = property.price || 0;
        if (price > 1000) return '#FF0000';       // –ö—Ä–∞—Å–Ω—ã–π - –¥–æ—Ä–æ–≥–∏–µ
        if (price > 500) return '#FF8800';        // –û—Ä–∞–Ω–∂–µ–≤—ã–π
        if (price > 200) return '#FFFF00';        // –ñ—ë–ª—Ç—ã–π
        return '#00FF00';                          // –ó–µ–ª—ë–Ω—ã–π - –±—é–¥–∂–µ—Ç
        
      default:
        return '#0088FF';                          // –°–∏–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
  };
  
  // –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
  properties.forEach(property => {
    const color = getMarkerColor(property);
    
    const marker = L.circleMarker([property.latitude, property.longitude], {
      radius: 8,
      fillColor: color,
      color: '#fff',
      weight: 2,
      opacity: 1,
      fillOpacity: 0.8
    });
    
    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π popup –¥–ª—è –∞–¥–º–∏–Ω–∞
    marker.bindPopup(createAdminPopup(property));
    marker.addTo(map);
  });
}
```

---

## üîê –î–û–°–¢–£–ü –ö –ê–î–ú–ò–ù–°–ö–û–ô –ö–ê–†–¢–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL —Å —Å–µ–∫—Ä–µ—Ç–æ–º

```
URL: /admin/master-map?token={long_admin_token}
–ü—Ä–∏–º–µ—Ä: /admin/master-map?token=a7f3b9e2c1d4f5e6a7b8c9d0e1f2a3b4

–¢–æ–∫–µ–Ω:
- 32+ —Å–∏–º–≤–æ–ª–æ–≤ (–æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π)
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ admins
- –ò–∑–≤–µ—Å—Ç–µ–Ω —Ç–æ–ª—å–∫–æ –≤–∞–º
- –ú–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

```
/admin ‚Üí –í—Ö–æ–¥ (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
    ‚Üì
Dashboard —Å –∫–Ω–æ–ø–∫–æ–π:
[üó∫Ô∏è Master Map - –í—Å–µ –æ–±—ä–µ–∫—Ç—ã]
    ‚Üì
/admin/master-map (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Å—Å–∏–∏)
```

---

## üìä –î–ê–ù–ù–´–ï –ù–ê –ê–î–ú–ò–ù–°–ö–û–ô –ö–ê–†–¢–ï

### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:

```sql
-- –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
SELECT 
  sp.*,
  
  -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–ª–∞–¥–µ–ª—å—Ü–µ
  t.telegram_user_id,
  t.saved_properties_count as user_total_objects,
  t.created_at as user_registered_at,
  
  -- –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è
  EXTRACT(EPOCH FROM (NOW() - sp.created_at))/3600 as age_hours,
  
  -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  (SELECT COUNT(*) FROM saved_properties WHERE telegram_user_id = sp.telegram_user_id) as user_objects_count

FROM saved_properties sp
JOIN tenants t ON sp.telegram_user_id = t.telegram_user_id
ORDER BY sp.created_at DESC;
```

---

## üéØ POPUP –ù–ê –ê–î–ú–ò–ù–°–ö–û–ô –ö–ê–†–¢–ï

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

```html
<div class="admin-popup">
  <!-- –û–±—ã—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="property-info">
    <div class="photos-slider">
      <img src="photo1.jpg" />
    </div>
    <h3>2BR Villa, Negombo</h3>
    <p class="price">$800/month</p>
    <p class="description">Near beach, WiFi, Pool...</p>
  </div>
  
  <!-- –ê–î–ú–ò–ù–°–ö–ê–Ø –°–ï–ö–¶–ò–Ø -->
  <div class="admin-section">
    <hr>
    <h4>üîê ADMIN INFO</h4>
    
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
    <div class="user-info">
      <strong>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong>
      <p>ID: 1000089271</p>
      <p>Username: @john_doe</p>
      <p>–í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤: 5</p>
      <p>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: 15.01.2026</p>
      <button onclick="showUserObjects(1000089271)">
        üìç –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      </button>
      <button onclick="openUserMap(1000089271)">
        üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      </button>
    </div>
    
    <!-- –í—Ä–µ–º—è -->
    <div class="time-info">
      <strong>üìÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏:</strong>
      <p>–î–æ–±–∞–≤–ª–µ–Ω–æ: 29.01.2026 14:30</p>
      <p>–í–æ–∑—Ä–∞—Å—Ç: 2 —á–∞—Å–∞ 15 –º–∏–Ω—É—Ç</p>
      <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ: -</p>
    </div>
    
    <!-- –ò—Å—Ç–æ—á–Ω–∏–∫ -->
    <div class="source-info">
      <strong>üì® –ò—Å—Ç–æ—á–Ω–∏–∫:</strong>
      <p>–¢–∏–ø: Forward –∏–∑ –≥—Ä—É–ø–ø—ã</p>
      <p>–ì—Ä—É–ø–ø–∞: Sri Lanka Housing</p>
      <p>Username: @srilanka_housing</p>
      <p>–ê–≤—Ç–æ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: Peter (@property_owner)</p>
      <p>ID –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: 555666777</p>
      <a href="https://t.me/srilanka_housing/123" target="_blank">
        üîó –û—Ç–∫—Ä—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      </a>
    </div>
    
    <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è -->
    <div class="geo-info">
      <strong>üìç –ì–µ–æ–¥–∞–Ω–Ω—ã–µ:</strong>
      <p>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 6.9271, 79.8612</p>
      <p>Google Maps: [—Å—Å—ã–ª–∫–∞]</p>
      <p>–ê–¥—Ä–µ—Å: Negombo, Sri Lanka</p>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-info">
      <strong>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—ä–µ–∫—Ç–∞:</strong>
      <p>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º: 3</p>
      <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä: 1 —á–∞—Å –Ω–∞–∑–∞–¥</p>
      <p>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ: –î–∞ ‚≠ê</p>
    </div>
    
    <!-- –î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞ -->
    <div class="admin-actions">
      <button class="edit-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="delete-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
      <button class="ban-user-btn">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
      <button class="contact-user-btn">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</button>
    </div>
  </div>
</div>
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ê–Ø –ü–ê–ù–ï–õ–¨

### –°–∞–π–¥–±–∞—Ä —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π:

```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
   –í—Å–µ–≥–æ: 32
   –ê–∫—Ç–∏–≤–Ω—ã–µ (>5 –æ–±—ä–µ–∫—Ç–æ–≤): 12
   –ù–æ–≤—ã–µ (1-2 –æ–±—ä–µ–∫—Ç–∞): 15
   –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ: 5

üìç –û–±—ä–µ–∫—Ç—ã:
   –í—Å–µ–≥–æ: 245
   –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: 8
   –î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é: 45
   –î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞ –º–µ—Å—è—Ü: 132

üì® –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
   Direct: 89 (36%)
   Forward –∏–∑ –≥—Ä—É–ø–ø: 124 (51%)
   Forward –ª–∏—á–Ω—ã–µ: 32 (13%)

üî• –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
   1. @john_doe - 23 –æ–±—ä–µ–∫—Ç–∞
   2. @maria_k - 18 –æ–±—ä–µ–∫—Ç–æ–≤
   3. @peter_m - 15 –æ–±—ä–µ–∫—Ç–æ–≤

üèÜ –¢–æ–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
   1. Sri Lanka Housing - 45 –æ–±—ä–µ–∫—Ç–æ–≤
   2. Negombo Properties - 32 –æ–±—ä–µ–∫—Ç–∞
   3. Colombo Rentals - 28 –æ–±—ä–µ–∫—Ç–æ–≤

üí∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω–µ:
   <$200: 45 –æ–±—ä–µ–∫—Ç–æ–≤
   $200-500: 98 –æ–±—ä–µ–∫—Ç–æ–≤
   $500-1000: 78 –æ–±—ä–µ–∫—Ç–æ–≤
   >$1000: 24 –æ–±—ä–µ–∫—Ç–∞

üó∫Ô∏è –ì–µ–æ–≥—Ä–∞—Ñ–∏—è:
   Negombo: 89
   Colombo: 76
   Galle: 45
   –î—Ä—É–≥–∏–µ: 35
```

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò

### 1. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤

```javascript
// –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ–±—ä–µ–∫—Ç–æ–≤ - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å
import MarkerClusterGroup from 'leaflet.markercluster';

const markers = L.markerClusterGroup({
  iconCreateFunction: (cluster) => {
    const count = cluster.getChildCount();
    const color = count > 50 ? 'red' : count > 20 ? 'orange' : 'green';
    
    return L.divIcon({
      html: `<div style="background:${color}">${count}</div>`,
      className: 'marker-cluster'
    });
  }
});
```

### 2. –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (Heat Map layer)

```javascript
import HeatmapOverlay from 'leaflet-heatmap';

// –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤
const heatmapData = properties.map(p => ({
  lat: p.latitude,
  lng: p.longitude,
  value: p.price / 100  // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Ü–µ–Ω–µ
}));

const heatmapLayer = new HeatmapOverlay({
  radius: 20,
  maxOpacity: 0.8,
  gradient: {
    0.0: 'green',
    0.5: 'yellow',
    1.0: 'red'
  }
});
```

### 3. –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–µ

```javascript
// –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
map.on('moveend', () => {
  const bounds = map.getBounds();
  
  const visibleProperties = properties.filter(p => 
    bounds.contains([p.latitude, p.longitude])
  );
  
  updateSidebar(visibleProperties);
});
```

### 4. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```
[üì• –≠–∫—Å–ø–æ—Ä—Ç]
  ‚Üí CSV
  ‚Üí JSON
  ‚Üí Excel
  ‚Üí Google Sheets

–≠–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–∏–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
–∏–ª–∏ –≤—Å–µ—Ö —Å —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

---

## üéØ –ò–¢–û–ì–û

### –¢—Ä–∏ —Ç–∏–ø–∞ –∫–∞—Ä—Ç –≤ —Å–∏—Å—Ç–µ–º–µ:

#### 1. –õ–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
/map/{user_id}/{token}
‚Üí –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã
‚Üí –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Üí –û–¥–∏–Ω —Ü–≤–µ—Ç
```

#### 2. –ü—É–±–ª–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∞ (–±—É–¥—É—â–µ–µ)
```
/map/public
‚Üí –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –æ—Ç landlords
‚Üí –î–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º
‚Üí –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
```

#### 3. –ê–¥–º–∏–Ω—Å–∫–∞—è –º–∞—Å—Ç–µ—Ä-–∫–∞—Ä—Ç–∞ (–ù–û–í–û–ï!)
```
/admin/master-map?token={admin_token}
‚Üí –í–°–ï –æ–±—ä–µ–∫—Ç—ã –æ—Ç –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Üí –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Üí –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–ø–æ –≤—ã–±–æ—Ä—É)
‚Üí –§–∏–ª—å—Ç—Ä—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Üí –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```

---

## üìÑ –í –î–û–ö–£–ú–ï–ù–¢–ï:

**`ADMIN_MASTER_MAP_CONCEPT.md`** —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ö–æ–Ω—Ü–µ–ø—Ü–∏—é 3 —Ç–∏–ø–æ–≤ –∫–∞—Ä—Ç
- 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ç–µ–ø–ª–æ–≤—ã—Ö —Å—Ö–µ–º (–≤—Ä–µ–º—è, –∏—Å—Ç–æ—á–Ω–∏–∫, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ü–µ–Ω–∞)
- –°—Ç—Ä—É–∫—Ç—É—Ä—É –∞–¥–º–∏–Ω popup —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤
- API endpoints
- –ö–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é –ø–∞–Ω–µ–ª—å
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∫–ª–∞—Å—Ç–µ—Ä—ã, heatmap, —ç–∫—Å–ø–æ—Ä—Ç)

---

## ‚úÖ –û–¢–õ–ò–ß–ù–ê–Ø –ò–î–ï–Ø!

**–ê–¥–º–∏–Ω—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –¥–∞—Å—Ç –≤–∞–º:**
- üîç –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—Å–µ–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- üìà –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–∞–∫ —Ä–∞—Å—Ç—ë—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

**–†–µ–∞–ª–∏–∑—É–µ–º –ø–æ—Å–ª–µ –±–æ—Ç–∞?** üöÄ

–°–µ–π—á–∞—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≠—Ç–∞–ø 2 (Telegram Bot) –∏–ª–∏ —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ–º –∞–¥–º–∏–Ω—Å–∫—É—é –∫–∞—Ä—Ç—É?