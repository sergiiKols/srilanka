# üìã –°–≤–æ–¥–∫–∞ —Å–µ—Å—Å–∏–∏ 30 —è–Ω–≤–∞—Ä—è 2026

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–µ–ø–ª–æ–π (–∫–æ–º–º–∏—Ç `3ead28a`)

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–µ–ø–ª–æ–π –Ω–∞ Vercel –ø–∞–¥–∞–ª –∏–∑-–∑–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é –∫–æ–ª–æ–Ω–∫—É `deleted_at`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã `deleted_at` –∏–∑ TypeScript —Ç–∏–ø–æ–≤ (`telegram-listing.types.ts`)
- ‚úÖ API endpoint `saved-properties/[id].ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `soft_delete_property()`
- ‚úÖ `AdminMasterMap.tsx` —É–±—Ä–∞–Ω —Ñ–∏–ª—å—Ç—Ä –∏ UI –¥–ª—è `deleted_at`
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞: **SUCCESS**
- ‚úÖ –î–µ–ø–ª–æ–π –Ω–∞ Vercel: **SUCCESS**

### 2. –ù–∞–π–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ (–∫–æ–º–º–∏—Ç `08154fb`)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- ‚úÖ –ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (`telegram-photo-uploader.ts`): **–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**
- ‚úÖ Storage bucket `tenant-photos`: **–°—É—â–µ—Å—Ç–≤—É–µ—Ç**
- ‚ùå RLS Policy: **–ë–ª–æ–∫–∏—Ä—É–µ—Ç anon —Ä–æ–ª—å**

**–ü—Ä–∏—á–∏–Ω–∞:**
```
Storage –ø–æ–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç 'authenticated' –∏–ª–∏ 'service_role',
–Ω–æ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'anon' –∫–ª—é—á –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ API
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç: `database/08_fix_storage_policies.sql`

---

## ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –í–ê–®–ï –î–ï–ô–°–¢–í–ò–ï

### üéØ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Storage Policy (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard/project/mcmzdscpuoxwneuzsanu)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–ª–µ–≤–æ–µ –º–µ–Ω—é)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `database/08_fix_storage_policies.sql`
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL (–Ω–∞–∂–º–∏—Ç–µ **Run** –∏–ª–∏ `Ctrl+Enter`)

**SQL –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```sql
-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–ª–∏—Ç–∏–∫—É
DROP POLICY IF EXISTS "Service role can upload tenant photos" ON storage.objects;

-- –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π anon —Ä–æ–ª–∏)
CREATE POLICY "Allow anon and authenticated to upload tenant photos"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'tenant-photos'
  AND (
    auth.role() = 'anon' 
    OR auth.role() = 'authenticated'
    OR auth.role() = 'service_role'
  )
);
```

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```sql
SELECT policyname, cmd 
FROM pg_policies 
WHERE tablename = 'objects' 
  AND policyname LIKE '%tenant%';
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ Telegram –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–æ—Ç–æ –ø–æ—è–≤–∏–ª–æ—Å—å –≤ Supabase Storage
- –û—Ç–∫—Ä–æ–π—Ç–µ –æ–±—ä–µ–∫—Ç –Ω–∞ –∫–∞—Ä—Ç–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
- URL: `/map/personal/8311531873/gjd2Xh`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ 500 error
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìä –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:
- `saved_properties` ‚Üí **—Ç–æ–ª—å–∫–æ –ê–ö–¢–ò–í–ù–´–ï** –æ–±—ä–µ–∫—Ç—ã
- `archived_properties` ‚Üí **–£–î–ê–õ–Å–ù–ù–´–ï** –æ–±—ä–µ–∫—Ç—ã
- `admin_all_properties` ‚Üí **VIEW** (–∞–∫—Ç–∏–≤–Ω—ã–µ + –∞—Ä—Ö–∏–≤–Ω—ã–µ)

### –§—É–Ω–∫—Ü–∏–∏:
- `soft_delete_property(property_id)` - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –∞—Ä—Ö–∏–≤
- `restore_property(property_id)` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞
- `archive_property(property_id)` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `database/08_fix_storage_policies.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ Storage
- ‚úÖ `tmp_rovodev_check_storage_policies.sql` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª–∏—Ç–∏–∫
- ‚úÖ `database/06_create_archived_properties_table.sql` - —Ç–∞–±–ª–∏—Ü–∞ –∞—Ä—Ö–∏–≤–∞
- ‚úÖ `database/07_setup_archive_logic.sql` - —Ñ—É–Ω–∫—Ü–∏–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üöÄ –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è

**–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:** `08154fb`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Deployed to production  
**Build:** ‚úÖ Success  
**URL:** https://srilanka.vercel.app

---

## üîë –í–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- **Bot Token:** `7958965950:AAFg63FTJ46hcRT6M2wSBzn9RHCrzvfV3q8`
- **Test User ID:** `8311531873`
- **Supabase Project:** `mcmzdscpuoxwneuzsanu`
- **Storage Bucket:** `tenant-photos`

---

## üìù –ö–æ–º–º–∏—Ç—ã —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏

```
08154fb - üîß Fix: Add Storage policy fix for photo upload
3ead28a - üîß Fix: Replace deleted_at with archive system
520c99c - Fix: Remove deleted_at references from saved-properties API
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (TODO)

- [ ] **–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL:** `database/08_fix_storage_policies.sql` –≤ Supabase
- [ ] **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:** –ó–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –û–±–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

---

*–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 30 —è–Ω–≤–∞—Ä—è 2026, ~21:01 UTC*
