# üîç –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π: –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è vs Vercel Production

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-29  
**Git —Å—Ç–∞—Ç—É—Å:** `main` branch, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å origin/main  
**Production URL:** https://srilanka-37u2.vercel.app/

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –õ–û–ö–ê–õ–¨–ù–û–ô –í–ï–†–°–ò–ò

### 1. üì¶ –ü–æ–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π React (BREAKING CHANGE)

**–ù–∞ Vercel (Production):**
- `react`: ^19.2.3
- `react-dom`: ^19.2.3
- `react-leaflet`: ^5.0.0
- `@types/react`: ^19.2.8
- `@types/react-dom`: ^19.2.3

**–õ–æ–∫–∞–ª—å–Ω–æ (–í–∞—à –ü–ö):**
- `react`: ^18.3.1 ‚¨áÔ∏è **–ü–û–ù–ò–ñ–ï–ù–û**
- `react-dom`: ^18.3.1 ‚¨áÔ∏è **–ü–û–ù–ò–ñ–ï–ù–û**
- `react-leaflet`: ^4.2.1 ‚¨áÔ∏è **–ü–û–ù–ò–ñ–ï–ù–û**
- `@types/react`: ^18.3.12 ‚¨áÔ∏è **–ü–û–ù–ò–ñ–ï–ù–û**
- `@types/react-dom`: ^18.3.1 ‚¨áÔ∏è **–ü–û–ù–ò–ñ–ï–ù–û**

**–ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- React 19 + Vite SSR –≤—ã–∑—ã–≤–∞–ª–∏ –æ—à–∏–±–∫—É: `module is not defined`
- –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å CommonJS –º–æ–¥—É–ª–µ–π React —Å ESM —Ä–µ–∂–∏–º–æ–º Vite
- React 18 + react-leaflet 4.x - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ Production:**
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û:** –ï—Å–ª–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å - —Å–∞–π—Ç –Ω–∞ Vercel –°–õ–û–ú–ê–ï–¢–°–Ø
- –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏
- –í—Å–µ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

---

### 2. üèóÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (BREAKING CHANGE)

**–ù–∞ Vercel (Production):**
```javascript
export default defineConfig({
  output: 'server',
  adapter: vercel({
    webAnalytics: { enabled: false },
    speedInsights: { enabled: false }
  }),
  integrations: [react()],
  vite: {
    plugins: [tailwindcss()],
    ssr: {
      noExternal: ['react', 'react-dom']
    }
  }
});
```

**–õ–æ–∫–∞–ª—å–Ω–æ (–í–∞—à –ü–ö):**
```javascript
export default defineConfig({
  output: 'static', // ‚ö†Ô∏è –ò–ó–ú–ï–ù–ï–ù–û –° 'server' –ù–ê 'static'
  // adapter: vercel() - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù
  integrations: [
    react({
      include: ['**/react/*', '**/components/**/*.tsx', '**/components/**/*.jsx']
    })
  ],
  vite: {
    plugins: [tailwindcss()]
    // ssr: { noExternal: [...] } - –£–î–ê–õ–ï–ù–û
  }
});
```

**–í–ª–∏—è–Ω–∏–µ:**
- üö´ **API —Ä–æ—É—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** (`/api/*`)
- üö´ **Server-side —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ö†Ô∏è –§–æ—Ä–º—ã (tenant-form, telegram-form) –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç SSR

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò

| –§—É–Ω–∫—Ü–∏—è | Production (Vercel) | –õ–æ–∫–∞–ª—å–Ω–æ (–ü–ö) | –°—Ç–∞—Ç—É—Å |
|---------|---------------------|----------------|--------|
| React –≤–µ—Ä—Å–∏—è | 19.2.3 | 18.3.1 | ‚ö†Ô∏è –ù–ï–°–û–í–ú–ï–°–¢–ò–ú–û |
| Leaflet –∫–∞—Ä—Ç–∞ | –õ–æ–º–∞–µ—Ç—Å—è –∏–∑-–∑–∞ React 19 bug | –†–∞–±–æ—Ç–∞–µ—Ç (React 18) | ‚úÖ –õ–û–ö–ê–õ–¨–ù–û –õ–£–ß–®–ï |
| API endpoints | –†–∞–±–æ—Ç–∞—é—Ç (SSR) | –ù–ï –†–ê–ë–û–¢–ê–Æ–¢ (static) | üö´ –ö–†–ò–¢–ò–ß–ù–û |
| Tenant —Ñ–æ—Ä–º–∞ | –†–∞–±–æ—Ç–∞–µ—Ç | –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å | ‚ö†Ô∏è –ù–£–ñ–ù–ê –ü–†–û–í–ï–†–ö–ê |
| Admin –ø–∞–Ω–µ–ª—å | –†–∞–±–æ—Ç–∞–µ—Ç | –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å | ‚ö†Ô∏è –ù–£–ñ–ù–ê –ü–†–û–í–ï–†–ö–ê |
| Vercel –∞–¥–∞–ø—Ç–µ—Ä | –í–∫–ª—é—á–µ–Ω | –û—Ç–∫–ª—é—á–µ–Ω | üö´ –ö–†–ò–¢–ò–ß–ù–û |

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –í–∞—Ä–∏–∞–Ω—Ç 1: üîÑ –û–±–Ω–æ–≤–∏—Ç—å Production –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git
2. –ó–∞–ø—É—à–∏—Ç—å –Ω–∞ GitHub
3. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç —Å React 18
4. ‚ö†Ô∏è **–†–ò–°–ö:** API —Ä–æ—É—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü–ª—é—Å—ã:**
- –ö–∞—Ä—Ç–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –õ–æ–∫–∞–ª—å–Ω–∞—è –∏ production –≤–µ—Ä—Å–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

**–ú–∏–Ω—É—Å—ã:**
- –ü–æ—Ç–µ—Ä—è SSR —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- API endpoints —Å–ª–æ–º–∞—é—Ç—Å—è
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Ñ–æ—Ä–º—ã –Ω–∞ client-side

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –ø–æ–¥ Production
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–µ—Ä–Ω—É—Ç—å `output: 'server'`
2. –í–µ—Ä–Ω—É—Ç—å `adapter: vercel()`
3. –ù–∞–π—Ç–∏ –¥—Ä—É–≥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è React 19 bug
4. –í–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@astrojs/node` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ü–ª—é—Å—ã:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö SSR —Ñ—É–Ω–∫—Ü–∏–π
- API —Ä–∞–±–æ—Ç–∞—é—Ç
- Production –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å React 19 bug –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º
- –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–µ—Ä–Ω—É—Ç—å `output: 'server'` –∏ `adapter: vercel()`
2. –û—Å—Ç–∞–≤–∏—Ç—å React 18 (–æ–Ω —Å–æ–≤–º–µ—Å—Ç–∏–º —Å SSR)
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–µ —Ç—Ä–æ–≥–∞—è —Ä–µ–∂–∏–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
4. –î–µ–ø–ª–æ–π –Ω–∞ Vercel

**–ü–ª—é—Å—ã:**
- ‚úÖ –ö–∞—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (React 18)
- ‚úÖ API —Ä–∞–±–æ—Ç–∞—é—Ç (SSR)
- ‚úÖ –í—Å–µ —Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- React 18 –≤–º–µ—Å—Ç–æ 19 (–Ω–æ —ç—Ç–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ)

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–í–∞—Ä–∏–∞–Ω—Ç 3)

```bash
# 1. –í–µ—Ä–Ω—É—Ç—å server mode –≤ astro.config.mjs
# 2. –í–µ—Ä–Ω—É—Ç—å vercel adapter
# 3. –û—Å—Ç–∞–≤–∏—Ç—å React 18 (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
# 4. –î–æ–±–∞–≤–∏—Ç—å SSR –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è React 18

# 5. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add package.json package-lock.json astro.config.mjs
git commit -m "fix: Downgrade to React 18 for Leaflet compatibility, keep SSR mode"

# 6. –ü—É—à –Ω–∞ GitHub
git push origin main

# 7. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
```

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã):
- `ERROR_HANDLING_AND_MULTI_PHOTOS.md`
- `FORWARD_MESSAGES_LOGIC.md`
- `NEW_BOT_LOGIC_2026-01-29.md`
- `TELEGRAM_WEB_APP_ANALYSIS_2026-01-29.md`
- –ò –¥—Ä. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore` –∏–ª–∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

---

## ‚ùì –í–û–ü–†–û–°–´ –î–õ–Ø –ü–†–ò–ù–Ø–¢–ò–Ø –†–ï–®–ï–ù–ò–Ø

1. **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ API endpoints (`/api/*`) –Ω–∞ —Å–∞–π—Ç–µ?**
   - –î–∞ ‚Üí –ù—É–∂–µ–Ω server mode
   - –ù–µ—Ç ‚Üí –ú–æ–∂–Ω–æ static mode

2. **–í–∞–∂–Ω—ã –ª–∏ SSR —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º?**
   - –î–∞ ‚Üí –ù—É–∂–µ–Ω server mode
   - –ù–µ—Ç ‚Üí –ú–æ–∂–Ω–æ static mode

3. **–ö–∞–∫–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞?**
   - –†–∞–±–æ—Ç–∞—é—â–∞—è –∫–∞—Ä—Ç–∞ ‚Üí React 18 + server mode (–í–∞—Ä–∏–∞–Ω—Ç 3) ‚≠ê
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å ‚Üí static mode (–í–∞—Ä–∏–∞–Ω—Ç 1)
   - Production –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å ‚Üí –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (–í–∞—Ä–∏–∞–Ω—Ç 2)

---

## üöÄ –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–í—ã–±—Ä–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 3:**
1. –í–µ—Ä–Ω—É—Ç—å server mode + vercel adapter
2. –û—Å—Ç–∞–≤–∏—Ç—å React 18 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Vercel

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–∞—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ API —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –§–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Production —Å—Ç–∞–±–∏–ª—å–Ω–∞
- ‚ö†Ô∏è React 18 –≤–º–µ—Å—Ç–æ 19 (–Ω–æ —ç—Ç–æ –ø–ª—é—Å, –∞ –Ω–µ –º–∏–Ω—É—Å)

---

**–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?**
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 3 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)?
2. –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–ª–æ–∫–∞–ª—å–Ω–æ static, production server)?
3. –î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç?
